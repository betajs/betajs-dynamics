<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.1.1/es5-shim.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/json2/20140204/json2.js"></script>
        <script src="../vendors/beta.js"></script>
        <script src="../vendors/beta-browser-noscoped.js"></script>
		<script src="../dist/betajs-dynamics.js"></script>
	</head>
	<body>
		<go>
			<div ba-repeat="{{item::list}}">
				<ba-inner ba-item="{{item}}">
				</ba-inner>
			</div>
		</go>
		<script>
		    window.perf = {
		    	data: {},
		    	start: function (key) {
		    		if (!(key in this.data)) {
		    			this.data[key] = {
		    				total: 0,
		    				counting: 0,
		    				number: 0
		    			};
		    		} 
		    		if (!this.data[key].counting)
		    			this.data[key].counting = 0;
		    		if (this.data[key].counting === 0)
		    			this.data[key].start = BetaJS.Time.now();
		    		this.data[key].number++;
		    		this.data[key].counting++;
		    	},
		    	stop: function (key) {
                    this.data[key].counting--;
                    if (this.data[key].counting === 0) {
                        this.data[key].total += BetaJS.Time.now() - this.data[key].start;
                        delete this.data[key].start;
                        delete this.data[key].counting;
                    }
		    	}		    	
		    };
			perf.start("all");
			var list = [];
			for (var i = 0; i < 1000; ++i)
				list.push({foobar: "Item " + i});
			BetaJS.Dynamics.Dynamic.extend(null, {
				template: "<p>{{item.foobar}}</p>",
			}).register("ba-inner");
			var mainDynamic = new BetaJS.Dynamics.Dynamic({
				element: $("go").get(0),
				attrs: {
					list: list
				}
			});
			perf.start("activate");
			mainDynamic.activate();
			perf.stop("activate");
			perf.stop("all");
			console.log(perf.data);
			document.title = perf.data.all.total;
		</script>
	</body>
</html>