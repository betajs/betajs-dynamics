/*!
betajs-dynamics - v0.0.92 - 2017-07-03
Copyright (c) Victor Lingenthal,Oliver Friedmann
Apache-2.0 Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.Dynamics"),a.binding("base","global:BetaJS"),a.binding("browser","global:BetaJS.Browser"),a.define("module:",function(){return{guid:"d71ebf84-e555-4e9b-b18a-11d74fdcefe2",version:"0.0.92"}}),a.assumeVersion("base:version","~1.0.96"),a.assumeVersion("browser:version","~1.0.61"),a.define("module:Data.Mesh",["base:Class","base:Events.EventsMixin","base:Properties.Properties","base:Objs","base:Types","base:Strings","base:Ids","base:Functions"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},[b,function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__environment=b,this.__defaults=d,this.__context=c,this.__watchers={}},destroy:function(){d.iter(this.__watchers,function(a){this.__destroyWatcher(a)},this),a.destroy.call(this)},watch:function(a,b,c){d.iter(a,function(a){var d=this.__createWatcher(a);d.cbs[g.objectId(c)]={callback:b,context:c}},this)},unwatch:function(a,b){d.iter(a,function(a){var c=this.__createWatcher(a,!0);c&&(delete c.cbs[g.objectId(b)],this.__destroyWatcher(c,!0))},this)},__destroyWatcher:function(a,b){e.is_string(a)&&(a=this.__watchers[a]),a&&(!b||e.is_empty(a.cbs)&&e.is_empty(a.children))&&(d.iter(a.children,this.__destroyWatcher,this),this.__unbindWatcher(a),a.parent&&delete a.parent.children[a.key],delete this.__watchers[a.expression],a.parent&&e.is_empty(a.parent.cbs)&&e.is_empty(a.parent.children)&&this.__destroyWatcher(a.parent))},__createWatcher:function(a,b){var c=this.__watchers[a];if(c||b)return c;var d=f.splitLast(a,"."),e=d.head?this.__createWatcher(d.head):null;return c={cbs:{},parent:e,key:d.tail,expression:a,children:{},properties:null,propertiesPrefix:null},e&&(e.children[d.tail]=c),this.__watchers[a]=c,this.__bindWatcher(c),c},__unbindWatcher:function(a){a.properties&&a.properties.off(null,null,a),d.iter(a.children,this.__unbindWatcher,this)},__bindWatcher:function(a){for(var b=null,e=this.__environment.length-1;e>=0;--e){var f=this.__environment[e];if(b=this._navigate(f,a.expression),b.properties&&!b.tail)break;b=null}if(null===b){var g=this.__defaults.watch||this.__environment[0];b=this._navigate(g,a.expression),!b.properties&&c.is_instance_of(g)&&(b.properties=g),b.properties||(b=null)}if(null!==b){a.properties=b.properties;var h=b.head+(b.head&&b.tail?".":"")+b.tail;a.propertiesPrefix=h,a.properties.on("change:"+a.propertiesPrefix,function(b,c,e){d.iter(a.children,this.__unbindWatcher,this),d.iter(a.children,this.__bindWatcher,this),(a.value!=b||e)&&(a.value=b,d.iter(a.cbs,function(a){a.callback.apply(a.context)},this))},this);var i=a.properties.get(h);i!=a.value&&(a.value=i,d.iter(a.cbs,function(a){a.callback.apply(a.context)},this)),d.iter(a.children,this.__bindWatcher,this)}},read:function(a){for(var b=this.__environment.length-1;b>=0;--b){var c=this._read(this.__environment[b],a);if(c)return e.is_function(c.value)?h.as_method(c.value,c.context):c.value}return null},write:function(a,b){for(var c=this.__environment.length-1;c>=0;--c)if(this._write(this.__environment[c],a,b,!1))return;this._write(this.__defaults.write||this.__environment[0],a,b,!0)},execute:function(a,b,c){var e={},g=[];d.iter(a,function(a){var b=this.read(a);null===b&&f.splitFirst(a,".").head in window||(g.push(a),e[a]=b)},this);var h=this.__expand(e),i=b.call(this.__context,h);if(!c){var j=this.__collapse(h,g);for(var k in j)k in e&&e[k]==j[k]||this.write(k,j[k])}return i},_sub_navigate:function(a,b,d,g,h){var i={properties:a,head:b,tail:d,parent:g,current:h};if(!d||!h||!e.is_object(h))return i;var j=f.splitFirst(d,"."),k=b?b+"."+j.head:j.head;return c.is_instance_of(h)&&!h.destroyed()?h.has(j.head)?this._sub_navigate(h,j.head,j.tail,h,h.get(j.head)):j.head in h?this._sub_navigate(a,k,j.tail,h,h[j.head]):{properties:h,head:j.head,tail:j.tail,parent:h,current:null}:j.head in h?this._sub_navigate(a,k,j.tail,h,h[j.head]):i},_navigate:function(a,b){return this._sub_navigate(null,"",b,null,a)},_read:function(a,b){var c=this._navigate(a,b);return c.tail?null:{value:c.current,context:c.parent==a?this.__context:c.parent}},_write:function(a,b,c,d){var e=this._navigate(a,b);if(e.tail&&!d)return!1;var f=e.tail.split(".");if(e.properties)e.properties.set(e.head+(e.head&&e.tail?".":"")+e.tail,c);else{for(var g=e.current,h=0;h<f.length-1;++h)g[f[h]]={},g=g[f[h]];g[f[f.length-1]]=c}return!0},__expand:function(a){var b={};return d.iter(a,function(a,c){for(var d=b,f=c.split("."),g=0;g<f.length-1;++g)f[g]in d&&e.is_object(d[f[g]])&&null!==d[f[g]]||(d[f[g]]={}),d=d[f[g]];d[f[f.length-1]]=a}),b},__collapse:function(a,b){var c={};return d.iter(b,function(b){for(var d=b.split("."),e=a,f=0;f<d.length;++f)e=e[d[f]];c[b]=e}),c}}}])}),a.define("module:Parser",["base:Types","base:Objs","base:JavaScript"],function(a,b,c){return{__cache:{},parseText:function(c){if(!c)return null;for(var d=[];c;){var e=c.indexOf("{{"),f=null;if(0===e){for(e=c.indexOf("}}");e+2<c.length&&"}"==c.charAt(e+2);)e++;e>=0?(e+=2,f=this.parseCode(c.substring(2,e-2))):e=c.length}else 0>e&&(e=c.length);d.push(f?f:c.substring(0,e)),c=c.substring(e)}if(1==d.length)return a.is_string(d[0])?null:d[0];var g={};return b.iter(d,function(c){a.is_string(c)||b.iter(c.dependencies,function(a){g[a]=!0})}),{func:function(c){var e=null;return b.iter(d,function(b){var d=a.is_string(b)?b:b.func(c);e=null===e?d:e+d}),e},dependencies:Object.keys(g)}},parseCode:function(a){var d=this.__cache[a];if(!d){var e=!1,f=a;"="==f.charAt(0)&&(e=!0,f=f.substring(1));var g=f.lastIndexOf("::"),h=null;g>=0&&(h=f.substring(0,g).trim(),f=f.substring(g+2)),d={bidirectional:e,args:h,variable:e?f:null,func:new Function("obj","with (obj) { return "+f+"; }"),dependencies:Object.keys(b.objectify(c.extractIdentifiers(f,!0)))},this.__cache[a]=d}return b.clone(d,1)}}}),a.define("module:Data.ScopeManager",["base:Class","base:Trees.TreeNavigator","base:Classes.ObjectIdScopeMixin","base:Trees.TreeQueryEngine"],function(a,b,c,d,e){return a.extend({scoped:e},[b,c,function(a){return{constructor:function(b){a.constructor.call(this),this.__root=b,this.__watchers=[],this.__query=this._auto_destroy(new d(this))},nodeRoot:function(){return this.__root},nodeId:function(a){return a.cid()},nodeParent:function(a){return a.__parent},nodeChildren:function(a){return a.__children},nodeData:function(a){return a.data()},nodeWatch:function(a,b,c){a.on("data",function(){b.call(c,"data")},c),a.on("add",function(a){b.call(c,"addChild",a)},c),a.on("destroy",function(){b.call(c,"remove")},c)},nodeUnwatch:function(a,b,c){a.off(null,null,c)},query:function(a,b){return this.__query.query(a,b)}}}])}),a.define("module:Data.Scope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Classes.ObjectIdMixin","base:Functions","base:Types","base:Strings","base:Objs","base:Ids","base:Properties.Properties","base:Collections.Collection","base:Events.Events","module:Data.ScopeManager","module:Data.MultiScope"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return a.extend({scoped:o},[b,c,d,function(b){return{constructor:function(c){c=h.extend({functions:{},data:{},parent:null,scopes:{},bind:{},attrs:{},extendables:[],collections:{},computed:{},events:{},channels:{},registerchannels:[]},c),c.bindings&&(c.bind=h.extend(c.bind,c.bindings)),this._channels={},this.__channelCache={};var d=c.parent;this.__manager=d?d.__manager:this._auto_destroy(new m(this)),b.constructor.call(this),this.__parent=d,this.__root=d?d.root():this,this.__children={},this.__extendables=h.objectify(c.extendables),this.__properties=c.properties||new j,this.__properties.increaseRef(this),this.__properties.on("change",function(a,b,c){this.trigger("change:"+a,b,c)},this),this.__functions=h.map(c.functions,function(a){return f.is_string(a)?e.as_method(this[a],this):a},this),this.__scopes={},this.__data=c.data,h.iter(f.is_function(c.attrs)?c.attrs():c.attrs,function(a,b){this.__properties.has(b)||this.set(b,a)},this),this.setAll(),h.iter(c.collections,function(b,d){f.is_array(c.collections)&&(d=b,b=[]),(!this.__properties.has(d)||a.is_instance_of(this.__properties.get(d))&&this.__properties.get(d).destroyed())&&this.set(d,this.auto_destroy(new k({objects:b,release_references:!0})))},this),d&&d.__add(this),this.scopes=h.map(c.scopes,function(a){return this.scope(a)},this),h.iter(c.bind,function(a,b){var c=a.indexOf(":");this.bind(this.scope(a.substring(0,c)),b,{secondKey:a.substring(c+1)})},this),h.iter(c.computed,function(a,b){var c=g.splitFirst(b,":");this.__properties.compute(c.head,a,this,c.tail.split(","))},this),h.iter(c.events,function(a,b){this.on(b,a,this)},this),h.iter(c.registerchannels,this.registerChannel,this),h.iter(c.channels,function(a,b){var c=g.splitFirst(b,":"),d=this.channel(c.head);d&&this.listenOn(this.channel(c.head),c.tail,a,this)},this)},destroy:function(){this.trigger("destroy"),h.iter(this.__scopes,function(a){a.destroy()}),h.iter(this.__children,function(a){a.destroy()}),this.__properties.decreaseRef(this),this.__parent&&this.__parent.__remove(this),b.destroy.call(this)},__object_id_scope:function(){return this.__manager},__add:function(a){this.__children[a.cid()]=a,this.trigger("add",a)},__remove:function(a){this.trigger("remove",a),delete this.__children[a.cid()]},data:function(a,b){return 0===arguments.length?this.__data:1===arguments.length?this.__data[a]:(this.__data[a]=b,this.trigger("data",a,b),this)},set:function(a,b,c){return a in this.__extendables&&(b=h.tree_extend(this.__properties.get(a)||{},b)),this.__properties.set(a,b,c),this},setAll:function(a){return this.__properties.setAll(a),this},get:function(a){return this.__properties.get(a)},setProp:function(a,b){return this.__properties.setProp(a,b),this},getProp:function(a){return this.__properties.getProp(a)},define:function(a,b,c){return this.__functions[a]=e.as_method(b,c||this),this},call:function(a){return this.execute.apply(this,arguments)},execute:function(a){var b=e.getArguments(arguments,1);try{return f.is_string(a)?this.__functions[a].apply(this,b):a.apply(this,b)}catch(c){return this.handle_call_exception(a,b,c)}},handle_call_exception:function(a,b,c){throw c},parent:function(){return this.__parent},_eventChain:function(){return this.parent()},registerChannel:function(a){this._channels[a]=this.auto_destroy(new l)},channel:function(a){if(!(a in this.__channelCache)){var b=null;this._channels[a]?b=this._channels[a]:this.__parent&&(b=this.__parent.channel(a)),this.__channelCache[a]=b}return this.__channelCache[a]},root:function(){return this.__root},children:function(){return this.scope(">")},properties:function(){return this.__properties},compute:function(a,b,c){this.properties().compute(a,b,this,c)},scope:function(a,b){if(arguments.length<2&&(b=a,a=this),!b)return a;if(a&&a.instance_of(n)&&(a=a.iterator().next()),!a)return a;var c=i.objectId(a)+"_"+b;return this.__scopes[c]||(this.__scopes[c]=new n(this,a,b)),this.__scopes[c]},bind:function(a,b,c){if(a.instance_of(n)){for(var d=a.iterator();d.hasNext();)this.properties().bind(b,d.next().properties(),c);a.on("addscope",function(a){this.properties().bind(b,a.properties(),c)},this),a.on("removescope",function(a){this.properties().unbind(b,a.properties())},this)}else this.properties().bind(b,a.properties(),c)}}}],{_extender:{functions:function(a,b){return h.extend(h.clone(a,1),b)}}})}),a.define("module:Data.MultiScope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Objs","base:Iterators.ArrayIterator"],function(a,b,c,d,e,f){return a.extend({scoped:f},[b,c,function(a){return{constructor:function(b,c,e){a.constructor.call(this),this.__owner=b,this.__base=c,this.__queryStr=e,this.__query=this.__owner.__manager.query(this.__owner,e),this.__query.on("add",function(a){this.delegateEvents(null,a),this.trigger("addscope",a)},this),this.__query.on("remove",function(a){a.off(null,null,this),this.trigger("removescope",a)},this),d.iter(this.__query.result(),function(a){this.delegateEvents(null,a)},this),this.__freeze=!1},destroy:function(){d.iter(this.__query.result(),function(a){a.off(null,null,this)},this),this.__query.destroy(),a.destroy.call(this)},iterator:function(){return new e(this.__query.result())},set:function(a,b){for(var c=this.iterator();c.hasNext();)c.next().set(a,b);return this},get:function(a){var b=this.iterator();return b.hasNext()?b.next().get(a):null},setProp:function(a,b){for(var c=this.iterator();c.hasNext();)c.next().setProp(a,b);return this},getProp:function(a){var b=this.iterator();return b.hasNext()?b.next().getProp(a):null},define:function(a,b){for(var c=this.iterator();c.hasNext();)c.next().define(a,b);return this},call:function(a){return this.execute.apply(this,arguments)},execute:function(a){for(var b=this.iterator(),c=null;b.hasNext();){var d=b.next(),e=d.execute.apply(d,arguments);c=c||e}return c},parent:function(){return this.__owner.scope(this.__base,this.__queryStr+"<")},root:function(){return this.__owner.root()},children:function(){return this.__owner.scope(this.__base,this.__queryStr+">")},scope:function(a,b){return arguments.length<2&&(b=this.__queryStr+a,a=this.__base),this.__owner.scope(a,b)},materialize:function(a){return a?this.iterator().next():this.iterator().asArray()},freeze:function(){this.__freeze=!0,this.__query.off("add",null,this)}}}])}),a.define("module:DomObserver",["base:Class","base:Objs","browser:DomMutation.NodeInsertObserver","module:Registries","module:Dynamic","browser:Dom"],function(a,b,c,d,e,f,g){return a.extend({scoped:g},function(a){return{constructor:function(e){a.constructor.call(this),e=e||{},this.__root=f.unbox(e.root||document.body),this.__persistent_dynamics=!!e.persistent_dynamics,this.__allowed_dynamics=e.allowed_dynamics?b.objectify(e.allowed_dynamics):null,this.__forbidden_dynamics=e.forbidden_dynamics?b.objectify(e.forbidden_dynamics):null,this.__dynamics={},e.ignore_existing||b.iter(d.handler.classes(),function(a,b){if((!this.__forbidden_dynamics||!this.__forbidden_dynamics[b])&&(!this.__allowed_dynamics||this.__allowed_dynamics[b]))for(var c=this.__root.getElementsByTagName(b.toUpperCase()),d=0;d<c.length;++d){var e=c[d];e.dynamicshandler||this.__nodeInserted(e)}},this),this.__observer=c.create({root:this.__root,filter:this.__observerFilter,context:this}),this.__observer.on("node-inserted",this.__nodeInserted,this)},destroy:function(){this.__observer.destroy(),b.iter(this.__dynamics,function(a){a.off(null,null,this),this.__persistent_dynamics||a.weakDestroy()},this),a.destroy.call(this)},__observerFilter:function(a){if(a.dynamicshandler||!a.tagName)return!1;var b=a.tagName.toLowerCase();return d.handler.get(b)?this.__forbidden_dynamics&&this.__forbidden_dynamics[b]?!1:!this.__allowed_dynamics||this.__allowed_dynamics[b]:!1},__nodeInserted:function(a){var b=new e({element:a,remove_observe:!0});this.__dynamics[b.cid()]=b,b.on("destroy",function(){delete this.__dynamics[b.cid()]},this),b.activate()}}},{__singleton:null,activate:function(a){this.__singleton||(this.__singleton=new this(a))}})}),a.define("module:Exceptions.DynamicsCallException",["base:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d,e){a.constructor.call(this,"Dynamics Exception in '"+b+"' calling method '"+c+"' : "+e)}}})}),a.define("module:Dynamic",["module:Data.Scope","module:Handlers.HandlerMixin","module:Exceptions.DynamicsCallException","base:Objs","base:Strings","base:Types","base:Functions","base:Promise","base:Events.Events","module:Registries","browser:Dom","browser:Events","base:Class"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o;return o=a.extend({scoped:n},[b,function(a){return{supportsGc:!0,_notifications:{_activate:"__createActivate"},constructor:function(b){if(this.initial=this.initial||{},b=d.extend(d.clone(this.initial,1),b),this.domevents=d.extend(this.domevents,b.domevents),this.windowevents=d.extend(this.windowevents,b.windowevents),d.iter(this.cls.__initialForward,function(a){a in this&&(a in b?f.is_object(this[a])&&f.is_object(b[a])&&(b[a]=d.extend(d.clone(this[a],1),b[a])):b[a]=this[a])},this),this.__dispose=b.dispose,d.iter(this.object_functions,function(a){this[a]=function(){var b=g.getArguments(arguments);return b.unshift(a),this.execute.apply(this,b)}},this),!b.parent&&b.parentHandler)for(var c=b.parentHandler;c&&!b.parent;)b.parent=c.instance_of(o)?c:null,c=c._parentHandler;a.constructor.call(this,b),this.__references=b.references,d.iter(this.__references,function(a){this.on("change:"+a,function(a,b){b&&m.is_class_instance(b)&&!b.destroyed()&&b.decreaseRef(this),a&&m.is_class_instance(a)&&!a.destroyed()&&a.increaseRef(this)},this);var b=this.get(a);b&&m.is_class_instance(b)&&!b.destroyed()&&b.increaseRef(this)},this),this._channels.global=this.cls.__globalEvents,b.tagName&&(this._tagName=b.tagName,this.data("tagname",this._tagName)),this.functions=this.__functions,this._handlerInitialize(b),this.__createActivate=b.create||function(){},this.dom_events={},this.window_events={},this.__domEvents=new l,this.inheritables=(this.parent()?this.parent().inheritables:[]).concat(this.inheritables||[])},handle_call_exception:function(a,b,d){return j.throwException(new c(this.cls.classname,a,b,d)),null},_preAfterActivate:function(a){this.__domEvents.clear();var b=this;d.iter(this.domevents,function(c,d){var e=d.split(" "),f=[a];e.length>1&&(f=a.querySelectorAll(e[1]));for(var g=function(a){b.execute(c,a,this)},h=0;h<f.length;++h)this.__domEvents.on(f[h],e[0],g)},this),d.iter(this.windowevents,function(a,c){this.__domEvents.on(window,c,function(c){b.execute(a,c,this)})},this)},destroy:function(){this.free&&this.free(),d.iter(this.__references,function(a){var b=this.get(a);b&&m.Class.is_class_instance(b)&&!b.destroyed()&&b.decreaseRef(this)},this),d.iter(this.__dispose,function(a){var b=this.get(a);this.set(a,null),b&&b.weakDestroy&&b.weakDestroy()},this),this.__domEvents.destroy(),a.destroy.call(this)}}}],{__initialForward:["functions","attrs","extendables","collections","template","create","scopes","bindings","computed","types","events","dispose","channels","registerchannels","references"],__globalEvents:new i,canonicName:function(){return e.last_after(this.classname,".").toLowerCase()},registeredName:function(){return this.__registeredName||"ba-"+this.canonicName()},findByElement:function(a){return a?(a=k.unbox(a),a&&a.dynamicshandler?a.dynamicshandler:null):null},findByElementPromise:function(a){if(!a)return null;if(a=k.unbox(a),!a)return null;if(a.dynamicshandler)return h.value(a.dynamicshandler);a.dynamicshandlerpromise=a.dynamicshandlerpromise||[];var b=h.create();return a.dynamicshandlerpromise.push(b),b},register:function(a,b){return b=b||j.handler,this.__registeredName=a||this.registeredName(),b.register(this.__registeredName,this),this},activate:function(a){var b=new this(a||{element:document.body,name_registry:!0});return b.activate(),b},attachStringTable:function(a){return this.__stringTable=a,this},addStrings:function(a){return this.__stringTable.register(a,this.registeredName()),this},string:function(a){var b=this.__stringTable.get(a,this.registeredName());return!b&&this.parent.string&&(b=this.parent.string(a)),b},_extender:{types:function(a,b){return d.extend(d.clone(a,1),b)},registerchannels:function(a,b){return d.extend(d.clone(a,1),b)},channels:function(a,b){return d.extend(d.clone(a,1),b)},attrs:function(a,b){return f.is_function(a)?f.is_function(b)?function(){return d.extend(a(),b())}:function(){return d.extend(a(),b)}:f.is_function(b)?function(){return d.extend(d.clone(a,1),b())}:d.extend(d.clone(a,1),b)},inheritables:function(a,b){return(a||[]).concat(b||[])},dispose:function(a,b){return(a||[]).concat(b||[])},references:function(a,b){return(a||[]).concat(b||[])}}})}),a.define("module:Exceptions.TagHandlerException",["base:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,b+" is expecting a tag handler, but no registered tag handler for "+c+" has been found.")}}})}),a.define("module:Handlers.Attr",["base:Class","module:Exceptions.TagHandlerException","module:Parser","base:Types","base:Objs","base:Strings","base:Async","module:Registries","browser:Dom","browser:Events"],function(a,b,c,d,e,f,g,h,i,j,k){var l;return l=a.extend({scoped:k},function(k){return{constructor:function(a,b){if(k.constructor.call(this),this._node=a,this._tagHandler=null,this._attrName=b.name,this._isEvent=0===this._attrName.indexOf("on"),this._updatable=!this._isEvent,this._attrOriginalValue=b.value,this._attrValue=b.value,this._dyn=c.parseText(this._attrValue),this._dyn){var d=this;a.mesh().watch(this._dyn.dependencies,function(){d.__updateAttr()},this)}this.updateElement(a.element(),b)},destroy:function(){this._partial&&this._partial.destroy(),this._dyn&&this._node.mesh().unwatch(this._dyn.dependencies,this),k.destroy.call(this)},__inputVal:function(a,b){var c="checkbox"===a.type||"radio"===a.type?"checked":"value";return arguments.length>1&&(b=null===b||void 0===b?"":b,"select-one"===a.type?g.eventually(function(){a[c]=b}):a[c]=b),a[c]},_events:function(){return this.__events||(this.__events=this.auto_destroy(new j)),this.__events},updateElement:function(a,b){this._element=a,b=b||a.attributes[this._attrName],this._attribute=b,this.__updateAttr();var c=this._attrName.split(":");this._partial&&(this._partial.destroy(),this._partial=null),h.partial.get(c[0])&&(this._partial=h.partial.create(c[0],this._node,this._dyn?this._dyn.args:{},this._attrValue,c[1]),this._partial.cls.meta.value_hidden&&(this._attribute.value="")),this._dyn&&(this._dyn.bidirectional&&"value"==this._attrName&&this._events().on(this._element,"change keyup keypress keydown blur focus update input",function(){this._node.mesh().write(this._dyn.variable,this.__inputVal(this._element))},this),this._isEvent&&(this._attribute.value="",this._events().on(this._element,this._attrName.substring(2),function(){var a=this._node._locals.domEvent;this._node._locals.domEvent=arguments,this._node.__executeDyn(this._dyn),this._node&&this._node._locals&&(this._node._locals.domEvent=a)},this)))},__updateAttr:function(){if(this._updatable){var a=this._dyn?this._node.__executeDyn(this._dyn):this._attrValue;if((a!=this._attrValue||d.is_array(a))&&(a||this._attrValue)){var b=this._attrValue;if(this._attrValue=a,!this._partial||!this._partial.cls.meta.value_hidden){var c=i.entitiesToUnicode(a);null===c&&"class"===this._attrName&&(c=""),this._attribute.value=c}this._partial&&this._partial.change(a,b),"value"===this._attrName&&this._element.value!==a&&this.__inputVal(this._element,a),this._tagHandler&&this._dyn&&!this._partial&&this._tagHandler.properties().set(f.first_after(this._attrName,"-"),a)}}},bindTagHandler:function(b){if(this.unbindTagHandler(),this._tagHandler=b,!this._partial&&h.prefixes[f.splitFirst(this._attrName,"-").head]){var c=f.first_after(this._attrName,"-");this._tagHandler.setArgumentAttr(c,a.is_pure_json(this._attrValue)?e.clone(this._attrValue,1):this._attrValue),this._dyn&&this._dyn.bidirectional&&(a.is_pure_json(this._attrValue)?this._tagHandler.properties().bind(c,this._node._handler.properties(),{deep:!0,left:!0,right:!0,secondKey:this._dyn.variable}):this._tagHandler.properties().on("change:"+c,function(a){this._node.mesh().write(this._dyn.variable,a)},this))}else this._partial&&this._partial.bindTagHandler(b)},prepareTagHandler:function(a){this._partial&&this._partial.prepareTagHandler(a)},unbindTagHandler:function(a){this._partial&&this._partial.unbindTagHandler(a),this._tagHandler&&this._tagHandler.properties().off(null,null,this),this._tagHandler=null},activate:function(){if(this._partial){if(this._partial.cls.meta.requires_tag_handler&&!this._tagHandler)return void h.throwException(new b(this._partial.cls.classname,this._node.tag()));this._partial.activate()}},deactivate:function(){this._partial&&this._partial.deactivate()}}})}),a.define("module:Handlers.HandlerMixin",["base:Objs","base:Strings","base:Functions","base:Types","browser:Loader","module:Handlers.Node","module:Registries","module:Handlers.HandlerNameRegistry","browser:DomMutation.NodeRemoveObserver","browser:Dom"],function(a,b,c,d,e,f,g,h,i,j){return{_notifications:{construct:"__handlerConstruct",destroy:"__handlerDestruct"},__handlerConstruct:function(){this.__activated=!1,this._mesh_extend={string:c.as_method(this.string,this)}},__handlerDestruct:function(){a.iter(this.__rootNodes,function(a){var b=a.element();a.destroy(),this.remove_on_destroy&&(b.innerHTML="")},this)},template:null,templateUrl:null,string:function(a){return this.cls.string?this.cls.string(a):this.parent()?this.parent().string(a):a},remove_on_destroy:!1,_handlerInitialize:function(a){a=a||{},a.name_registry&&(this.__nameRegistry=this.auto_destroy(new h)),this.__types=a.types||{},this._parentHandler=a.parentHandler||null,this._parentElement=a.parentElement,this._argumentAttrs={},this.template=a.template||this.template,this.templateUrl=a.templateUrl||this.templateUrl,this.templateUrl&&(this.templateUrl=b.replaceAll(this.templateUrl,"%",b.last_after(this.cls.classname||"",".").toLowerCase())),this.__elements=a.element?[j.unbox(a.element)]:[],this.initialContent=j.unbox(a.element?a.element:this._parentElement).innerHTML,this.__activeElement=a.element?j.unbox(a.element):j.unbox(this._parentElement),a.remove_observe&&(this.__removeObserver=this.auto_destroy(i.create(this.__activeElement)),this.__removeObserver.on("node-removed",function(){this.weakDestroy()},this)),this.__activeElement.dynamicshandler=this},_handlerInitializeTemplate:function(a,b){var c=g.templates.create(a);this.__elements.length>0?(this.__activeElement=this.__elements[0],this.__elements[0].innerHTML="",c.forEach(function(a){this.__elements[0].appendChild(a)},this)):b?(this.__activeElement=j.unbox(b),this.__elements=c,this.__activeElement.innerHTML="",c.forEach(function(a){this.__activeElement.appendChild(a)},this)):(this.__elements=c,this.__activeElement=this.__elements[0].parentNode)},nameRegistry:function(){return this.__nameRegistry||(this.parent()?this.parent().nameRegistry():null)},byName:function(a){return this.nameRegistry().get(a)},__assocs:{},addAssoc:function(a,b){this.__assocs[a]=b},removeAssoc:function(a){delete this.__assocs[a]},activated:function(){return this.__activated},assoc:function(a){return this.byName(this.__assocs[a]||a)},setArgumentAttr:function(b,c){b in this.__extendables&&(c=a.tree_extend(this.properties().get(b)||{},c)),this.__types[b]&&(c=d.parseType(c,this.__types[b])),this.properties().set(b,c),this._argumentAttrs[b]=!0},isArgumentAttr:function(a){return!!this._argumentAttrs[a]},activeElement:function(){return this.__activeElement},element:function(){return this.__elements},_updateActiveElement:function(a){this.__activeElement=j.unbox(a),this.__removeObserver&&(this.__removeObserver.weakDestroy(),this.__removeObserver=this.auto_destroy(i.create(this.__activeElement)),this.__removeObserver.on("node-removed",function(){this.weakDestroy()},this))},activate:function(){if(!this.__activated){if(this.__activated=!0,this.template)this._handlerInitializeTemplate(this.template,this._parentElement);else if(this.templateUrl)return this.__activated=!1,void e.loadHtml(this.templateUrl,function(a){this.templateUrl=null,this.template=a,this.activate()},this);if(this._notify("_activate"),this.__rootNodes=[],this.__elements.forEach(function(a){this.__rootNodes.push(new f(this,null,a))},this),this._preAfterActivate(this.__activeElement),this._afterActivate(this.__activeElement),this.__activeElement.dynamicshandlerpromise){this.__activeElement.dynamicshandlerpromise.forEach(function(a){a.asyncSuccess(this.__activeElement.dynamicshandler)},this),this.__activeElement.dynamicshandlerpromise=null;try{delete this.__activeElement.dynamicshandlerpromise}catch(a){}}}},_afterActivate:function(a){}}}),a.define("module:Handlers.Handler",["base:Class","module:Handlers.HandlerMixin","base:Properties.Properties","module:Registries"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b){a.constructor.call(this),b=b||{},this._properties=b.properties?b.properties:new c,this.functions={},this._handlerInitialize(b)},properties:function(){return this._properties}}}],{register:function(a,b){b=b||d.handler,b.register(a,this)}})}),a.define("module:Handlers.Partial",["base:Class","base:JavaScript","base:Functions","module:Parser","module:Registries"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{constructor:function(b,c,d,e){a.constructor.call(this),this._node=b,this._args=c,this._value=d,this._active=!1,this._postfix=e},change:function(a,b){this._value=a,this._change(a,b),this._apply(a,b)},activate:function(){this._active||(this._active=!0,this._activate(),this._apply(this._value,null))},deactivate:function(){this._active&&(this._active=!1,this._deactivate())},bindTagHandler:function(a){},unbindTagHandler:function(a){},prepareTagHandler:function(a){},_change:function(a,b){},_activate:function(){},_deactivate:function(){},_apply:function(a,b){},_execute:function(a){var b=d.parseCode(a||this._value);this._node.__executeDyn(b)},_valueExecute:function(a){var d=this._value.trim();b.isProperIdentifier(d)?(a=c.getArguments(a),a.unshift(d),this._node._handler.execute.apply(this._node._handler,a)):this._execute(d)}}},{meta:{},register:function(a,b){b=b||e.partial,b.register(a,this)}})}),a.define("module:Handlers.HandlerNameRegistry",["base:Class","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{__handlers:{},destroy:function(){b.iter(this.__handlers,function(a,b){this.unregister(b)},this),a.destroy.call(this)},register:function(a,b){this.unregister(b),this.__handlers[b]=a,a.on("destroy",function(){this.unregister(b)},this)},unregister:function(a){if(a in this.__handlers){var b=this.__handlers[a];delete this.__handlers[a],b.destroyed()||b.off(null,null,this)}},get:function(a){return this.__handlers[a]}}})}),a.define("module:Handlers.Node",["base:Class","base:Events.EventsMixin","base:Ids","browser:Dom","browser:Info","module:Parser","module:Data.Mesh","base:Objs","base:Types","module:Registries","module:Handlers.Attr"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m;return m=a.extend({scoped:l},[b,function(a){return{constructor:function(b,d,e,i){if(a.constructor.call(this),this._handler=b,this._parent=d,d&&(d._children[c.objectId(this)]=this),this._element=e,this._tag=e.tagName?e.tagName.toLowerCase():"",this._tag.indexOf(":")>=0&&(this._tag=this._tag.substring(this._tag.indexOf(":")+1)),this._dynTag=f.parseText(this._tag),this._tagHandler=null,this._template=e.outerHTML,this._innerTemplate=e.innerHTML,this._locals=i||{},this._active=!0,this._dyn=null,this._children={},this._locked=!0,this._attrs={},this._expandChildren=!0,this._touchedInner=!1,this._mesh=new g([window,this.properties(),this._locals,this._handler.functions,this._handler._mesh_extend],this._handler,{read:this.properties(),write:this.properties(),watch:this.properties()}),this._element.attributes){for(var j=[],k=0;k<this._element.attributes.length;++k)j.push(this._element.attributes[k]);h.iter(j,this._registerAttr,this)}this._locked=!1,this._active=!this._active,this._active?this.deactivate():this.activate()},destroy:function(){h.iter(this._attrs,function(a){a.destroy()}),this._removeChildren(),this._tagHandler&&!this._tagHandler.destroyed()&&(this._tagHandler.cacheable&&this._tagHandler.cls.cacheable?j.handlerCache.suspend(this._tagHandler,this._element):this._tagHandler.weakDestroy()),this._dyn&&this.properties().off(null,null,this._dyn),this._parent&&delete this._parent._children[c.objectId(this)],this._mesh.destroy(),a.destroy.call(this)},_registerAttr:function(a){a.name in this._attrs?this._attrs[a.name].updateAttribute(a):this._attrs[a.name]=new k(this,a)},tag:function(){return this._tag},element:function(){return this._element},__dynOff:function(a){this._mesh.unwatch(a.dependencies,a)},__dynOn:function(a,b){var c=this;this._mesh.watch(a.dependencies,function(){b.apply(c)},a)},mesh:function(){return this._mesh;
},__executeDyn:function(a,b){return i.is_object(a)?this._mesh.execute(a.dependencies,a.func,b):a},__tagValue:function(){return this._dynTag?this.__executeDyn(this._dynTag,!0):this._tag},__unregisterTagHandler:function(){this._tagHandler&&(h.iter(this._attrs,function(a){a.unbindTagHandler(this._tagHandler)},this),this.off(null,null,this._tagHandler),this._tagHandler.cacheable&&this._tagHandler.cls.cacheable?j.handlerCache.suspend(this._tagHandler,this._element):this._tagHandler.weakDestroy(),this._tagHandler=null)},__registerTagHandler:function(){this.__unregisterTagHandler();var a=this.__tagValue();if(a){if(this._dynTag&&this._element.tagName.toLowerCase()!=a.toLowerCase()&&(this._element=d.changeTag(this._element,a),h.iter(this._attrs,function(a){a.updateElement(this._element)},this)),!j.handler.get(a))return!1;if(e.isInternetExplorer()&&e.internetExplorerVersion()<9){var b=this._element===this._handler.activeElement();this._element=d.changeTag(this._element,a),h.iter(this._attrs,function(a){a.updateElement(this._element)},this),b&&this._handler._updateActiveElement(this._element)}var c={parentElement:this._element,parentHandler:this._handler,autobind:!1,cacheable:!1,tagName:a};if(h.iter(this._attrs,function(a){a.prepareTagHandler(c)},this),!c.ignoreTagHandler)return c.cacheable&&(this._tagHandler=j.handlerCache.resume(a,this._element,this._handler)),this._tagHandler||(this._tagHandler=j.handler.create(a,c)),h.iter(this._handler.inheritables,function(a){this._tagHandler.set(a,this._handler.get(a))},this),h.iter(this._attrs,function(a){a.bindTagHandler(this._tagHandler)},this),this._tagHandler.activate(),!0}},activate:function(){if(!this._locked&&!this._active){this._locked=!0,this._active=!0,this._dynTag&&this.__dynOn(this._dynTag,function(){this.__registerTagHandler()});var a=this.__registerTagHandler();if(!a&&this._expandChildren){this._restoreInnerTemplate&&(this._element.innerHTML=this._innerTemplate),this._touchedInner=!0,3==this._element.nodeType&&(this._dyn=f.parseText(this._element.textContent||this._element.innerText||this._element.nodeValue),this._dyn&&this.__dynOn(this._dyn,function(){this.__updateDyn()})),this.__updateDyn(!0);for(var b=0;b<this._element.childNodes.length;++b)this._element.childNodes[b]["ba-handled"]||this._registerChild(this._element.childNodes[b])}h.iter(this._attrs,function(a){a.activate()}),this._locked=!1}},__updateDyn:function(a){if(this._dyn){var b=this.__executeDyn(this._dyn);if(a||b!=this._dyn.value){this._dyn.value=b;var c=d.entitiesToUnicode(null===b?"":b);"textContent"in this._element&&(this._element.textContent=c),"innerText"in this._element&&(this._element.innerText=c),e.isInternetExplorer()&&e.internetExplorerVersion()<9&&"data"in this._element&&(this._element.data=c)}}},_registerChild:function(a,b){return new m(this._handler,this,a,h.extend(h.clone(this._locals,1),b))},_removeChildren:function(){h.iter(this._children,function(a){a.destroy()})},deactivate:function(){this._active&&(this._active=!1,this._locked||(this._locked=!0,h.iter(this._attrs,function(a){a.deactivate()}),this._removeChildren(),this._dynTag&&this.__dynOff(this._dynTag),this.__unregisterTagHandler(),this._dyn&&(this.__dynOff(this._dyn),this._dyn=null),this._touchedInner&&(this._element.innerHTML=""),this._restoreInnerTemplate=!0,this._locked=!1))},properties:function(){return this._handler.properties()}}}])}),a.define("module:Registries",["base:Classes.ClassRegistry","base:Exceptions.AsyncExceptionThrower","browser:Dom"],function(a,b,c){return{handler:new a({},!0),partial:new a({},!0),prefixes:{ba:!0},templates:{cache:{},create:function(a){a=a.trim();var b=this.cache[a];return b||(b=0===a.indexOf("<")?c.elementsByTemplate(a):[document.createTextNode(a)],this.cache[a]=b),b.map(function(a){return a.cloneNode(!0)})}},throwException:function(a){try{this.exceptionThrower||(this.exceptionThrower=new b),this.exceptionThrower.throwException(a)}catch(c){}},handlerCache:{cache:{},cacheDom:null,suspend:function(a,b){b=c.unbox(b),this.cacheDom||(this.cacheDom=document.createElement("div"),this.cacheDom.setAttribute("ba-ignore",""),this.cacheDom.style.display="none",document.body.appendChild(this.cacheDom));var d=a.data("tagname");this.cache[d]=this.cache[d]||[];for(var e=[],f=0;f<b.children.length;++f)e.push(b.children[f]);this.cache[d].push({handler:a,elements:e}),e.forEach(function(a){this.cacheDom.appendChild(a)},this)},resume:function(a,b,d){if(b=c.unbox(b),!this.cache[a]||0===this.cache[a].length)return null;var e=this.cache[a].shift();return b.innerHTML="",e.elements.forEach(function(a){b.appendChild(a)}),e.handler._handlerInitialize({parentHandler:d,parentElement:b}),e.handler}}}}),a.define("module:Partials.AssocPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d,e){a.constructor.apply(this,arguments),this._node._handler.addAssoc(e,d)},destroy:function(){this._node._handler.removeAssoc(this._postfix),a.destroy.call(this)}}});return c.register("ba-assoc"),c}),a.define("module:Partials.AttrsPartial",["module:Handlers.Partial","base:Objs","base:Class"],function(a,b,c,d){var e=a.extend({scoped:d},{_apply:function(a){if(this._active){var b=this._node._tagHandler?this._node._tagHandler.properties():this._node.properties();for(var c in a)b.set(c,a[c])}},bindTagHandler:function(a){for(var d in this._value)a.setArgumentAttr(d,c.is_pure_json(this._value[d])?b.clone(this._value[d],1):this._value[d])}});return e.register("ba-attrs"),e}),a.define("module:Partials.CachePartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},{bindTagHandler:function(a){a.cacheable=!0},prepareTagHandler:function(a){a.cacheable=!0}},{meta:{requires_tag_handler:!0}});return c.register("ba-cache"),c}),a.define("module:Partials.ClassPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},{_apply:function(a){for(var b in a){var c=this._node.element().className,d=c.indexOf(b)>=0;a[b]!==d&&(a[b]?c+=" "+b:c=c.replace(b,"").replace("  "," "),this._node.element().className=c.trim())}}});return c.register("ba-class"),c}),a.define("module:Partials.ClickPartial",["module:Handlers.Partial","browser:Events"],function(a,b,c){var d=a.extend({scoped:c},function(a){return{constructor:function(c,d,e){a.constructor.apply(this,arguments);var f=this.auto_destroy(new b);f.on(this._node.element(),"click",function(a){a.stopPropagation(),this._execute()},this)}}});return d.register("ba-click"),d}),a.define("module:Partials.DataPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},{_apply:function(a){this._node._tagHandler.data(this._postfix,a)},bindTagHandler:function(a){this._apply(this._value)}},{meta:{requires_tag_handler:!0}});return c.register("ba-data"),c}),a.define("module:Partials.EventPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},{bindTagHandler:function(a){a.on(this._postfix,function(){this._valueExecute(arguments)},this)}});return c.register("ba-event"),c}),a.define("module:Partials.FunctionsPartial",["module:Handlers.Partial","browser:Info","base:Objs"],function(a,b,c,d){var e=a.extend({scoped:d},function(a){return{bindTagHandler:function(a){c.extend(a.__functions,this._value)}}});return e.register("ba-functions"),e}),a.define("module:Partials.GcPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{bindTagHandler:function(a){this._value&&a.enableGc(this._value)}}});return c.register("ba-gc"),c}),a.define("module:Partials.IfPartial",["module:Partials.ShowPartial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments),d||b.deactivate()},_apply:function(b){a._apply.call(this,b),b?this._node.activate():this._node.deactivate()}}});return c.register("ba-if"),c}),a.define("module:Partials.IgnorePartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments),b.deactivate()}}});return c.register("ba-ignore"),c}),a.define("module:Partials.InnerTemplatePartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments),b._element.innerHTML=d}}},{meta:{value_hidden:!0}});return c.register("ba-inner-template"),c}),a.define("module:Partials.NoScopePartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{prepareTagHandler:function(a){a.properties=this._node.properties()}}});return c.register("ba-noscope"),c}),a.define("module:Partials.OnPartial",["module:Handlers.Partial","browser:Events"],function(a,b,c){var d=a.extend({scoped:c},function(a){return{constructor:function(c,d,e,f){a.constructor.apply(this,arguments);var g=this.auto_destroy(new b);g.on(this._node._element,f.trim(),function(){this._execute(e.trim())},this)}}});return d.register("ba-on"),d}),a.define("module:Partials.PropPartial",["module:Handlers.Partial"],function(a,b,c){var d=a.extend({scoped:c},function(a){return{_apply:function(a){this._node.element()[this._postfix]=a}}});return d.register("ba-prop"),d}),a.define("module:Partials.RadioGroupPartial",["module:Handlers.Partial","browser:Events"],function(a,b,c){var d=a.extend({scoped:c},function(a){return{constructor:function(c,d,e){a.constructor.apply(this,arguments);var f=this.auto_destroy(new b);e=e.trim(),this._node.element().checked=this._node.element().value===this._node.properties().get(e),f.on(this._node.element(),"click change",function(){this._node.properties().set(e,this._node.element().value)},this),this._node.properties().on("change:"+e,function(){this._node.element().checked=this._node.element().value===this._node.properties().get(e)},this)}}});return d.register("ba-radio-group"),d}),a.define("module:Partials.RegisterPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{bindTagHandler:function(a){a.nameRegistry().register(a,this._value)},unbindTagHandler:function(a){a&&a.nameRegistry().unregister(this._value)}}});return c.register("ba-register"),c}),a.define("module:Partials.RepeatElementPartial",["module:Partials.RepeatPartial","base:Collections.Collection","base:Collections.FilteredCollection","base:Objs","module:Parser","base:Properties.Properties","browser:Dom"],function(a,b,c,d,e,f,g,h){var i=a.extend({scoped:h},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments);var e=g.elementByTemplate(b._template);e.removeAttribute("ba-repeat-element"),this.__filteredTemplate=e.outerHTML.trim()},_activate:function(){this._node.element().style.display="none",a._activate.call(this)},_iterateCollection:function(a){for(var b=this._collection.iterator().asArray(),c=b.length-1;c>=0;--c)a.call(this,b[c])},_newItemElements:function(){var a=g.elementByTemplate(this.__filteredTemplate);return this._node.element().parentNode.insertBefore(a,this._node.element().nextSibling),a["ba-handled"]=!0,[a]},prepareTagHandler:function(a){a.ignoreTagHandler=!0}}});return i.register("ba-repeat-element"),i}),a.define("module:Partials.RepeatPartial",["module:Handlers.Partial","base:Promise","base:Properties.Properties","base:Collections.Collection","base:Collections.FilteredCollection","base:Objs","module:Parser","module:Registries"],function(a,b,c,d,e,f,g,h,i){var j=a.extend({scoped:i},function(a){return{constructor:function(b,c,d){if(a.constructor.apply(this,arguments),this.__registered=!1,c=c.split("::"),c.length>1&&(this.__dynOpts=g.parseCode(c[0].trim())),c=c[c.length-1],c=c.split("~"),this.__repeatArg=c[0].trim(),this._destroyCollection=!1,this._destroyValueCollection=!1,c.length>1){this.__repeatFilter=g.parseCode(c[1].trim());var e=this;b.mesh().watch(this.__repeatFilter.dependencies,function(){e.__filterChanged()},this.__repeatFilter)}b._expandChildren=!1;try{b._element.innerHTML=""}catch(f){}},destroy:function(){this.__unregister(),this.__repeatFilter&&this._node.mesh().unwatch(this.__repeatFilter.dependencies,this.__repeatFilter),a.destroy.call(this)},_activate:function(){this.__register(),this.__dynOpts&&(this.__dynOptsCache=this._node.mesh().execute(this.__dynOpts.dependencies,this.__dynOpts.func))},_deactivate:function(){this.__unregister()},__filterChanged:function(){this._active&&this._collection.setFilter(this.__filterFunc,this)},_change:function(a,b){this.__register(a)},__filterFunc:function(a){var b=this.__repeatFilter;if(!b)return!0;var c=this;return this._node.mesh().execute(b.dependencies,function(d){return d[c.__repeatArg]=c._isArray?a.get("value"):a.data(),b.func.call(this,d)},!0)},_iterateCollection:function(a){this._collection.iterate(a,this)},__register:function(){this.__unregister(),this._isArray=!d.is_instance_of(this._value),this._destroyValueCollection=!d.is_instance_of(this._value),this._valueCollection=this._destroyValueCollection?new d({objects:f.map(this._value,function(a){return new c({value:a})}),release_references:!0}):this._value,this._destroyCollection=!!this.__repeatFilter,this._collection=this._destroyCollection?new e(this._valueCollection,{filter:this.__filterFunc,context:this}):this._valueCollection,this._collectionChildren={},this._iterateCollection(this.__addItem),this._collection.on("add",this.__addItem,this),this._collection.on("remove",this.__removeItem,this),this._collection.on("reindexed",function(a){if(!(this._collection.count()<2)){var b=this._collection.getIndex(a);0===b?this._prependItem(this._collection.getByIndex(1),a):this._appendItem(this._collection.getByIndex(b-1),a)}},this)},__unregister:function(){if(this._collection){this._iterateCollection(this.__removeItem);var a=this._node._element;this._node._removeChildren(),a.innerHTML="",this._collection.off(null,null,this),this._valueCollection.off(null,null,this),this._destroyCollection&&this._collection.destroy(),this._destroyValueCollection&&this._valueCollection.destroy(),this._valueCollection=null,this._collection=null}},__addItem:function(a){if(!this._collectionChildren[a.cid()]){var b={};this.__repeatArg&&(b[this.__repeatArg]=this._isArray?a.get("value"):a);var c=[],d=this._newItemElements();d.forEach(function(a){c.push(this._node._registerChild(a,b))},this),this._collectionChildren[a.cid()]={item:a,nodes:c};var e=this._collection.getIndex(a);e<this._collection.count()-1&&this._prependItem(this._collection.getByIndex(e+1),a)}},__removeItem:function(a){this._collectionChildren[a.cid()]&&(f.iter(this._collectionChildren[a.cid()].nodes,function(c){var d=c.element(),e=b.create();this.__dynOptsCache&&this.__dynOptsCache.onremove?this.__dynOptsCache.onremove.call(this._handler,a,d).forwardCallback(e):e.asyncSuccess(!0),e.success(function(){c.destroy(),d.parentNode&&d.parentNode.removeChild(d)})},this),delete this._collectionChildren[a.cid()])},_itemData:function(a){return this._collectionChildren[a.cid()]},_itemDataElements:function(a){var b=this._itemData(a);if(!b)return null;var c=[];return f.iter(b.nodes,function(a){c.push(a.element())}),c},_prependItem:function(a,b){var c=this._itemDataElements(a),d=this._itemDataElements(b);c&&d&&f.iter(d,function(a){a.parentNode.insertBefore(a,c[0])})},_appendItem:function(a,b){var c=this._itemDataElements(a),d=this._itemDataElements(b);if(c&&d){var e=c[c.length-1];f.iter(d,function(a){e.parentNode.insertBefore(a,e.nextSibling),e=a})}},_newItemElements:function(){var a=h.templates.create(this._node._innerTemplate),b=this._node.element();return a.forEach(function(a){b.appendChild(a)}),a}}});return j.register("ba-repeat"),j}),a.define("module:Partials.ReturnPartial",["module:Handlers.Partial","browser:Events"],function(a,b,c){var d=a.extend({scoped:c},function(a){return{constructor:function(c,d,e){a.constructor.apply(this,arguments);var f=this.auto_destroy(new b);f.on(this._node._element,"keypress",function(a){13===a.which&&this._execute()},this)}}});return d.register("ba-return"),d}),a.define("module:Partials.ShareScopePartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{bindTagHandler:function(a){a.properties().bind("",this._value?this._value:this._node.properties(),{deep:!0})}}});return c.register("ba-sharescope"),c}),a.define("module:Partials.ShowPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments),this.__oldDisplay=void 0,this.__readOldDisplay=!1,this.__hidden=!1,d||this.__hide()},__hide:function(){this.__hidden||(this.__hidden=!0,this.__readOldDisplay||(this.__oldDisplay=this._node._element.style.display,this.__readOldDisplay=!0),this._node._element.style.display="none")},__show:function(){this.__hidden&&(this.__hidden=!1,this._node._element.style.display=this.__oldDisplay&&"none"!==this.__oldDisplay?this.__oldDisplay:"")},_apply:function(a){a?this.__show():this.__hide()}}});return c.register("ba-show"),c}),a.define("module:Partials.StylesPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},{_apply:function(a){for(var b in a)this._node._element.style[b]=a[b]}});return c.register("ba-styles"),c}),a.define("module:Partials.TapPartial",["module:Handlers.Partial","browser:Info","browser:Events"],function(a,b,c,d){var e=a.extend({scoped:d},function(a){return{constructor:function(d,e,f,g){a.constructor.apply(this,arguments);var h=this.auto_destroy(new c);g=g?g.trim():"";var i=b.isMobile()?g?"touch"+g:"touchstart":"click";h.on(this._node._element,i,function(a){a.stopPropagation(),this._execute()},this)}}});return e.register("ba-tap"),e}),a.define("module:Partials.TemplatePartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},{bindTagHandler:function(a){this._value&&(a.template=this._value)}},{meta:{requires_tag_handler:!0,value_hidden:!0}});return c.register("ba-template"),c}),a.define("module:Partials.TemplateUrlPartial",["module:Handlers.Partial","browser:Loader"],function(a,b,c){var d=a.extend({scoped:c},function(a){return{constructor:function(c,d,e){a.constructor.apply(this,arguments),c._expandChildren=!1,c.element().innerHTML="",b.loadHtml(e,function(a){c.element().innerHTML=a;for(var b=c.element().childNodes,d=0;d<b.length;++d)c._registerChild(b[d])},this)}}});return d.register("ba-template-url"),d}),a.define("module:Partials.TogglePartial",["module:Handlers.Partial"],function(a,b){var c={readonly:"readOnly",playsinline:"playsInline"},d=a.extend({scoped:b},function(a){return{constructor:function(b,c,d,e){a.constructor.apply(this,arguments),this._apply(d)},_apply:function(a){this._node.element()[c[this._postfix]||this._postfix]=a?this._postfix:null}}});return d.register("ba-toggle"),d}),a.define("module:Partials.WeakIfPartial",["module:Partials.ShowPartial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments),d||b.deactivate()},_apply:function(b){a._apply.call(this,b),b&&this._node.activate()}}});return c.register("ba-weak-if"),c})}).call(Scoped);