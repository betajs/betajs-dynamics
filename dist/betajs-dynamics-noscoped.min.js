/*!
betajs-dynamics - v0.0.132 - 2019-03-24
Copyright (c) Victor Lingenthal,Oliver Friedmann
Apache-2.0 Software License.
*/

(function(){var e=this.subScope();e.binding("module","global:BetaJS.Dynamics"),e.binding("base","global:BetaJS"),e.binding("browser","global:BetaJS.Browser"),e.define("module:",function(){return{guid:"d71ebf84-e555-4e9b-b18a-11d74fdcefe2",version:"0.0.132",datetime:1553484878414}}),e.assumeVersion("base:version","~1.0.146"),e.assumeVersion("browser:version","~1.0.61"),e.define("module:Data.Friendgroup",["base:Class","base:Types","base:Objs","base:Iterators.ObjectValuesIterator","module:Data.ManualMultiScope"],function(e,i,n,s,r,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this.parent=e,this._registeredScopes={},this._watchScopes={}},destroy:function(){n.iter(this._watchScopes,function(e){e.weakDestroy()}),t.destroy.call(this)},registerScope:function(e,t){this._registeredScopes[t]=this._registeredScopes[t]||{},this._registeredScopes[t][e.cid()]=e,this._watchScopes[t]&&this._watchScopes[t].addScope(e)},unregisterScope:function(e,t){delete this._registeredScopes[t][e.cid()],i.is_empty(this._registeredScopes[t])&&delete this._registeredScopes[t],this._watchScopes[t]&&this._watchScopes[t].removeScope(e)},watchScope:function(e,t){return this._watchScopes[t]||(this._watchScopes[t]=new r(function(){return this.iterateScopes(t)},this)),this._watchScopes[t].increaseRef(e),this._watchScopes[t]},unwatchScope:function(e,t){return this._watchScopes[t]&&(this._watchScopes[t].decreaseRef(e),this._watchScopes[t].destroyed()&&delete this._watchScopes[t]),this},iterateScopes:function(e){return this._registeredScopes[e]||!this.parent?new s(this._registeredScopes[e]||{}):this.parent.iterateScopes(e)}}})}),e.define("module:Data.Mesh",["base:Class","base:Events.EventsMixin","base:Properties.ObservableMixin","base:Objs","base:Types","base:Strings","base:Ids","base:Functions","base:Classes.SharedObjectFactory"],function(e,t,l,h,c,_,s,r,u,i){return e.extend({scoped:i},[t,function(n){return{constructor:function(e,t,i){n.constructor.call(this),this.__environment=e,this.__defaults=i,this.__context=t,this.__watchers={},this.__acquiredProperties={}},destroy:function(){h.iter(this.__watchers,function(e){this.__destroyWatcher(e)},this),h.iter(this.__acquiredProperties,function(e){e.decreaseRef(this)},this),n.destroy.call(this)},watch:function(e,t,i){h.iter(e,function(e){this.__createWatcher(e).cbs[s.objectId(i)]={callback:t,context:i}},this)},unwatch:function(e,i){h.iter(e,function(e){var t=this.__createWatcher(e,!0);t&&(delete t.cbs[s.objectId(i)],this.__destroyWatcher(t,!0))},this)},__destroyWatcher:function(e,t){c.is_string(e)&&(e=this.__watchers[e]),e&&(!t||c.is_empty(e.cbs)&&c.is_empty(e.children))&&(h.iter(e.children,this.__destroyWatcher,this),this.__unbindWatcher(e),e.parent&&delete e.parent.children[e.key],delete this.__watchers[e.expression],e.parent&&c.is_empty(e.parent.cbs)&&c.is_empty(e.parent.children)&&this.__destroyWatcher(e.parent))},__createWatcher:function(e,t){var i=this.__watchers[e];if(i||t)return i;var n=_.splitLast(e,"."),s=n.head?this.__createWatcher(n.head):null;return i={cbs:{},parent:s,key:n.tail,expression:e,children:{},properties:null,propertiesPrefix:null},s&&(s.children[n.tail]=i),this.__watchers[e]=i,this.__bindWatcher(i),i},__unbindWatcher:function(e){e.properties&&e.properties.off(null,null,e),h.iter(e.children,this.__unbindWatcher,this)},__bindWatcher:function(n){for(var e=null,t=this.__environment.length-1;0<=t;--t){var i=this.__environment[t];if((e=this._navigate(i,n.expression)).properties&&!e.tail)break;e=null}if(null===e){var s=this.__defaults.watch||this.__environment[0];(e=this._navigate(s,n.expression)).properties||l.__observable_guid!==s.__observable_guid||(e.properties=s),e.properties||(e=null)}if(null!==e){n.properties=e.properties;var r=e.head+(e.head&&e.tail?".":"")+e.tail;n.propertiesPrefix=r,n.properties.on("change:"+n.propertiesPrefix,function(e,t,i){h.iter(n.children,this.__unbindWatcher,this),h.iter(n.children,this.__bindWatcher,this),(n.value!=e||i)&&(n.value=e,h.iter(n.cbs,function(e){e.callback.apply(e.context)},this))},this);var a=n.properties.get(r);a!=n.value&&(n.value=a,h.iter(n.cbs,function(e){e.callback.apply(e.context)},this)),h.iter(n.children,this.__bindWatcher,this)}},read:function(e){for(var t=this.__environment.length-1;0<=t;--t){var i=this._read(this.__environment[t],e);if(i)return c.is_function(i.value)?r.as_method(i.value,i.context):i.value}return null},write:function(e,t){for(var i=this.__environment.length-1;0<=i;--i)if(this._write(this.__environment[i],e,t,!1))return;this._write(this.__defaults.write||this.__environment[0],e,t,!0)},execute:function(e,t,i){var n={},s=[];h.iter(e,function(e){var t=this.read(e);null===t&&_.splitFirst(e,".").head in window||(s.push(e),n[e]=t)},this);var r=this.__expand(n),a=t.call(this.__context,r);if(!i){var o=this.__collapse(r,s);for(var l in o)l in n&&n[l]==o[l]||this.write(l,o[l])}return a},_sub_navigate:function(e,t,i,n,s){var r={properties:e,head:t,tail:i,parent:n,current:s};if(!i||!s||!c.is_object(s))return r;var a=_.splitFirst(i,"."),o=t?t+"."+a.head:a.head;return u.is_instance_of(s)&&!s.destroyed()&&(s=s.acquire(this),this.__acquiredProperties[s.cid()]=s),l.__observable_guid!==s.__observable_guid||s.destroyed()?a.head in s?this._sub_navigate(e,o,a.tail,s,s[a.head]):r:s.hasKey(a.head)?this._sub_navigate(s,a.head,a.tail,s,s.get(a.head)):a.head in s?this._sub_navigate(e,o,a.tail,s,s[a.head]):{properties:s,head:a.head,tail:a.tail,parent:s,current:null}},_navigate:function(e,t){return this._sub_navigate(null,"",t,null,e)},_read:function(e,t){var i=this._navigate(e,t);return i.tail?null:{value:i.current,context:i.parent==e?this.__context:i.parent}},_write:function(e,t,i,n){var s=this._navigate(e,t);if(s.tail&&!n)return!1;var r=s.tail.split(".");if(s.properties)s.properties.set(s.head+(s.head&&s.tail?".":"")+s.tail,i);else{for(var a=s.current,o=0;o<r.length-1;++o)a[r[o]]={},a=a[r[o]];a[r[r.length-1]]=i}return!0},__expand:function(e){var r={};return h.iter(e,function(e,t){for(var i=r,n=t.split("."),s=0;s<n.length-1;++s)n[s]in i&&c.is_object(i[n[s]])&&null!==i[n[s]]||(i[n[s]]={}),i=i[n[s]];i[n[n.length-1]]=e}),r},__collapse:function(s,e){var r={};return h.iter(e,function(e){for(var t=e.split("."),i=s,n=0;n<t.length;++n)i=i[t[n]];r[e]=i}),r}}}])}),e.define("module:Data.AbstractMultiScope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Properties.ObservableMixin"],function(e,t,i,n,s){return e.extend({scoped:s},[t,i,n,function(t){return{constructor:function(){t.constructor.call(this);for(var e=this.iterator();e.hasNext();)this.delegateEvents(null,e.next())},destroy:function(){for(var e=this.iterator();e.hasNext();)e.next().off(null,null,this);t.destroy.call(this)},set:function(e,t){for(var i=this.iterator();i.hasNext();)i.next().set(e,t);return this},get:function(e){var t=this.iterator();return t.hasNext()?t.next().get(e):null},hasKey:function(e){for(var t=this.iterator();t.hasNext();)if(t.next().hasKey(e))return!0;return!1},setProp:function(e,t){for(var i=this.iterator();i.hasNext();)i.next().setProp(e,t);return this},getProp:function(e){var t=this.iterator();return t.hasNext()?t.next().getProp(e):null},define:function(e,t){for(var i=this.iterator();i.hasNext();)i.next().define(e,t);return this},call:function(e){return this.execute.apply(this,arguments)},execute:function(e){for(var t=this.iterator(),i=null;t.hasNext();){var n=t.next(),s=n.execute.apply(n,arguments);i=i||s}return i},materialize:function(e){return e?this.iterator().next():this.iterator().asArray()},iterator:function(){throw"Abstract"},_addScope:function(e){return this.delegateEvents(null,e),this.trigger("addscope",e),this},_removeScope:function(e){return e.off(null,null,this),this.trigger("removescope",e),this}}}])}),e.define("module:Data.ManualMultiScope",["module:Data.AbstractMultiScope"],function(e,t){return e.extend({scoped:t},function(i){return{constructor:function(e,t){this.__iteratorCallback=e,this.__iteratorContext=t,i.constructor.call(this)},iterator:function(){return this.__iteratorCallback.call(this.__iteratorContext)},addScope:function(e){return this._addScope(e)},removeScope:function(e){return this._removeScope(e)}}})}),e.define("module:Data.MultiScope",["module:Data.AbstractMultiScope","base:Iterators.ArrayIterator"],function(e,t,i){return e.extend({scoped:i},function(n){return{constructor:function(e,t,i){this.__owner=e,this.__base=t,this.__queryStr=i,this.__query=this.auto_destroy(this.__owner.__manager.query(this.__owner,i)),n.constructor.call(this),this.__query.on("add",this._addScope,this),this.__query.on("remove",this._removeScope,this)},iterator:function(){return new t(this.__query.result())},parent:function(){return this.__owner.scope(this.__base,this.__queryStr+"<")},root:function(){return this.__owner.root()},children:function(){return this.__owner.scope(this.__base,this.__queryStr+">")},scope:function(e,t){return arguments.length<2&&(t=this.__queryStr+e,e=this.__base),this.__owner.scope(e,t)},freeze:function(){this.__query.off("add",null,this)}}})}),e.define("module:Parser",["base:Types","base:Objs","base:JavaScript"],function(r,l,h){return{__cache:{},__functions:{},secureMode:!1,compileFunction:function(e){if(!((e=e.trim())in this.__functions)){if(this.secureMode)throw"Dynamics Secure Mode prevents creation of function code '"+e+"'.";this.__functions[e]=new Function("obj","with (obj) { return "+e+"; }")}return this.__functions[e]},registerFunctions:function(e){this.__functions=l.extend(this.__functions,e)},parseText:function(e){if(!e)return null;for(var t=[];e;){var i=e.indexOf("{{"),n=null;if(0===i){for(i=e.indexOf("}}");i+2<e.length&&"}"==e.charAt(i+2);)i++;0<=i?(i+=2,n=this.parseCode(e.substring(2,i-2))):i=e.length}else i<0&&(i=e.length);t.push(n||e.substring(0,i)),e=e.substring(i)}if(1==t.length)return r.is_string(t[0])?null:t[0];var s={};return l.iter(t,function(e){r.is_string(e)||l.iter(e.dependencies,function(e){s[e]=!0})}),{func:function(i){var n=null;return l.iter(t,function(e){var t=r.is_string(e)?e:e.func(i);n=null===n?t:n+t}),n},dependencies:l.keys(s)}},parseCode:function(e){var t=this.__cache[e];if(!t){var i=!1,n=!1,s=!1,r=e;"="===r.charAt(0)?(i=!0,r=r.substring(1)):"-"===r.charAt(0)?(n=!0,r=r.substring(1)):"*"===r.charAt(0)&&(s=!0,r=r.substring(1));var a=r.lastIndexOf("::"),o=null;0<=a&&(o=r.substring(0,a).trim(),r=r.substring(a+2)),t={bidirectional:i,html:n,noentities:s,args:o,variable:i?r:null,func:this.compileFunction(r),dependencies:l.keys(l.objectify(h.extractIdentifiers(r,!0)))},this.__cache[e]=t}return l.clone(t,1)}}}),e.define("module:Data.ScopeManager",["base:Class","base:Trees.TreeNavigator","base:Classes.ObjectIdScopeMixin","base:Trees.TreeQueryEngine"],function(e,t,i,n,s){return e.extend({scoped:s},[t,i,function(t){return{constructor:function(e){t.constructor.call(this),this.__root=e,this.__watchers=[],this.__query=this._auto_destroy(new n(this))},nodeRoot:function(){return this.__root},nodeId:function(e){return e.cid()},nodeParent:function(e){return e.__parent},nodeChildren:function(e){return e.__children},nodeData:function(e){return e.data()},nodeWatch:function(e,t,i){e.on("data",function(){t.call(i,"data")},i),e.on("add",function(e){t.call(i,"addChild",e)},i),e.on("destroy",function(){t.call(i,"remove")},i)},nodeUnwatch:function(e,t,i){e.off(null,null,i)},query:function(e,t){return this.__query.query(e,t)}}}])}),e.define("module:Data.Scope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Classes.ObjectIdMixin","base:Functions","base:Types","base:Strings","base:Objs","base:Ids","base:Properties.Properties","base:Collections.Collection","base:Events.Events","base:Properties.ObservableMixin","module:Data.ScopeManager","module:Data.MultiScope","module:Data.AbstractMultiScope","module:Data.Friendgroup"],function(n,e,t,i,s,r,a,o,l,h,c,_,u,d,p,f,m,g){return n.extend({scoped:g},[e,t,i,u,function(t){return{constructor:function(i){(i=o.extend({functions:{},data:{},parent:null,scopes:{},bind:{},attrs:{},extendables:[],collections:{},computed:{},events:{},channels:{},registerchannels:[],friends:{}},i)).bindings&&(i.bind=o.extend(i.bind,i.bindings)),this._channels={},this.__channelCache={};var e=i.parent;this.__manager=e?e.__manager:this._auto_destroy(new d(this)),t.constructor.call(this),this.__parent=e,this.__root=e?e.root():this,this.__children={},this.__extendables=o.objectify(i.extendables),this.__properties=i.properties||new h,this.__properties.increaseRef(this),this.__properties.on("change",function(e,t,i){this.trigger("change:"+e,t,i)},this),this.__functions=o.map(i.functions,function(e){return r.is_string(e)?s.as_method(this[e],this):e},this),this.__scopes={},this.__data=i.data,o.iter(r.is_function(i.attrs)?i.attrs.call(this):i.attrs,function(e,t){this.__properties.has(t)||this.set(t,e)},this),this.setAll(),o.iter(r.is_function(i.collections)?i.collections.call(this):i.collections,function(e,t){r.is_array(i.collections)&&(t=e,e=[]),(!this.__properties.has(t)||n.is_instance_of(this.__properties.get(t))&&this.__properties.get(t).destroyed())&&this.set(t,this.auto_destroy(new c({objects:e,release_references:!0})))},this),e&&e.__add(this),this.scopes=o.map(i.scopes,function(e){return this.scope(e)},this),o.iter(i.bind,function(e,t){var i=e.indexOf(":");this.bind(this.scope(e.substring(0,i)),t,{secondKey:e.substring(i+1)})},this),o.iter(i.computed,function(e,t){var i=a.splitFirst(t,":");this.__properties.compute(i.head,e,this,i.tail.split(","))},this),o.iter(i.events,function(e,t){this.on(t,e,this)},this),o.iter(i.registerchannels,this.registerChannel,this),o.iter(i.channels,function(e,t){var i=a.splitFirst(t,":");this.channel(i.head)&&this.listenOn(this.channel(i.head),i.tail,e,this)},this),this.friendgroup||!e?this.friendgroup=this.auto_destroy(new m(e?e.friendgroup:null)):this.friendgroup=e.friendgroup,this.friends={},this.__friends=i.friends,o.iter(this.__friends,function(e,t){this.friends[t]=this.friendgroup.watchScope(this,e)},this)},friendgroup:!1,destroy:function(){this.trigger("destroy"),o.iter(this.__friends,function(e){this.friendgroup.unwatchScope(this,e)},this),o.iter(this.__scopes,function(e){e.destroy()}),o.iter(this.__children,function(e){e.destroy()}),this.__properties.decreaseRef(this),this.__parent&&this.__parent.__remove(this),t.destroy.call(this)},__object_id_scope:function(){return this.__manager},__add:function(e){this.__children[e.cid()]=e,this.trigger("add",e)},__remove:function(e){this.trigger("remove",e),delete this.__children[e.cid()]},data:function(e,t){return 0===arguments.length?this.__data:1===arguments.length?this.__data[e]:(this.__data[e]=t,this.trigger("data",e,t),this)},set:function(e,t,i){return this.destroyed()||(e in this.__extendables&&(t=o.tree_extend(this.__properties.get(e)||{},t)),this.__properties.set(e,t,i)),this},setAll:function(e){return this.__properties.setAll(e),this},hasKey:function(e){return this.__properties.hasKey(e)},get:function(e){return this.__properties.get(e)},setProp:function(e,t){return this.__properties.setProp(e,t),this},getProp:function(e){return this.__properties.getProp(e)},define:function(e,t,i){return this.__functions[e]=s.as_method(t,i||this),this},call:function(e){return this.execute.apply(this,arguments)},execute:function(e){var t=s.getArguments(arguments,1);try{return r.is_string(e)?this.__functions[e].apply(this,t):e.apply(this,t)}catch(i){return this.handle_call_exception(e,t,i)}},handle_call_exception:function(e,t,i){throw i},parent:function(){return this.__parent},_eventChain:function(){return this.parent()},registerChannel:function(e){this._channels[e]=this.auto_destroy(new _)},channel:function(e){if(!(e in this.__channelCache)){var t=null;this._channels[e]?t=this._channels[e]:this.__parent&&(t=this.__parent.channel(e)),this.__channelCache[e]=t}return this.__channelCache[e]},root:function(){return this.__root},children:function(){return this.scope(">")},properties:function(){return this.__properties},compute:function(e,t,i){this.properties().compute(e,t,this,i)},scope:function(e,t){if(arguments.length<2&&(t=e,e=this),!t)return e;if(e&&e.instance_of(p)&&(e=e.iterator().next()),!e)return e;var i=l.objectId(e)+"_"+t;return this.__scopes[i]||(this.__scopes[i]=new p(this,e,t)),this.__scopes[i]},bind:function(e,t,i){if(e.instance_of(f)){for(var n=e.iterator();n.hasNext();)this.properties().bind(t,n.next().properties(),i);e.on("addscope",function(e){this.properties().bind(t,e.properties(),i)},this),e.on("removescope",function(e){this.properties().unbind(t,e.properties())},this)}else this.properties().bind(t,e.properties(),i)}}}],{_extender:{functions:function(e,t){return o.extend(o.clone(e,1),t)},friends:function(e,t){return o.extend(o.clone(e,1),t)}}})}),e.define("module:DomObserver",["base:Class","base:Objs","browser:DomMutation.NodeInsertObserver","module:Registries","module:Dynamic","browser:Dom"],function(e,i,n,s,r,a,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),e=e||{},this.__initialRoot=e.root,this.__persistent_dynamics=!!e.persistent_dynamics,this.__allowed_dynamics=e.allowed_dynamics?i.objectify(e.allowed_dynamics):null,this.__forbidden_dynamics=e.forbidden_dynamics?i.objectify(e.forbidden_dynamics):null,this.__ignore_existing=e.ignore_existing,this.__dynamics={},this.__enabled=!1,"enabled"in e&&!e.enabled||this.enable()},enable:function(){this.__enabled||(this.__enabled=!0,this.__root=a.unbox(this.__initialRoot||document.body),this.__ignore_existing||i.iter(s.handler.classes(),this.__registerExisting,this),this.__observer=n.create({root:this.__root,filter:this.__observerFilter,context:this}),this.__observer.on("node-inserted",this.__nodeInserted,this))},disable:function(){this.__enabled&&(this.__enabled=!1,this.__observer.weakDestroy())},__registerExisting:function(e,t){if((!this.__forbidden_dynamics||!this.__forbidden_dynamics[t])&&(!this.__allowed_dynamics||this.__allowed_dynamics[t]))for(var i=this.__root.getElementsByTagName(t.toUpperCase()),n=0;n<i.length;++n){var s=i[n];s.dynamicshandler||this.__nodeInserted(s)}},addAllowedDynamic:function(e){this.__allowed_dynamics=this.__allowed_dynamics||{},this.__allowed_dynamics[e]=!0;var t=s.handler.classes()[e];this.__enabled&&!this.__ignore_existing&&t&&this.__registerExisting(t,e)},destroy:function(){this.disable(),i.iter(this.__dynamics,function(e){e.off(null,null,this),this.__persistent_dynamics||e.weakDestroy()},this),t.destroy.call(this)},__observerFilter:function(e){if(e.dynamicshandler||!e.tagName)return!1;var t=e.tagName.toLowerCase();return!!s.handler.get(t)&&((!this.__forbidden_dynamics||!this.__forbidden_dynamics[t])&&!(this.__allowed_dynamics&&!this.__allowed_dynamics[t]))},__nodeInserted:function(e){var t=new r({element:e,remove_observe:!0});(this.__dynamics[t.cid()]=t).on("destroy",function(){delete this.__dynamics[t.cid()]},this),t.activate()}}},{__singleton:null,activate:function(e){this.__singleton||(this.__singleton=new this(e))}})}),e.define("module:Exceptions.DynamicsCallException",["base:Exceptions.Exception"],function(e,t){return e.extend({scoped:t},function(s){return{constructor:function(e,t,i,n){s.constructor.call(this,"Dynamics Exception in '"+e+"' calling method '"+t+"' : "+n)}}})}),e.define("module:Dynamic",["module:Data.Scope","module:Parser","module:Handlers.HandlerMixin","module:Exceptions.DynamicsCallException","base:Objs","base:Strings","base:Types","base:Functions","base:Promise","base:Events.Events","base:Loggers.LoggableMixin","module:Registries","browser:Dom","browser:Events","base:Class"],function(e,t,i,n,s,r,a,o,l,h,c,_,u,d,p,f){var m;return m=e.extend({scoped:f},[i,c,function(t){return{supportsGc:!0,_notifications:{_activate:"__createActivate"},constructor:function(i){if(this.initial=this.initial||{},i=s.extend(s.clone(this.initial,1),i),this.domevents=s.extend(this.domevents,i.domevents),this.windowevents=s.extend(this.windowevents,i.windowevents),s.iter(this.cls.__initialForward,function(e){e in this&&(e in i?a.is_object(this[e])&&a.is_object(i[e])&&(i[e]=s.extend(s.clone(this[e],1),i[e])):i[e]=this[e])},this),i.typedAttrs&&i.types&&s.iter(i.typedAttrs,function(e,t){i.attrs[t]=i.types[t]?a.parseType(e,i.types[t]):e}),this.__dispose=i.dispose,s.iter(this.object_functions,function(t){this[t]=function(){var e=o.getArguments(arguments);return e.unshift(t),this.execute.apply(this,e)}},this),!i.parent&&i.parentHandler)for(var e=i.parentHandler;e&&!i.parent;)i.parent=e.instance_of(m)?e:null,e=e._parentHandler;t.constructor.call(this,i),this.__references=i.references,s.iter(this.__references,function(e){this.on("change:"+e,function(e,t){t&&p.is_class_instance(t)&&!t.destroyed()&&t.decreaseRef(this),e&&p.is_class_instance(e)&&!e.destroyed()&&e.increaseRef(this)},this);var t=this.get(e);t&&p.is_class_instance(t)&&!t.destroyed()&&t.increaseRef(this)},this),this._channels.global=this.cls.__globalEvents,i.tagName&&(this._tagName=i.tagName,this.data("tagname",this._tagName)),this.functions=this.__functions,this._handlerInitialize(i),this.__createActivate=i.create||function(){},this.dom_events={},this.window_events={},this.__domEvents=new d,this.inheritables=(this.parent()?this.parent().inheritables:[]).concat(this.inheritables||[]),this.friendgroup.registerScope(this,this.cls.registeredName())},handle_call_exception:function(e,t,i){return _.throwException(new n(this.cls.classname,e,t,i)),null},hierarchyName:function(){return(this.parent()?this.parent().hierarchyName()+" > ":"")+this.cls.registeredName()},_preAfterActivate:function(a){this.__domEvents.clear();var o=this;s.iter(this.domevents,function(t,e){var i=e.split(" "),n=[a];1<i.length&&(n=a.querySelectorAll(i[1]));for(var s=function(e){o.execute(t,e,this)},r=0;r<n.length;++r)this.__domEvents.on(n[r],i[0],s)},this),s.iter(this.windowevents,function(t,e){this.__domEvents.on(window,e,function(e){o.execute(t,e,this)})},this)},destroy:function(){this.friendgroup.unregisterScope(this,this.cls.registeredName()),this.free&&this.free(),s.iter(this.__references,function(e){var t=this.get(e);t&&p.is_class_instance(t)&&!t.destroyed()&&t.decreaseRef(this)},this),s.iter(this.__dispose,function(e){var t=this.get(e);this.set(e,null),t&&t.weakDestroy&&t.weakDestroy()},this),this.__domEvents.destroy(),t.destroy.call(this)}}}],{__initialForward:["functions","attrs","extendables","collections","template","create","scopes","bindings","computed","types","events","dispose","channels","registerchannels","references","friends"],__globalEvents:new h,canonicName:function(){return this.classname?r.last_after(this.classname,".").toLowerCase():""},registeredName:function(){return this.__registeredName||"ba-"+this.canonicName()},findByElement:function(e){return e&&(e=u.unbox(e))&&e.dynamicshandler?e.dynamicshandler:null},findByElementPromise:function(e){if(!e)return null;if(!(e=u.unbox(e)))return null;if(e.dynamicshandler)return l.value(e.dynamicshandler);e.dynamicshandlerpromise=e.dynamicshandlerpromise||[];var t=l.create();return e.dynamicshandlerpromise.push(t),t},register:function(e,t){return t=t||_.handler,this.__registeredName=e||this.registeredName(),t.register(this.__registeredName,this),this},registerFunctions:function(e){return t.registerFunctions(e),this},activate:function(e){var t=new this(e||{element:document.body,name_registry:!0});return t.activate(),t},attachStringTable:function(e){return this.__stringTable=e,this},addStrings:function(e){return this.__stringTable.register(e,this.registeredName()),this},string:function(e){var t=null;return this.__stringTable&&(t=this.__stringTable.get(e,this.registeredName())),!t&&this.parent.string&&(t=this.parent.string(e)),t},stringUnicode:function(e){var t=null;return this.__stringTable&&(t=this.__stringTable.get(e,this.registeredName())),!t&&this.parent.string&&(t=this.parent.string(e)),u.entitiesToUnicode(t)},_extender:{events:function(e,t){return s.extend(s.clone(e,1),t)},types:function(e,t){return s.extend(s.clone(e,1),t)},registerchannels:function(e,t){return s.extend(s.clone(e,1),t)},channels:function(e,t){return s.extend(s.clone(e,1),t)},attrs:function(e,t){return a.is_function(e)?a.is_function(t)?function(){return s.extend(e.call(this),t.call(this))}:function(){return s.extend(e.call(this),t)}:a.is_function(t)?function(){return s.extend(s.clone(e,1),t.call(this))}:s.extend(s.clone(e,1),t)},inheritables:function(e,t){return(e||[]).concat(t||[])},dispose:function(e,t){return(e||[]).concat(t||[])},references:function(e,t){return(e||[]).concat(t||[])}}})}),e.define("module:Exceptions.TagHandlerException",["base:Exceptions.Exception"],function(e,t){return e.extend({scoped:t},function(i){return{constructor:function(e,t){i.constructor.call(this,e+" is expecting a tag handler, but no registered tag handler for "+t+" has been found.")}}})}),e.define("module:Handlers.Attr",["base:Class","module:Exceptions.TagHandlerException","module:Parser","base:Types","base:Objs","base:Async","base:Strings","module:Registries","browser:Dom","browser:Events"],function(i,e,r,n,a,o,l,h,c,t,s){return i.extend({scoped:s},function(s){return{constructor:function(e,t,i){if(s.constructor.call(this),this._dataNode=i||e,this._node=e,this._tagHandler=null,this._attrName=t.name,this._isEvent=0===this._attrName.indexOf("on"),this._updatable=!this._isEvent,this._attrValue=t.value,this._dyn=r.parseText(this._attrValue),this._dyn){var n=this;this._dataNode.mesh().watch(this._dyn.dependencies,function(){n.__updateAttr()},this)}this.updateElement(e.element(),t)},destroy:function(){this._partial&&this._partial.destroy(),this._dyn&&this._dataNode.mesh().unwatch(this._dyn.dependencies,this),s.destroy.call(this)},__inputVal:function(e,t){var i="checkbox"===e.type||"radio"===e.type?"checked":"value";return 1<arguments.length&&(t=null===t||t===undefined?"":t,"select-one"===e.type?o.eventually(function(){e[i]=t}):e[i]=t),e[i]},_events:function(){return this.__events||(this.__events=this.auto_destroy(new t)),this.__events},updateElement:function(e,t){this._element=e,t=t||e.attributes[this._attrName],this._attribute=t;var i=l.splitFirst(this._attrName,":");this._partialCls=h.partial.get(i.head),this._partial&&(this._partial.destroy(),this._partial=null),this.__updateAttr(),this._partialCls&&(this._partial=h.partial.create(i.head,this._node,this._dyn?this._dyn.args:{},this._attrValue,i.tail),this._partial.cls.meta.value_hidden&&(this._attribute.value="")),this._dyn&&(this._dyn.bidirectional&&"value"==this._attrName&&this._events().on(this._element,"change keyup keypress keydown blur focus update input",function(){this._dataNode.mesh().write(this._dyn.variable,this.__inputVal(this._element))},this),this._isEvent&&(this._attribute.value="",this._events().on(this._element,this._attrName.substring(2),function(){var e=this._node._locals.domEvent;this._node._locals.domEvent=arguments,this._node.__executeDyn(this._dyn),this._node&&this._node._locals&&(this._node._locals.domEvent=e)},this)))},__updateAttr:function(){if(this._updatable){var e=this._attrValue;if(!this._dyn||this._partialCls&&this._partialCls.manualExecute||(e=this._dataNode.__executeDyn(this._dyn)),(e!=this._attrValue||n.is_array(e))&&(e||this._attrValue)){var t=this._attrValue;if(this._attrValue=e,!this._partial||!this._partial.cls.meta.value_hidden){var i=this._dyn.noentities?e:c.entitiesToUnicode(e);null===i&&"class"===this._attrName&&(i=""),this._attribute.value=i}this._partial&&this._partial.change(e,t),"value"===this._attrName&&this._element.value!==e&&this.__inputVal(this._element,e),this._tagHandler&&this._dyn&&!this._partial&&this._tagHandler.properties().set(h.prefixNormalize(this._attrName),e)}}},bindTagHandler:function(e){if(this.unbindTagHandler(this._tagHandler),this._tagHandler=e,this._partial)this._partial&&this._partial.bindTagHandler(e);else{var t=h.prefixNormalize(this._attrName);t&&(this._tagHandler.setArgumentAttr(t,i.is_pure_json(this._attrValue)?a.clone(this._attrValue,1):this._attrValue),this._dyn&&this._dyn.bidirectional&&(i.is_pure_json(this._attrValue)?this._tagHandler.properties().bind(t,this._node._handler.properties(),{deep:!0,left:!0,right:!0,secondKey:this._dyn.variable}):this._tagHandler.properties().on("change:"+t,function(e){this._dataNode.mesh().write(this._dyn.variable,e)},this)))}},prepareTagHandler:function(e){this._partial&&this._partial.prepareTagHandler(e)},unbindTagHandler:function(e){this._partial&&this._partial.unbindTagHandler(e),this._tagHandler&&this._tagHandler.properties().off(null,null,this),this._tagHandler=null},activate:function(){if(this._partial){if(this._partial.cls.meta.requires_tag_handler&&!this._tagHandler)return void h.throwException(new e(this._partial.cls.classname,this._node.tag()));this._partial.activate()}},deactivate:function(){this._partial&&this._partial.deactivate()}}})}),e.define("module:Handlers.HandlerMixin",["base:Objs","base:Strings","base:Functions","base:Types","browser:Loader","module:Handlers.Node","module:Registries","module:Handlers.HandlerNameRegistry","browser:DomMutation.NodeRemoveObserver","browser:Dom"],function(i,n,e,s,t,r,a,o,l,h){return{_notifications:{construct:"__handlerConstruct",destroy:"__handlerDestruct"},__handlerConstruct:function(){this._inheritableAttributes={},this.__activated=!1,this._mesh_extend={string:e.as_method(this.string,this),stringUnicode:e.as_method(this.stringUnicode,this)}},__handlerDestruct:function(){i.iter(this.__rootNodes,function(e){var t=e.element();e.destroy(),this.remove_on_destroy&&(t.innerHTML="")},this)},template:null,templateUrl:null,string:function(e){return this.cls.string?this.cls.string(e):this.parent()?this.parent().string(e):e},stringUnicode:function(e){return this.cls.stringUnicode?this.cls.stringUnicode(e):this.parent()?this.parent().stringUnicode(e):e},remove_on_destroy:!1,_handlerInitialize:function(e){(e=e||{}).name_registry&&(this.__nameRegistry=this.auto_destroy(new o)),this.__types=e.types||{},this._parentHandler=e.parentHandler||null,this._parentElement=e.parentElement,this._argumentAttrs={},this.template=e.template||this.template,this.templateUrl=e.templateUrl||this.templateUrl,this.templateUrl&&(this.templateUrl=n.replaceAll(this.templateUrl,"%",n.last_after(this.cls.classname||"",".").toLowerCase())),this.__elements=e.element?[h.unbox(e.element)]:[];var t=h.unbox(e.element?e.element:this._parentElement);if(!t)throw this.cls.classname+" requires an existing DOM element to attach to.";this.initialContent=t.innerHTML,this.__activeElement=e.element?h.unbox(e.element):h.unbox(this._parentElement),e.remove_observe&&(this.__removeObserver=this.auto_destroy(l.create(this.__activeElement)),this.__removeObserver.on("node-removed",function(){this.weakDestroy()},this)),this.__activeElement.dynamicshandler=this},_handlerInitializeTemplate:function(e,t){var i=a.templates.create(e);0<this.__elements.length?(this.__activeElement=this.__elements[0],this.__elements[0].innerHTML="",i.forEach(function(e){this.__elements[0].appendChild(e)},this)):t?(this.__activeElement=h.unbox(t),this.__elements=i,this.__activeElement.innerHTML="",i.forEach(function(e){this.__activeElement.appendChild(e)},this)):(this.__elements=i,this.__activeElement=this.__elements[0].parentNode)},nameRegistry:function(){return this.__nameRegistry||(this.parent()?this.parent().nameRegistry():null)},byName:function(e){return this.nameRegistry().get(e)},__assocs:{},addAssoc:function(e,t){this.__assocs[e]=t},removeAssoc:function(e){delete this.__assocs[e]},activated:function(){return this.__activated},assoc:function(e){return this.byName(this.__assocs[e]||e)},setArgumentAttr:function(e,t){e in this.__extendables&&(t=i.tree_extend(this.properties().get(e)||{},t)),this.__types[e]&&(t=s.parseType(t,this.__types[e])),this.properties().set(e,t),this._argumentAttrs[e]=!0},isArgumentAttr:function(e){return!!this._argumentAttrs[e]},activeElement:function(){return this.__activeElement},element:function(){return this.__elements},_updateActiveElement:function(e){this.__activeElement=h.unbox(e),this.__removeObserver&&(this.__removeObserver.weakDestroy(),this.__removeObserver=this.auto_destroy(l.create(this.__activeElement)),this.__removeObserver.on("node-removed",function(){this.weakDestroy()},this))},_deferActivate:function(){return!1},activate:function(){if(!this._deferActivate()&&!this.__activated){if(this.__activated=!0,this.template)this._handlerInitializeTemplate(this.template,this._parentElement);else if(this.templateUrl)return this.__activated=!1,void t.loadHtml(this.templateUrl,function(e){this.templateUrl=null,this.template=e,this.activate()},this);if(this._notify("_activate"),this.__rootNodes=[],this.__elements.forEach(function(e){this.__rootNodes.push(new r(this,null,e))},this),this._preAfterActivate(this.__activeElement),this._afterActivate(this.__activeElement),this.__activeElement.dynamicshandlerpromise){this.__activeElement.dynamicshandlerpromise.forEach(function(e){e.asyncSuccess(this.__activeElement.dynamicshandler)},this),this.__activeElement.dynamicshandlerpromise=null;try{delete this.__activeElement.dynamicshandlerpromise}catch(e){}}this.trigger("dynamic-activated")}},_afterActivate:function(e){},registerInheritableAttribute:function(e,t,i,n){e=a.prefixNormalize(e,!0),this._inheritableAttributes[e]=this._inheritableAttributes[e]||{},this._inheritableAttributes[e][t]={value:i,name:t,node:n}},unregisterInheritableAttribute:function(e,t){e=a.prefixNormalize(e,!0),this._inheritableAttributes[e]&&(delete this._inheritableAttributes[e][t],s.is_empty(this._inheritableAttributes[e])&&delete this._inheritableAttributes[e])},getInheritableAttributes:function(e){return e=a.prefixNormalize(e,!0),i.values(this._inheritableAttributes[e])}}}),e.define("module:Handlers.Handler",["base:Class","module:Handlers.HandlerMixin","base:Properties.Properties","module:Registries"],function(e,t,i,n,s){return e.extend({scoped:s},[t,function(t){return{constructor:function(e){t.constructor.call(this),e=e||{},this._properties=e.properties?e.properties:new i,this.functions={},this._handlerInitialize(e)},properties:function(){return this._properties}}}],{register:function(e,t){(t=t||n.handler).register(e,this)}})}),e.define("module:Handlers.HandlerNameRegistry",["base:Class","base:Objs"],function(e,t,i){return e.extend({scoped:i},function(e){return{__handlers:{},destroy:function(){t.iter(this.__handlers,function(e,t){this.unregister(t)},this),e.destroy.call(this)},register:function(e,t){this.unregister(t),(this.__handlers[t]=e).on("destroy",function(){this.unregister(t)},this)},unregister:function(e){if(e in this.__handlers){var t=this.__handlers[e];delete this.__handlers[e],t.destroyed()||t.off(null,null,this)}},get:function(e){return this.__handlers[e]}}})}),e.define("module:Handlers.Node",["base:Class","base:Events.EventsMixin","base:Ids","browser:Dom","browser:Info","module:Parser","module:Data.Mesh","base:Objs","base:Types","module:Registries","module:Handlers.Attr"],function(e,t,l,s,r,h,c,_,i,n,a,o){var u;return u=e.extend({scoped:o},[t,function(o){return{constructor:function(e,t,i,n){o.constructor.call(this),this._handler=e,(this._parent=t)&&(t._children[l.objectId(this)]=this),this._element=i;try{i&&(i.dynnodehandler=this)}catch(a){}if(this._tag=i.tagName?i.tagName.toLowerCase():"",0<=this._tag.indexOf(":")&&(this._tag=this._tag.substring(this._tag.indexOf(":")+1)),this._dynTag=h.parseText(this._tag),this._tagHandler=null,this._template=i.outerHTML,this._innerTemplate=i.innerHTML,this._locals=n||{},this._active=!0,this._dyn=null,this._children={},this._locked=!0,this._attrs={},this._expandChildren=!0,this._touchedInner=!1,this._mesh=new c([window,this.properties(),this._locals,this._handler.functions,this._handler.friends||{},this._handler._mesh_extend],this._handler,{read:this.properties(),write:this.properties(),watch:this.properties()}),this._element.attributes){for(var s=[],r=0;r<this._element.attributes.length;++r)s.push(this._element.attributes[r]);_.iter(s,this._registerAttr,this)}this._locked=!1,this._active=!this._active,this._active?this.deactivate():this.activate()},destroy:function(){_.iter(this._attrs,function(e){e.destroy()}),this._removeChildren(),this._tagHandler&&!this._tagHandler.destroyed()&&(this._tagHandler.cacheable&&this._tagHandler.cls.cacheable?n.handlerCache.suspend(this._tagHandler,this._element):this._tagHandler.weakDestroy()),this._dyn&&this.properties().off(null,null,this._dyn),this._parent&&delete this._parent._children[l.objectId(this)],this._mesh.destroy(),o.destroy.call(this)},_registerAttr:function(e){e.name in this._attrs?this._attrs[e.name].updateAttribute(e):this._attrs[e.name]=new a(this,e)},tag:function(){return this._tag},element:function(){return this._element},__dynOff:function(e){this._mesh.unwatch(e.dependencies,e)},__dynOn:function(e,t){var i=this;this._mesh.watch(e.dependencies,function(){t.apply(i)},e)},mesh:function(){return this._mesh},__executeDyn:function(e,t){return i.is_object(e)?this._mesh.execute(e.dependencies,e.func,t):e},__tagValue:function(){return this._dynTag?this.__executeDyn(this._dynTag,!0):this._tag},__unregisterTagHandler:function(){this._tagHandler&&(_.iter(this._attrs,function(e){e.unbindTagHandler(this._tagHandler)},this),this.off(null,null,this._tagHandler),this._tagHandler.cacheable&&this._tagHandler.cls.cacheable?n.handlerCache.suspend(this._tagHandler,this._element):this._tagHandler.weakDestroy(),this._tagHandler=null,_.iter(this._handler.getInheritableAttributes(this.__tagValue()),function(e){this._attrs[e.name].weakDestroy(),delete this._attrs[e.name]},this))},__registerTagHandler:function(){this.__unregisterTagHandler();var e=this.__tagValue();if(e){if(this._dynTag&&this._element.tagName.toLowerCase()!=e.toLowerCase()&&(this._element=s.changeTag(this._element,e),_.iter(this._attrs,function(e){e.updateElement(this._element)},this)),!n.handler.get(e))return!1;if(r.isInternetExplorer()&&r.internetExplorerVersion()<9){var t=this._element===this._handler.activeElement();this._element=s.changeTag(this._element,e),_.iter(this._attrs,function(e){e.updateElement(this._element)},this),t&&this._handler._updateActiveElement(this._element)}var i={parentElement:this._element,parentHandler:this._handler,autobind:!1,cacheable:!1,tagName:e};if(_.iter(this._handler.getInheritableAttributes(this.__tagValue()),function(e){this._attrs[e.name]=new a(e.node,e)},this),_.iter(this._attrs,function(e){e.prepareTagHandler(i)},this),!i.ignoreTagHandler)return i.cacheable&&(this._tagHandler=n.handlerCache.resume(e,this._element,this._handler)),this._tagHandler||(this._tagHandler=n.handler.create(e,i)),_.iter(this._handler.inheritables,function(e){this._tagHandler.set(e,this._handler.get(e))},this),_.iter(this._attrs,function(e){e.bindTagHandler(this._tagHandler)},this),this._tagHandler.activate(),!0}},activate:function(){if(!this._locked&&!this._active){if(this._locked=!0,this._active=!0,this._dynTag&&this.__dynOn(this._dynTag,function(){this.__registerTagHandler()}),!this.__registerTagHandler()&&this._expandChildren){this._restoreInnerTemplate&&(this._element.innerHTML=this._innerTemplate),this._touchedInner=!0,3==this._element.nodeType&&(this._dyn=h.parseText(this._element.textContent||this._element.innerText||this._element.nodeValue),this._dyn&&this.__dynOn(this._dyn,function(){this.__updateDyn()})),this.__updateDyn(!0);for(var e=0;e<this._element.childNodes.length;++e)this._element.childNodes[e]["ba-handled"]||this._registerChild(this._element.childNodes[e])}_.iter(this._attrs,function(e){e.activate()}),this._locked=!1}},__updateDyn:function(e){if(this._dyn){var t=this.__executeDyn(this._dyn);if(e||t!=this._dyn.value){this._dyn.value=t;var i=null;if(this._dyn.html&&(i=s.elementByTemplate(t,!0))&&((this._htmlElement||this._element).replaceWith(i),this._htmlElement=i),!i){t=null===t?"":t;var n=this._dyn.noentities?t:s.entitiesToUnicode(t);"textContent"in this._element&&(this._element.textContent=n),"innerText"in this._element&&(this._element.innerText=n),r.isInternetExplorer()&&r.internetExplorerVersion()<9&&"data"in this._element&&(this._element.data=n)}}}},_registerChild:function(e,t){return new u(this._handler,this,e,_.extend(_.clone(this._locals,1),t))},_removeChildren:function(){_.iter(this._children,function(e){e.destroy()})},deactivate:function(){this._active&&(this._active=!1,this._locked||(this._locked=!0,_.iter(this._attrs,function(e){e.deactivate()}),this._removeChildren(),this._dynTag&&this.__dynOff(this._dynTag),this.__unregisterTagHandler(),this._dyn&&(this.__dynOff(this._dyn),this._dyn=null),this._touchedInner&&(this._element.innerHTML=""),this._restoreInnerTemplate=!0,this._locked=!1))},properties:function(){return this._handler.properties()}}}])}),e.define("module:Handlers.Partial",["base:Class","base:JavaScript","base:Functions","base:Strings","module:Parser","module:Registries"],function(e,n,r,a,i,s,t){return e.extend({scoped:t},function(s){return{constructor:function(e,t,i,n){s.constructor.call(this),this._node=e,this._args=t,this._value=i,this._active=!1,this._postfix=n},change:function(e,t){this._value=e,this._change(e,t),this._apply(e,t)},activate:function(){this._active||(this._active=!0,this._activate(),this._apply(this._value,null))},deactivate:function(){this._active&&(this._active=!1,this._deactivate())},bindTagHandler:function(e){},unbindTagHandler:function(e){},prepareTagHandler:function(e){},_change:function(e,t){},_activate:function(){},_deactivate:function(){},_apply:function(e,t){},_execute:function(e){e=e||this._value;var t=i.parseText(e)||i.parseCode(e);this._node.__executeDyn(t)},_valueExecute:function(e){var t=this._value.trim(),i=t;a.starts_with(i,"{{")&&a.ends_with(i,"}}")&&(i=a.strip_end(a.strip_start(i,"{{"),"}}")),n.isProperIdentifier(i)?((e=r.getArguments(e)).unshift(i),this._node._handler.execute.apply(this._node._handler,e)):this._execute(t)}}},{meta:{},canonicName:function(){return this.classname?a.last_after(this.classname,".").toLowerCase():""},registeredName:function(){return this.__registeredName||"ba-"+this.canonicName()},register:function(e,t){t=t||s.partial,this.__registeredName=e||this.registeredName(),t.register(this.__registeredName,this)}})}),e.define("module:Registries",["base:Classes.ClassRegistry","base:Exceptions.AsyncExceptionThrower","browser:Dom","base:Strings"],function(e,i,r,n){return{handler:new e({},!0),partial:new e({},!0),prefixes:{ba:!0},prefixNormalize:function(e,t){var i=n.splitFirst(e||"","-");return this.prefixes[i.head]?i.tail:e},templates:{cache:{},create:function(e){e=e.trim();var t=this.cache[e];return t||(t=0===e.indexOf("<")?r.elementsByTemplate(e):[document.createTextNode(e)],this.cache[e]=t),t.map(function(e){return e.cloneNode(!0)})}},throwException:function(e){try{this.exceptionThrower||(this.exceptionThrower=new i),this.exceptionThrower.throwException(e)}catch(t){}},handlerCache:{cache:{},cacheDom:null,suspend:function(e,t){t=r.unbox(t),this.cacheDom||(this.cacheDom=document.createElement("div"),this.cacheDom.setAttribute("ba-ignore",""),this.cacheDom.style.display="none",document.body.appendChild(this.cacheDom));var i=e.data("tagname");this.cache[i]=this.cache[i]||[];for(var n=[],s=0;s<t.children.length;++s)n.push(t.children[s]);this.cache[i].push({handler:e,elements:n}),n.forEach(function(e){this.cacheDom.appendChild(e)},this)},resume:function(e,t,i){if(t=r.unbox(t),!this.cache[e]||0===this.cache[e].length)return null;var n=this.cache[e].shift();return t.innerHTML="",n.elements.forEach(function(e){t.appendChild(e)}),n.handler._handlerInitialize({parentHandler:i,parentElement:t}),n.handler}}}}),e.define("module:Partials.AssocPartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(s){return{constructor:function(e,t,i,n){s.constructor.apply(this,arguments),this._node._handler.addAssoc(n,i)},destroy:function(){this._node._handler.removeAssoc(this._postfix),s.destroy.call(this)}}});return i.register("ba-assoc"),i}),e.define("module:Partials.AttrsPartial",["module:Handlers.Partial","base:Objs","base:Class"],function(e,i,n,t){var s=e.extend({scoped:t},{_apply:function(e){if(this._active){var t=this._node._tagHandler?this._node._tagHandler.properties():this._node.properties();for(var i in e)t.set(i,e[i])}},bindTagHandler:function(e){for(var t in this._value)e.setArgumentAttr(t,n.is_pure_json(this._value[t])?i.clone(this._value[t],1):this._value[t])}});return s.register("ba-attrs"),s}),e.define("module:Partials.CachePartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},{bindTagHandler:function(e){e.cacheable=!0},prepareTagHandler:function(e){e.cacheable=!0}},{meta:{requires_tag_handler:!0}});return i.register("ba-cache"),i}),e.define("module:Partials.ClassPartial",["module:Handlers.Partial","browser:Dom"],function(e,s,t){var i=e.extend({scoped:t},{_apply:function(e){for(var t in e){var i=s.elementHasClass(this._node.element(),t),n=!!e[t];n!==i&&(n?s.elementAddClass(this._node.element(),t):s.elementRemoveClass(this._node.element(),t))}}});return i.register("ba-class"),i}),e.define("module:Partials.ClickPartial",["module:Handlers.Partial","browser:Events"],function(e,s,t){var i=e.extend({scoped:t},function(n){return{constructor:function(e,t,i){n.constructor.apply(this,arguments),this.auto_destroy(new s).on(this._node.element(),"click",function(e){e.stopPropagation(),this.executeAction()},this)},executeAction:function(){this._execute()}}},{manualExecute:!0});return i.register("ba-click"),i}),e.define("module:Partials.DataPartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},{_apply:function(e){this._node._tagHandler.data(this._postfix,e)},bindTagHandler:function(e){this._apply(this._value)}},{meta:{requires_tag_handler:!0}});return i.register("ba-data"),i}),e.define("module:Partials.DeeperPartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){var t=this._postfix.split(":");e.registerInheritableAttribute(t[0],t[1],this._value,this._node)},unbindTagHandler:function(e){if(e){var t=this._postfix.split(":");e.unregisterInheritableAttribute(t[0],t[1])}}}},{manualExecute:!0});return i.register("ba-deeper"),i}),e.define("module:Partials.EventForwardPartial",["module:Handlers.Partial","base:Functions"],function(e,s,t){var i=e.extend({scoped:t},{bindTagHandler:function(e){e.on("all",function(){var e=arguments[0];if(0!==e.indexOf("change:")){var t=s.getArguments(arguments,1),i=[e],n=this._postfix.trim();n&&(0===n.indexOf("~")?(n=n.substring(1),0===e.indexOf(n)&&(i=[e.substring(n.length+1)])):i=[n+"-"+e]),this._value&&(i=i.concat(this._value)),i=i.concat(t),this._node._handler.trigger.apply(this._node._handler,i)}},this,{off_on_destroyed:!0})},unbindTagHandler:function(e){e&&e.off(null,null,this)}});return i.register("ba-event-forward"),i}),e.define("module:Partials.EventPartial",["module:Handlers.Partial","base:Functions"],function(e,n,t){var i=e.extend({scoped:t},{bindTagHandler:function(e){var t=this._postfix.trim(),i=0===t.indexOf("~");i&&(t=t.substring(1)),e.on(t,function(){if(i){var e=n.getArguments(arguments);e.unshift(this._value||t),this._node._handler.trigger.apply(this._node._handler,e)}else this._valueExecute(arguments)},this)}},{manualExecute:!0});return i.register("ba-event"),i}),e.define("module:Partials.FunctionsPartial",["module:Handlers.Partial","browser:Info","base:Objs"],function(e,t,i,n){var s=e.extend({scoped:n},function(e){return{bindTagHandler:function(e){i.extend(e.__functions,this._value)}}});return s.register("ba-functions"),s}),e.define("module:Partials.GcPartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){this._value&&e.enableGc(this._value)}}});return i.register("ba-gc"),i}),e.define("module:Partials.HotkeyPartial",["module:Handlers.Partial","browser:Events","browser:Hotkeys"],function(e,a,o,t){var i=e.extend({scoped:t},function(r){return{constructor:function(e,t,i){r.constructor.apply(this,arguments);var n=this.auto_destroy(new a),s=this._postfix;n.on(this._node._element,"keydown",function(e){o.handleKeyEvent(s,e)&&this._valueExecute([e])},this)}}},{manualExecute:!0});return i.register("ba-hotkey"),i}),e.define("module:Partials.IfPartial",["module:Partials.ShowPartial"],function(e,t){var i=e.extend({scoped:t},function(n){return{constructor:function(e,t,i){n.constructor.apply(this,arguments),i||e.deactivate()},_apply:function(e){n._apply.call(this,e),e?this._node.activate():this._node.deactivate()}}});return i.register("ba-if"),i}),e.define("module:Partials.IgnorePartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(n){return{constructor:function(e,t,i){n.constructor.apply(this,arguments),e.deactivate()}}});return i.register("ba-ignore"),i}),e.define("module:Partials.InnerTemplatePartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(n){return{constructor:function(e,t,i){n.constructor.apply(this,arguments),e._element.innerHTML=i}}},{meta:{value_hidden:!0}});return i.register("ba-inner-template"),i}),e.define("module:Partials.NoScopePartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(e){return{prepareTagHandler:function(e){e.properties=this._node.properties()}}});return i.register("ba-noscope"),i}),e.define("module:Partials.OnPartial",["module:Handlers.Partial","browser:Events"],function(e,r,t){var i=e.extend({scoped:t},function(s){return{constructor:function(e,t,i,n){s.constructor.apply(this,arguments),this.auto_destroy(new r).on(this._node._element,n.trim(),function(){this._execute(i.trim())},this)}}},{manualExecute:!0});return i.register("ba-on"),i}),e.define("module:Partials.PropPartial",["module:Handlers.Partial"],function(e,t,i){var n=e.extend({scoped:i},function(e){return{_apply:function(e){this._node.element()[this._postfix]=e}}});return n.register("ba-prop"),n}),e.define("module:Partials.RadioGroupPartial",["module:Handlers.Partial","browser:Events"],function(e,r,t){var i=e.extend({scoped:t},function(s){return{constructor:function(e,t,i){s.constructor.apply(this,arguments);var n=this.auto_destroy(new r);i=i.trim(),this._node.element().checked=this._node.element().value===this._node.properties().get(i),n.on(this._node.element(),"click change",function(){this._node.properties().set(i,this._node.element().value)},this),this._node.properties().on("change:"+i,function(){this._node.element().checked=this._node.element().value===this._node.properties().get(i)},this)}}});return i.register("ba-radio-group"),i}),e.define("module:Partials.RegisterPartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){e.nameRegistry().register(e,this._value)},unbindTagHandler:function(e){e&&e.nameRegistry().unregister(this._value)}}});return i.register("ba-register"),i}),e.define("module:Partials.RepeatElementPartial",["module:Partials.RepeatPartial","base:Collections.Collection","base:Collections.FilteredCollection","base:Objs","module:Parser","base:Properties.Properties","browser:Dom"],function(e,t,i,n,s,r,a,o){var l=e.extend({scoped:o},function(s){return{constructor:function(e,t,i){s.constructor.apply(this,arguments);var n=a.elementByTemplate(e._template);n.removeAttribute("ba-repeat-element"),this.__filteredTemplate=n.outerHTML.trim(),this.__alwaysReindexNewItems=!0},_activate:function(){this._node.element().style.display="none",s._activate.call(this)},_iterateCollection:function(e){for(var t=this._collection.iterator().asArray(),i=t.length-1;0<=i;--i)e.call(this,t[i])},_newItemElements:function(){var e=a.elementByTemplate(this.__filteredTemplate);return this._node.element().parentNode.insertBefore(e,this._node.element().nextSibling),e["ba-handled"]=!0,[e]},prepareTagHandler:function(e){e.ignoreTagHandler=!0}}});return l.register("ba-repeat-element"),l}),e.define("module:Partials.RepeatPartial",["module:Handlers.Partial","base:Promise","base:Properties.Properties","base:Collections.Collection","base:Collections.FilteredCollection","base:Objs","base:Classes.SharedObjectFactory","module:Parser","module:Registries"],function(e,a,t,i,n,o,s,l,h,r){var c=e.extend({scoped:r},function(r){return{constructor:function(e,t,i){if(r.constructor.apply(this,arguments),this.__alwaysReindexNewItems=!1,this.__registered=!1,1<(t=t.split("::")).length&&(this.__dynOpts=l.parseCode(t[0].trim())),t=(t=t[t.length-1]).split("~"),this.__repeatArg=t[0].trim(),this._destroyCollection=!1,this._releaseValueCollection=!1,1<t.length){this.__repeatFilter=l.parseCode(t[1].trim());var n=this;e.mesh().watch(this.__repeatFilter.dependencies,function(){n.__filterChanged()},this.__repeatFilter)}e._expandChildren=!1;try{e._element.innerHTML=""}catch(s){}},destroy:function(){this.__unregister(),this.__repeatFilter&&this._node.mesh().unwatch(this.__repeatFilter.dependencies,this.__repeatFilter),r.destroy.call(this)},_activate:function(){this.__register(),this.__dynOpts&&(this.__dynOptsCache=this._node.mesh().execute(this.__dynOpts.dependencies,this.__dynOpts.func))},_deactivate:function(){this.__unregister()},__filterChanged:function(){this._active&&this._collection.setFilter(this.__filterFunc,this)},_change:function(e,t){this.__register(e)},__filterFunc:function(t){var i=this.__repeatFilter;if(!i)return!0;var n=this;return this._node.mesh().execute(i.dependencies,function(e){return e[n.__repeatArg]=n._isArray?t.get("value"):t.data(),i.func.call(this,e)},!0)},_iterateCollection:function(e){this._collection.iterate(e,this)},__register:function(){this.__unregister(),i.is_instance_of(this._value)&&this._value.destroyed()||(s.is_instance_of(this._value)?(this._isArray=!1,this._releaseValueCollection=!0,this._valueCollection=this._value.acquire()):(this._isArray=!i.is_instance_of(this._value),this._releaseValueCollection=!i.is_instance_of(this._value),this._valueCollection=this._releaseValueCollection?new i({objects:o.map(this._value,function(e){return new t({value:e})}),release_references:!0}):this._value),this._destroyCollection=!!this.__repeatFilter,this._collection=this._destroyCollection?new n(this._valueCollection,{filter:this.__filterFunc,context:this}):this._valueCollection,this._collectionChildren={},this._iterateCollection(this.__addItem),this._collection.on("add",this.__addItem,this),this._collection.on("remove",function(e){this.__removeItem(e,this._collection.bulkOperationInProgress())},this),this._collection.on("reindexed",function(e){if(!(this._collection.count()<2)){var t=this._collection.getIndex(e);0===t?this._prependItem(this._collection.getByIndex(1),e):this._appendItem(this._collection.getByIndex(t-1),e)}},this))},__unregister:function(){this._collection&&!this._collection.destroyed()&&this._iterateCollection(function(e){this.__removeItem(e,!0)},this);var e=this._node._element;this._node._removeChildren(),e.innerHTML="",this._collection&&!this._collection.destroyed()&&this._collection.off(null,null,this),this._valueCollection&&!this._valueCollection.destroyed()&&this._valueCollection.off(null,null,this),this._destroyCollection&&this._collection&&this._collection.weakDestroy(),this._releaseValueCollection&&this._valueCollection&&!this._valueCollection.destroyed()&&this._valueCollection.decreaseRef(),this._valueCollection=null,this._collection=null},__addItem:function(e){if(!this._collectionChildren[e.cid()]){var t={};this.__repeatArg&&(t[this.__repeatArg]=this._isArray?e.get("value"):e);var i=[];this._newItemElements().forEach(function(e){i.push(this._node._registerChild(e,t))},this),this._collectionChildren[e.cid()]={item:e,nodes:i};var n=this._collection.getIndex(e);n<this._collection.count()-1?this._prependItem(this._collection.getByIndex(n+1),e):this.__alwaysReindexNewItems&&1<this._collection.count()&&this._appendItem(this._collection.getByIndex(n-1),e)}},__removeItem:function(n,s){this._collectionChildren[n.cid()]&&(o.iter(this._collectionChildren[n.cid()].nodes,function(e){var t=e.element(),i=a.create();this.__dynOptsCache&&this.__dynOptsCache.onremove&&!s?this.__dynOptsCache.onremove.call(this._handler,n,t).forwardCallback(i):i.asyncSuccess(!0),i.success(function(){e.weakDestroy(),t.parentNode&&t.parentNode.removeChild(t)})},this),delete this._collectionChildren[n.cid()])},_itemData:function(e){return this._collectionChildren[e.cid()]},_itemDataElements:function(e){var t=this._itemData(e);if(!t)return null;var i=[];return o.iter(t.nodes,function(e){i.push(e.element())}),i},_prependItem:function(e,t){var i=this._itemDataElements(e),n=this._itemDataElements(t);i&&n&&o.iter(n,function(e){e.parentNode.insertBefore(e,i[0])})},_appendItem:function(e,t){var i=this._itemDataElements(e),n=this._itemDataElements(t);if(i&&n){var s=i[i.length-1];o.iter(n,function(e){s.parentNode.insertBefore(e,s.nextSibling),s=e})}},_newItemElements:function(){var e=h.templates.create(this._node._innerTemplate),t=this._node.element();return e.forEach(function(e){t.appendChild(e)}),e}}});return c.register("ba-repeat"),c}),e.define("module:Partials.ReturnPartial",["module:Handlers.Partial","browser:Events"],function(e,s,t){var i=e.extend({scoped:t},function(n){return{constructor:function(e,t,i){n.constructor.apply(this,arguments),this.auto_destroy(new s).on(this._node._element,"keypress",function(e){13===e.which&&this._execute()},this)}}},{manualExecute:!0});return i.register("ba-return"),i}),e.define("module:Partials.ShareScopePartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){e.properties().bind("",this._value?this._value:this._node.properties(),{deep:!0})}}});return i.register("ba-sharescope"),i}),e.define("module:Partials.ShowPartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},function(n){return{constructor:function(e,t,i){n.constructor.apply(this,arguments),this.__oldDisplay=undefined,this.__readOldDisplay=!1,this.__hidden=!1,i||this.__hide()},__hide:function(){this.__hidden||(this.__hidden=!0,this.__readOldDisplay||(this.__oldDisplay=this._node._element.style.display,this.__readOldDisplay=!0),this._node._element.style.display="none")},__show:function(){this.__hidden&&(this.__hidden=!1,this._node._element.style.display=this.__oldDisplay&&"none"!==this.__oldDisplay?this.__oldDisplay:"")},_apply:function(e){e?this.__show():this.__hide()}}});return i.register("ba-show"),i}),e.define("module:Partials.StylesPartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},{_apply:function(e){for(var t in e)this._node._element.style[t]=e[t]}});return i.register("ba-styles"),i}),e.define("module:Partials.TapPartial",["module:Handlers.Partial","browser:Info","browser:Events","base:Time","base:Async"],function(e,l,h,c,_,t){var i=e.extend({scoped:t},function(o){return{constructor:function(e,t,i,n){o.constructor.apply(this,arguments);var s=this.auto_destroy(new h);if(l.isMobile()){var r=n?"touch"+n.trim():"touchstart",a=0;s.on(this._node._element,"click "+r,function(e){e.stopPropagation(),e.preventDefault(),c.now()-a<100||(_.eventually(function(){this.executeAction()},this),a=c.now())},this)}else s.on(this._node._element,"click",function(e){e.stopPropagation(),this.executeAction()},this)},executeAction:function(){this._execute()}}},{manualExecute:!0});return i.register("ba-tap"),i}),e.define("module:Partials.TemplatePartial",["module:Handlers.Partial"],function(e,t){var i=e.extend({scoped:t},{bindTagHandler:function(e){this._value&&(e.template=this._value)}},{meta:{requires_tag_handler:!0,value_hidden:!0}});return i.register("ba-template"),i}),e.define("module:Partials.TemplateUrlPartial",["module:Handlers.Partial","browser:Loader"],function(e,s,t){var i=e.extend({scoped:t},function(i){return{constructor:function(n,e,t){i.constructor.apply(this,arguments),n._expandChildren=!1,n.element().innerHTML="",s.loadHtml(t,function(e){n.element().innerHTML=e;for(var t=n.element().childNodes,i=0;i<t.length;++i)n._registerChild(t[i])},this)}}});return i.register("ba-template-url"),i}),e.define("module:Partials.TogglePartial",["module:Handlers.Partial"],function(e,t){var i={readonly:"readOnly",playsinline:"playsInline"},n=e.extend({scoped:t},function(s){return{constructor:function(e,t,i,n){s.constructor.apply(this,arguments),this._apply(i)},_apply:function(e){this._node.element()[i[this._postfix]||this._postfix]=e?this._postfix:null}}});return n.register("ba-toggle"),n}),e.define("module:Partials.WeakIfPartial",["module:Partials.ShowPartial"],function(e,t){var i=e.extend({scoped:t},function(n){return{constructor:function(e,t,i){n.constructor.apply(this,arguments),i||e.deactivate()},_apply:function(e){n._apply.call(this,e),e&&this._node.activate()}}});return i.register("ba-weak-if"),i})}).call(Scoped);