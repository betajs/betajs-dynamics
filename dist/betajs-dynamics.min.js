/*!
betajs-dynamics - v0.0.1 - 2015-02-21
Copyright (c) Oliver Friedmann,Victor Lingenthal
MIT Software License.
*/
var Scoped=function(){function a(a){function b(a){return d.extend({route:null,parent:null,children:{},watchers:[],data:{},ready:!1,lazy:[]},a)}function c(a){if(!a.ready){if(a.parent&&!a.parent.ready)return void c(a.parent);if(a.route in a.parent.data){a.data=a.parent.data[a.route],a.ready=!0;for(var b=0;b<a.watchers.length;++b)a.watchers[b].callback.call(a.watchers[b].context||this,a.data);a.watchers=[];for(var d in a.children)c(a.children[d])}}}function e(b){if(!b.ready){b.parent&&!b.parent.ready&&e(b.parent),b.ready=!0,a.tree&&"object"==typeof b.parent.data&&(b.parent.data[b.route]=b.data);for(var c=0;c<b.watchers.length;++c)b.watchers[c].callback.call(b.watchers[c].context||this,b.data);b.watchers=[]}}function f(a,b){if("object"==typeof b)for(var d in b)a.data[d]=b[d],a.children[d]&&(a.children[d].data=b[d]);else a.data=b;e(a);for(var f in a.children)c(a.children[f])}function g(a){if(a.ready&&a.data)for(var b in a.data)delete a.data[b]}function h(a){if(!a)return j;for(var d=a.split("."),e=j,f=0;f<d.length;++f)d[f]in e.children?e=e.children[d[f]]:(e.children[d[f]]=b({parent:e,route:d[f]}),e=e.children[d[f]],c(e));return e}function i(a,b,c){if(a.ready)b.call(c||this,a.data);else if(a.watchers.push({callback:b,context:c}),a.lazy.length>0){var d=function(){if(a.lazy.length>0){var b=a.lazy.shift();b.callback.call(b.context||this,a.data)}};d(a)}}a=d.extend({tree:!1,global:!1,root:{}},a);var j=b({ready:!0}),k=null;if(a.tree){if(a.global){try{window&&(k=window)}catch(l){}try{global&&(k=global)}catch(l){}}else k=a.root;j.data=k}return{extend:function(a,b){f(h(a),b)},set:function(a,b){var c=h(a);c.data&&g(c),f(c,b)},lazy:function(a,b,c){var d=h(a);d.ready?b(c||this,d.data):d.lazy.push({callback:b,context:c})},digest:function(a){c(h(a))},obtain:function(a,b,c){i(h(a),b,c)}}}function b(e,f,g,h){var i=null,j=[],k=a({tree:!0}),l=a({tree:!1}),m={global:{namespace:h},root:{namespace:g},local:{namespace:k},"default":{namespace:l},parent:{namespace:f},scope:{namespace:k,readonly:!1}},n=function(a,b,c){var e=d.matchArgs(a,{options:"object",namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),f=d.extend({lazy:this.options.lazy},e.options||{}),g=this.resolve(e.namespaceLocator),h=function(){this.require(e.dependencies,e.hiddenDependencies,function(){if(arguments[arguments.length-1].ns=g,this.options.compile){for(var f=[],h=0;h<a.length;++h)f.push(d.stringify(a[h]));this.compiled+=this.options.ident+"."+b+"("+f.join(", ")+");\n\n"}var i=e.callback.apply(e.context||this,arguments);c.call(this,g,i)},this)};return f.lazy?g.namespace.lazy(g.path,h,this):h.apply(this),this};return{getGlobal:d.method(c,c.getPath),setGlobal:d.method(c,c.setPath),options:{lazy:!1,ident:"Scoped",compile:!1},compiled:"",nextScope:function(){return i||(i=b(this,k,g,h)),i},subScope:function(){var a=this.nextScope();return j.push(a),i=null,a},binding:function(b,c,e){if(!m[b]||!m[b].readonly){var f;f="string"!=d.typeOf(c)?{namespace:a({tree:!0,root:c}),path:null}:this.resolve(c),m[b]=d.extend(e,f)}return this},resolve:function(a){var b=a.split(":");if(1==b.length)return{namespace:l,path:b[0]};var c=m[b[0]];return{namespace:c.namespace,path:c.path&&b[1]?c.path+"."+b[1]:c.path||b[1]}},define:function(){return n.call(this,arguments,"define",function(a,b){a.namespace.set(a.path,b)})},extend:function(){return n.call(this,arguments,"extend",function(a,b){a.namespace.extend(a.path,b)})},condition:function(){return n.call(this,arguments,"condition",function(a,b){b&&a.namespace.set(a.path,b)})},require:function(){var a=d.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),b=a.dependencies||[],c=b.concat(a.hiddenDependencies||[]),e=c.length,f=[],g={};if(e)for(var h=0;h<c.length;++h){var i=this.resolve(c[h]);h<b.length&&f.push(null),i.namespace.obtain(i.path,function(b){this.i<f.length&&(f[this.i]=b),e--,0===e&&(f.push(g),a.callback.apply(a.context||this.ctx,f))},{ctx:this,i:h})}else f.push(g),a.callback.apply(a.context||this,f);return this},digest:function(a){var b=this.resolve(a);return b.namespace.digest(b.path),this}}}var c={get:function(a){try{if(window)return window[a]}catch(b){}try{if(global)return global[a]}catch(b){}return null},set:function(a,b){try{window&&(window[a]=b)}catch(c){}try{global&&(global[a]=b)}catch(c){}return b},setPath:function(a,b){var c=a.split(".");if(1==c.length)return this.set(a,b);for(var d=this.get(c[0])||this.set(c[0],{}),e=1;e<c.length-1;++e)c[e]in d||(d[c[e]]={}),d=d[c[e]];return d[c[c.length-1]]=b,b},getPath:function(a){var b=a.split(".");if(1==b.length)return this.get(a);for(var c=this.get(b[0]),d=1;d<b.length;++d){if(!c)return c;c=c[b[d]]}return c}},d={method:function(a,b){return function(){return b.apply(a,arguments)}},extend:function(a,b){a=a||{},b=b||{};for(var c in b)a[c]=b[c];return a},typeOf:function(a){return"[object Array]"===Object.prototype.toString.call(a)?"array":typeof a},isEmpty:function(a){if(null===a||"undefined"==typeof a)return!0;if("array"==this.typeOf(a))return 0===a.length;if("object"!=typeof a)return!1;for(var b in a)return!1;return!0},matchArgs:function(a,b){var c=0,d={};for(var e in b)b[e]===!0||this.typeOf(a[c])==b[e]?(d[e]=a[c],c++):"undefined"==this.typeOf(a[c])&&c++;return d},stringify:function(a){return"function"==this.typeOf(a)?""+a:JSON.stringify(a)}},e={__namespace:"Scoped"};d.extend(e,{upgrade:function(a){var b=c.get(a||e.__namespace);if(b&&"object"==d.typeOf(b)&&b.guid==this.guid&&"string"==d.typeOf(b.version)){for(var f=this.version.split("."),g=b.version.split("."),h=!1,i=0;i<Math.min(f.length,g.length)&&(h=f[i]>g[i],f[i]==g[i]);++i);return h?this.attach(a):b}return this.attach(a)},attach:function(a){a&&(e.__namespace=a);var b=c.get(e.__namespace);return b==this?this:(e.__revert=b,c.set(a,this),this)},detach:function(a){return a&&c.set(e.__namespace,null),"undefined"!=typeof e.__revert&&c.set(e.__namespace,e.__revert),delete e.__revert,this},exports:function(a,b){return"undefined"!=typeof module&&"exports"in module&&(b||module.exports==this||!module.exports||d.isEmpty(module.exports))&&(module.exports=a||this),this}});var f=a({tree:!0,global:!0}),g=a({tree:!0}),h=b(null,g,g,f),i=d.extend(h,{guid:"4b6878ee-cb6a-46b3-94ac-27d91f58d666",version:"3.1424370853283",upgrade:e.upgrade,attach:e.attach,detach:e.detach,exports:e.exports});return i=i.upgrade(),i.exports(),i}.call(this);(function(){var a=this.subScope();a.binding("module","global:BetaJS.Dynamics"),a.binding("base","global:BetaJS"),a.binding("browser","global:BetaJS.Browser"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"d71ebf84-e555-4e9b-b18a-11d74fdcefe2",version:"21.1424567291387"}}),a.define("module:Data.Mesh",["base:Class","base:Events.EventsMixin","base:Properties.Properties","base:Objs","base:Types","base:Strings","base:Ids","base:Functions"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},[b,function(a){return{constructor:function(b,c){a.constructor.call(this),this.__environment=b,this.__context=c,this.__watchers={}},destroy:function(){this.unwatch(d.keys(this.__watchers)),a.destroy.call(this)},watch:function(a,b,c){d.iter(a,function(a){for(var d=this.__environment.length-1;d>=0&&!this._watch(this.__environment[d],a,b,c,0===d);--d);},this)},unwatch:function(a,b){d.iter(a,function(a){this._unwatch(a,b)},this)},call:function(a,b){var c={};d.iter(a,function(a){var b=this.read(a,!0);null===b&&f.splitFirst(a,".").head in window||(c[a]=b)},this);var e=this.__expand(c),g=b.call(this.__context,e),h=this.__collapse(e,a);for(var i in h)i in c&&c[i]==h[i]||this.write(i,h[i]);return g},read:function(a){for(var b=this.__environment.length-1;b>=0;--b){var c=this._read(this.__environment[b],a);if(c)return e.is_function(c.value)?h.as_method(c.value,c.context||this.__context):c.value}return null},write:function(a,b){for(var c=this.__environment.length-1;c>=0&&!this._write(this.__environment[c],a,b,0===c);--c);},_sub_navigate:function(a,b,d,g,h){var i={properties:a,head:b,tail:d,parent:g,current:h};if(!d||!h||!e.is_object(h))return i;var j=f.splitFirst(d,"."),k=b?b+"."+j.head:j.head;return c.is_instance_of(h)&&h.has(j.head)?this._sub_navigate(h,j.head,j.tail,h,h.get(j.head)):j.head in h?this._sub_navigate(a,k,j.tail,h,h[j.head]):i},_navigate:function(a,b){return this._sub_navigate(null,"",b,null,a)},_read:function(a,b){var c=this._navigate(a,b);return c.tail?null:{value:c.current,context:c.parent}},_write:function(a,b,c,d){var e=this._navigate(a,b);if(!e.tail||d){var f=e.tail.split(".");if(e.properties)e.properties.set(e.head+(e.head&&e.tail?".":"")+e.tail,c);else{for(var g=e.current,h=0;h<f.length-1;++h)g[f[h]]={},g=g[f[h]];g[f[f.length-1]]=c}}},_watch:function(a,b,c,e,f){if(!this.__watchers[b]){var h=this._navigate(a,b);if(!h.properties||!f&&h.tail)return!1;var i=h.head+(h.head&&h.tail?".":"")+h.tail;this.__watchers[b]={props:h.properties,exp:i,cbs:{}},h.properties.on("change:"+i,function(){d.iter(this.__watchers[b].cbs,function(a){a.callback.call(a.context)},this)},this)}return this.__watchers[b].cbs[g.objectId(e)]={callback:c,context:e},!0},_unwatch:function(a,b){this.__watchers[a]&&(b&&delete this.__watchers[a].cbs[g.objectId(b)],(!b||e.is_empty(this.__watchers[a].cbs))&&(this.__watchers[a].props.off("change:"+this.__watchers[a].exp,null,this),delete this.__watchers[a]))},__expand:function(a){var b={};return d.iter(a,function(a,c){for(var d=b,f=c.split("."),g=0;g<f.length-1;++g)f[g]in d&&e.is_object(d[f[g]])||(d[f[g]]={}),d=d[f[g]];d[f[f.length-1]]=a}),b},__collapse:function(a,b){var c={};return d.iter(b,function(b){for(var d=b.split("."),e=a,f=0;f<d.length;++f)e=e[d[f]];c[b]=e}),c}}}])}),a.define("module:Parser",["base:Types","base:Objs","base:JavaScript"],function(a,b,c){return{parseText:function(c){if(!c)return null;for(var d=[];c;){var e=c.indexOf("{{"),f=null;if(0===e){for(e=c.indexOf("}}");e+2<c.length&&"}"==c.charAt(e+2);)e++;e>=0?(e+=2,f=this.parseCode(c.substring(2,e-2))):e=c.length}else 0>e&&(e=c.length);d.push(f?f:c.substring(0,e)),c=c.substring(e)}if(1==d.length)return a.is_string(d[0])?null:d[0];var g={};return b.iter(d,function(c){a.is_string(c)||b.iter(c.dependencies,function(a){g[a]=!0})}),{func:function(c){var e=null;return b.iter(d,function(b){var d=a.is_string(b)?b:b.func(c);e=null===e?d:e+d}),e},dependencies:b.keys(g)}},parseCode:function(a){var d=!1;"="==a.charAt(0)&&(d=!0,a=a.substring(1));var e=a.indexOf("::"),f=null;return e>=0&&(f=a.substring(0,e).trim(),a=a.substring(e+2)),{bidirectional:d,args:f,variable:d?a:null,func:new Function("obj","with (obj) { return "+a+"; }"),dependencies:b.keys(b.objectify(c.extractIdentifiers(a,!0)))}}}}),a.define("module:Data.ScopeManager",["base:Class","base:Trees.TreeNavigator","base:Classes.ObjectIdScopeMixin","base:Trees.TreeQueryEngine"],function(a,b,c,d,e){return a.extend({scoped:e},[b,c,function(a){return{constructor:function(b){a.constructor.call(this),this.__root=b,this.__watchers=[],this.__query=this._auto_destroy(new d(this))},nodeRoot:function(){return this.__root},nodeId:function(a){return a.cid()},nodeParent:function(a){return a.__parent},nodeChildren:function(a){return a.__children},nodeData:function(a){return a.data()},nodeWatch:function(a,b,c){a.on("data",function(){b.call(c,"data")},c),a.on("add",function(a){b.call(c,"addChild",a)},c),a.on("destroy",function(){b.call(c,"remove")},c)},nodeUnwatch:function(a,b,c){a.off(null,null,c)},query:function(a,b){return this.__query.query(a,b)}}}])}),a.define("module:Data.Scope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Classes.ObjectIdMixin","base:Functions","base:Types","base:Objs","base:Ids","base:Properties.Properties","base:Collections.Collection","module:Data.ScopeManager","module:Data.MultiScope"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){return a.extend({scoped:m},[b,c,d,function(a){return{constructor:function(b){b=g.extend({functions:{},data:{},parent:null,scopes:{},bind:{},attrs:{},collections:{}},b);var c=b.parent;this.__manager=c?c.__manager:this._auto_destroy(new k(this)),a.constructor.call(this),this.__parent=c,this.__root=c?c.root():this,this.__children={},this.__properties=new i,this.__properties.on("change",function(a,b,c){this.trigger("change:"+a,b,c)},this),this.__functions=b.functions,this.__scopes={},this.__data=b.data,this.setAll(b.attrs),g.iter(b.collections,function(a,b){this.set(b,new j(a))},this),c&&c.__add(this),this.scopes=g.map(b.scopes,function(a){return this.scope(a)},this),g.iter(b.bind,function(a,b){var c=a.indexOf(":");this.bind(this.scope(a.substring(0,c)),b,{secondKey:a.substring(c+1)})},this)},destroy:function(){g.iter(this.__scopes,function(a){a.destroy()}),g.iter(this.__children,function(a){a.destroy()}),this.__properties.destroy(),this.__parent&&this.__parent.__remove(this),this.trigger("destroy"),a.destroy.call(this)},__object_id_scope:function(){return this.__manager},__add:function(a){this.__children[a.cid()]=a,this.trigger("add",a)},__remove:function(a){this.trigger("remove",a),delete this.__children[a.cid()]},data:function(a,b){return 0===arguments.length?this.__data:1===arguments.length?this.__data[a]:(this.__data[a]=b,this.trigger("data",a,b),this)},set:function(a,b){return this.__properties.set(a,b),this},setAll:function(a){return this.__properties.setAll(a),this},get:function(a){return this.__properties.get(a)},define:function(a,b,c){return this.__functions[a]=e.as_method(b,c||this),this},call:function(a){return this.__functions[a].apply(this,e.getArguments(arguments,1))},parent:function(){return this.__parent},root:function(){return this.__root},children:function(){return this.scope(">")},properties:function(){return this.__properties},scope:function(a,b){if(arguments.length<2&&(b=a,a=this),!b)return a;if(a&&a.instance_of(l)&&(a=a.iterator().next()),!a)return a;var c=h.objectId(a)+"_"+b;return this.__scopes[c]||(this.__scopes[c]=new l(this,a,b)),this.__scopes[c]},bind:function(a,b,c){if(a.instance_of(l)){for(var d=a.iterator();d.hasNext();)this.properties().bind(b,d.next().properties(),c);a.on("addscope",function(a){this.properties().bind(b,a.properties(),c)},this),a.on("removescope",function(a){this.properties().unbind(b,a.properties())},this)}else this.properties().bind(b,a.properties(),c)}}}])}),a.define("module:Data.MultiScope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Objs","base:Iterators.ArrayIterator"],function(a,b,c,d,e,f){return a.extend({scoped:f},[b,c,function(a){return{constructor:function(b,c,e){a.constructor.call(this),this.__owner=b,this.__base=c,this.__queryStr=e,this.__query=this.__owner.__manager.query(this.__owner,e),this.__query.on("add",function(a){this.delegateEvents(null,a),this.trigger("addscope",a)},this),this.__query.on("remove",function(a){a.off(null,null,this),this.trigger("removescope",a)},this),d.iter(this.__query.result(),function(a){this.delegateEvents(null,a)},this),this.__freeze=!1},destroy:function(){d.iterate(this.__query.result(),function(a){a.off(null,null,this)},this),this.__query.destroy(),a.destroy.call(this)},iterator:function(){return new e(this.__query.result())},set:function(a,b){for(var c=this.iterator();c.hasNext();)c.next().set(a,b);return this},get:function(a){var b=this.iterator();return b.hasNext()?b.next().get(a):null},define:function(a,b){for(var c=this.iterator();c.hasNext();)c.next().define(a,b);return this},call:function(){for(var a=this.iterator(),b=null;a.hasNext();){var c=a.next(),d=c.call.apply(c,arguments);b=b||d}return b},parent:function(){return this.__owner.scope(this.__base,this.__queryStr+"<")},root:function(){return this.__owner.root()},children:function(){return this.__owner.scope(this.__base,this.__queryStr+">")},scope:function(a,b){return arguments.length<2&&(b=this.__queryStr+a,a=this.__base),this.__owner.scope(a,b)},materialize:function(a){return a?this.iterator().next():this.iterator().asArray()},freeze:function(){this.__freeze=!0,this.__query.off("add",null,this)}}}])}),a.define("module:Handlers.HandlerMixin",["base:Objs","jquery:","browser:Loader","module:Handlers.Node"],function(a,b,c,d){return{_notifications:{_construct:"__handlerConstruct",_destruct:"__handlerDestruct"},__handlerConstruct:function(){},__handlerDestruct:function(){a.iter(this.__rootNodes,function(a){a.destroy()})},_handlerInitialize:function(a){a=a||{},this._parentHandler=a.parentHandler||null;var d=a.template||this.template;if(this.__element=a.element?b(a.element):null,d)this._handlerInitializeTemplate(d,a.parentElement);else{var e=a.templateUrl||this.templateUrl;e&&(this.__deferActivate=!0,c.loadHtml(e,function(b){this.__deferActivate=!1,this._handlerInitializeTemplate(b,a.parentElement),this.__deferedActivate&&this.activate()},this))}},_handlerInitializeTemplate:function(a,c){this.__element?this.__element.html(a):c?(b(c).html(a),this.__element=b(c).find(">")):this.__element=b(a)},element:function(){return this.__element},activate:function(){if(this.__deferActivate)return void(this.__deferedActivate=!0);this._notify("_activate"),this.__rootNodes=[];var a=this;this.__element.each(function(){a.__rootNodes.push(new d(a,null,this))})}}}),a.define("module:Handlers.Handler",["base:Class","module:Handlers.HandlerMixin","base:Properties.Properties","module:Registries"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b){a.constructor.call(this),b=b||{},this._properties=b.properties?b.properties:new c,this.functions={},this._handlerInitialize(b)},properties:function(){return this._properties}}}],{register:function(a,b){b=b||d.handler,b.register(a,this)}})}),a.define("module:Handlers.Partial",["base:Class","module:Parser","module:Registries"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this._node=b,this._args=c,this._value=d,this._active=!1},change:function(a,b){this._value=a,this._change(a,b),this._apply(a,b)},activate:function(){this._active||(this._active=!0,this._activate(),this._apply(this._value,null))},deactivate:function(){this._active&&(this._active=!1,this._deactivate())},_change:function(){},_activate:function(){},_deactivate:function(){},_apply:function(){},_execute:function(){var a=b.parseCode(this._value);this._node.__executeDyn(a)}}},{register:function(a,b){b=b||c.partial,b.register(a,this)}})}),a.define("module:Handlers.Node",["base:Class","base:Events.EventsMixin","base:Ids","module:Parser","jquery:","module:Data.Mesh","base:Objs","base:Types","module:Registries"],function(a,b,c,d,e,f,g,h,i,j){var k;return k=a.extend({scoped:j},[b,function(a){return{constructor:function(b,g,h,i){if(a.constructor.call(this),this._handler=b,this._parent=g,g&&(g._children[c.objectId(this)]=this),this._element=h,this._tag=h.tagName?h.tagName.toLowerCase():"",this._tag.indexOf(":")>=0&&(this._tag=this._tag.substring(this._tag.indexOf(":")+1)),this._dynTag=d.parseText(this._tag),this._tagHandler=null,this._$element=e(h),this._template=h.outerHTML,this._innerTemplate=h.innerHTML,this._locals=i||{},this._active=!0,this._dyn=null,this._children={},this._locked=!0,this._attrs={},this._expandChildren=!0,this._touchedInner=!1,this._mesh=new f([this.properties(),this._locals,this._handler.functions],this._handler),h.attributes)for(var j=0;j<h.attributes.length;++j)this.__initializeAttr(h.attributes[j]);this._locked=!1,this._active=!this._active,this._active?this.deactivate():this.activate()},destroy:function(){g.iter(this._attrs,function(a){a.partial&&a.partial.destroy(),a.dyn&&this.__dynOff(a.dyn)},this),this._removeChildren(),this._tagHandler&&this._tagHandler.destroy(),this._dyn&&this.properties().off(null,null,this._dyn),this._parent&&delete this._parent._children[c.objectId(this)],this._mesh.destroy(),a.destroy.call(this)},element:function(){return this._element},$element:function(){return this._$element},__dynOff:function(a){this._mesh.unwatch(a.dependencies,a)},__dynOn:function(a,b){var c=this;this._mesh.watch(a.dependencies,function(){b.apply(c)},this)},__initializeAttr:function(a){var b={name:a.name,value:a.value,domAttr:a,dyn:d.parseText(a.value)};if(this._attrs[a.name]=b,this.__updateAttr(b),i.partial.get(b.name)&&(b.partial=i.partial.create(b.name,this,b.dyn?b.dyn.args:{},b.value)),b.dyn){this.__dynOn(b.dyn,function(){this.__updateAttr(b)});var c=this;b.dyn.bidirectional&&"value"==b.name&&this._$element.on("change keyup keypress keydown blur focus update",function(){c._mesh.write(b.dyn.variable,c._element.value)})}},__executeDyn:function(a){return h.is_object(a)?this._mesh.call(a.dependencies,a.func):a},__updateAttr:function(a){var b=a.dyn?this.__executeDyn(a.dyn):a.value;if(b!=a.value&&(b||a.value)){var c=a.value;a.value=b,a.domAttr.value=b,a.partial&&a.partial.change(b,c),"value"==a.name&&(this._element.value=b),this.trigger("change-attr:"+a.name,b,c)}},__tagValue:function(){return this._dynTag?this.__executeDyn(this._dynTag):this._tag},__unregisterTagHandler:function(){this._tagHandler&&(this.off(null,null,this._tagHandler),this._tagHandler.destroy(),this._tagHandler=null)},__registerTagHandler:function(){this.__unregisterTagHandler();var a=this.__tagValue();if(!i.handler.get(a))return!1;this._tagHandler=i.handler.create(a,{parentElement:this._$element.get(0),parentHandler:this._handler,autobind:!1,tagName:a}),this._$element.append(this._tagHandler.element());for(var b in this._attrs){var c=this._attrs[b];if(!c.partial&&0===b.indexOf("ba-")){var d=b.substring("ba-".length);if(this._tagHandler.properties().set(d,c.value),c.dyn){var e=this;this.on("change-attr:"+b,function(a){e._tagHandler.properties().set(d,a)},this._tagHandler),c.dyn.bidirectional&&this._tagHandler.properties().on("change:"+d,function(a){e._mesh.write(c.dyn.variable,a)},this)}}}return this._tagHandler.activate(),!0},activate:function(){if(!this._locked&&!this._active){this._locked=!0,this._active=!0,this._dynTag&&this.__dynOn(this._dynTag,function(){this.__registerTagHandler()});var a=this.__registerTagHandler();if(!a&&this._expandChildren){this._restoreInnerTemplate&&this._$element.html(this._innerTemplate),this._touchedInner=!0,this._element.nodeType==this._element.TEXT_NODE&&(this._dyn=d.parseText(this._element.textContent),this._dyn&&this.__dynOn(this._dyn,function(){this.__updateDyn()})),this.__updateDyn();for(var b=0;b<this._element.childNodes.length;++b)this._registerChild(this._element.childNodes[b])}this._$element.css("display","");for(var c in this._attrs)this._attrs[c].partial&&this._attrs[c].partial.activate();this._locked=!1}},__updateDyn:function(){if(this._dyn){var a=this.__executeDyn(this._dyn);a!=this._dyn.value&&(this._dyn.value=a,this._element.textContent=a)}},_registerChild:function(a,b){return new k(this._handler,this,a,g.extend(g.clone(this._locals,1),b))},_removeChildren:function(){g.iter(this._children,function(a){a.destroy()})},deactivate:function(){if(this._active&&(this._active=!1,!this._locked)){this._locked=!0;for(var a in this._attrs)this._attrs[a].partial&&this._attrs[a].partial.deactivate();this._removeChildren(),this._dynTag&&this.__dynOff(this._dynTag),this.__unregisterTagHandler(),this._dyn&&(this.__dynOff(this._dyn),this._dyn=null),this._touchedInner&&this._$element.html(""),this._restoreInnerTemplate=!0,this._locked=!1}},properties:function(){return this._handler.properties()}}}])}),a.define("module:Registries",["base:Classes.ClassRegistry"],function(a){return{handler:new a,partial:new a}}),a.define("module:Handlers.ClassPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},{_apply:function(a){for(var b in a)a[b]?this._node._$element.addClass(b):this._node._$element.removeClass(b)}});return c.register("ba-class"),c}),a.define("module:Handlers.ClickPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(){a.constructor.apply(this,arguments);var b=this;this._node._$element.on("click",function(){b._execute()})}}});return c.register("ba-click"),c}),a.define("module:Handlers.IfPartial",["module:Handlers.ShowPartial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments),d||b.deactivate()},_apply:function(b){a._apply.call(this,b),b?this._node.activate():this._node.deactivate()}}});return c.register("ba-if"),c}),a.define("module:Handlers.IgnorePartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.apply(this,arguments),b.deactivate()}}});return c.register("ba-ignore"),c}),a.define("module:Handlers.RepeatPartial",["module:Handlers.Partial","base:Collections.Collection","base:Objs","jquery:"],function(a,b,c,d,e){var f=a.extend({scoped:e},function(a){return{constructor:function(b){a.constructor.apply(this,arguments),b._expandChildren=!1,b._$element.html("")},_activate:function(){this.__register(this._value)},_deactivate:function(){this.__unregister()},_change:function(a){this.__register(a)},__register:function(a){this.__unregister(),b.is_instance_of(a)?(this.__collection=a,this.__collection_map={},this.__collection.iterate(function(a){this.__collection_map[a.cid()]=this.__appendItem(a)},this),this.__collection.on("add",function(a){this.__collection_map[a.cid()]=this.__appendItem(a)},this),this.__collection.on("remove",function(a){c.iter(this.__collection_map[a.cid()],function(a){var b=a.$element();a.destroy(),b.remove()},this),delete this.__collection_map[a.cid()]},this)):c.iter(a,this.__appendItem,this)},__unregister:function(){var a=this._node._$element;this._node._removeChildren(),a.html(""),this.__collection&&(this.__collection.off(null,null,this),this.__collection=null,this.__collection_map=null)},__appendItem:function(a){var b=d(this._node._innerTemplate.trim()).appendTo(this._node._$element),c={};this._args&&(c[this._args]=a);var e=[],f=this;return b.each(function(){e.push(f._node._registerChild(this,c))}),e}}});return f.register("ba-repeat"),f}),a.define("module:Handlers.ReturnPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(){a.constructor.apply(this,arguments);var b=this;this._node._$element.on("keypress",function(a){13===a.which&&b._execute()})}}});return c.register("ba-return"),c}),a.define("module:Handlers.ShowPartial",["module:Handlers.Partial"],function(a,b){var c=a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.apply(this,arguments),d||b._$element.hide()},_apply:function(a){a?this._node._$element.show():this._node._$element.hide()}}});return c.register("ba-show"),c}),a.define("module:Dynamic",["module:Data.Scope","module:Handlers.HandlerMixin","base:Objs","module:Registries"],function(a,b,c,d,e){var f;return f=a.extend({scoped:e},[b,function(a){return{_notifications:{_activate:"__createActivate"},constructor:function(b){if(b=c.extend(c.clone(this.initial,1),b),!b.parent&&b.parentHandler)for(var d=b.parentHandler;d&&!b.parent;)b.parent=d.instance_of(f)?d:null,d=d._parentHandler;a.constructor.call(this,b),b.tagName&&(this._tagName=b.tagName,this.data("tagname",this._tagName)),this.functions=this.__functions,this._handlerInitialize(b),this.__createActivate=b.create||function(){}}}}],{register:function(a,b){return b=b||d.handler,b.register(a,this),this},activate:function(a){var b=new this(a||{element:document.body});return b.activate(),b}})})}).call(Scoped);