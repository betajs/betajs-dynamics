/*!
betajs-dynamics - v0.0.132 - 2019-03-24
Copyright (c) Victor Lingenthal,Oliver Friedmann
Apache-2.0 Software License.
*/

var Scoped=function(){var d=function(){return{get:function(e){return"undefined"!=typeof window?e?window[e]:window:"undefined"!=typeof global?e?global[e]:global:"undefined"!=typeof self?e?self[e]:self:undefined},set:function(e,t){return"undefined"!=typeof window&&(window[e]=t),"undefined"!=typeof global&&(global[e]=t),"undefined"!=typeof self&&(self[e]=t),t},getPath:function(e){if(!e)return this.get();var t=e.split(".");if(1==t.length)return this.get(e);for(var n=this.get(t[0]),i=1;i<t.length;++i){if(!n)return n;n=n[t[i]]}return n},setPath:function(e,t){var n=e.split(".");if(1==n.length)return this.set(e,t);for(var i=this.get(n[0])||this.set(n[0],{}),s=1;s<n.length-1;++s)n[s]in i||(i[n[s]]={}),i=i[n[s]];return i[n[n.length-1]]=t}}}.call(this),p=function(){return{method:function(e,t){return function(){return t.apply(e,arguments)}},extend:function(e,t){for(var n in e=e||{},t=t||{})e[n]=t[n];return e},typeOf:function(e){return"[object Array]"===Object.prototype.toString.call(e)?"array":typeof e},isEmpty:function(e){if(null==e)return!0;if("array"==this.typeOf(e))return 0===e.length;if("object"!=typeof e)return!1;for(var t in e)return!1;return!0},matchArgs:function(e,t){var n=0,i={};for(var s in t)!0===t[s]||this.typeOf(e[n])==t[s]?(i[s]=e[n],n++):"undefined"==this.typeOf(e[n])&&n++;return i},stringify:function(e){return"function"==this.typeOf(e)?""+e:JSON.stringify(e)}}}.call(this),a=function(){return{__namespace:"Scoped",__revert:null,upgrade:function(e){var t=d.get(e||a.__namespace);if(t&&"object"==p.typeOf(t)&&t.guid==this.guid&&"string"==p.typeOf(t.version)){for(var n=this.version.split("."),i=t.version.split("."),s=!1,r=0;r<Math.min(n.length,i.length)&&(s=parseInt(n[r],10)>parseInt(i[r],10),n[r]==i[r]);++r);return s?this.attach(e):t}return this.attach(e)},attach:function(e){e&&(a.__namespace=e);var t=d.get(a.__namespace);if(t==this)return this;if(a.__revert=t)try{var n=t.__exportScoped();this.__exportBackup=this.__exportScoped(),this.__importScoped(n)}catch(i){}return d.set(a.__namespace,this),this},detach:function(e){return e&&d.set(a.__namespace,null),"undefined"!=typeof a.__revert&&d.set(a.__namespace,a.__revert),delete a.__revert,a.__exportBackup&&this.__importScoped(a.__exportBackup),this},exports:function(e,t,n){return"object"==typeof(e=e||("undefined"!=typeof module?module:null))&&e&&"exports"in e&&(n||e.exports==this||!e.exports||p.isEmpty(e.exports))&&(e.exports=t||this),this}}}.call(this);function f(e){var a={tree:"boolean"==typeof e.tree&&e.tree,global:"boolean"==typeof e.global&&e.global,root:"object"==typeof e.root?e.root:{}};function s(e){return{route:"string"==typeof e.route?e.route:null,parent:"object"==typeof e.parent?e.parent:null,ready:"boolean"==typeof e.ready&&e.ready,children:{},watchers:[],data:{},lazy:[]}}var o=s({ready:!0});if(a.tree)if(a.global){try{window&&(o.data=window)}catch(t){}try{global&&(o.data=global)}catch(t){}try{self&&(o.data=self)}catch(t){}}else o.data=a.root;function l(e){if(!e.ready)if(!e.parent||e.parent.ready){if(e.route&&e.parent&&e.route in e.parent.data){e.data=e.parent.data[e.route],e.ready=!0;for(var t=0;t<e.watchers.length;++t)e.watchers[t].callback.call(e.watchers[t].context||this,e.data);for(var n in e.watchers=[],e.children)l(e.children[n])}}else l(e.parent)}function r(e,t){if("object"==typeof t&&e.ready)for(var n in t)e.data[n]=t[n];else e.data=t;if("object"==typeof t)for(var i in t)e.children[i]&&(e.children[i].data=t[i]);for(var s in function r(e){if(!e.ready){e.parent&&!e.parent.ready&&r(e.parent),e.ready=!0,e.parent&&a.tree&&"object"==typeof e.parent.data&&(e.parent.data[e.route]=e.data);for(var t=0;t<e.watchers.length;++t)e.watchers[t].callback.call(e.watchers[t].context||this,e.data);e.watchers=[]}}(e),e.children)l(e.children[s])}function c(e){if(!e)return o;for(var t=e.split("."),n=o,i=0;i<t.length;++i)t[i]in n.children?n=n.children[t[i]]:(n.children[t[i]]=s({parent:n,route:t[i]}),l(n=n.children[t[i]]));return n}return{extend:function(e,t){r(c(e),t)},set:function(e,t){var n=c(e);n.data&&function i(e){if(e.ready&&e.data)for(var t in e.data)delete e.data[t]}(n),r(n,t)},get:function(e){var t=c(e);return t.ready?t.data:null},lazy:function(e,t,n){var i=c(e);i.ready?t(n||this,i.data):i.lazy.push({callback:t,context:n})},digest:function(e){l(c(e))},obtain:function(e,t,n){!function s(e,t,n){if(e.ready)t.call(n||this,e.data);else if(e.watchers.push({callback:t,context:n}),0<e.lazy.length){var i=function(e){if(0<e.lazy.length){var t=e.lazy.shift();t.callback.call(t.context||this,e.data),i(e)}};i(e)}}(c(e),t,n)},unresolvedWatchers:function(e){return function r(e,t,n){for(var i in n=n||[],!(e=e||o).ready&&0===e.lazy.length&&0<e.watchers.length&&n.push(t),e.children){var s=e.children[i];n=r(s,(t?t+".":"")+s.route,n)}return n}(c(e),e)},__export:function(){return{options:a,nsRoot:o}},__import:function(e){a=e.options,o=e.nsRoot}}}var t=f({tree:!0,global:!0}),n=f({tree:!0}),i=function m(e,t,n,i){var s=null,r=[],a=t,o=n,l=i,c=f({tree:!0}),h=f({tree:!1}),u={global:{namespace:l},root:{namespace:o},local:{namespace:c},"default":{namespace:h},parent:{namespace:a},scope:{namespace:c,readonly:!1}},_=function(r,a,o){var l=p.matchArgs(r,{options:"object",namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),e=p.extend({lazy:this.options.lazy},l.options||{}),c=this.resolve(l.namespaceLocator),t=function(){this.require(l.dependencies,l.hiddenDependencies,function(){for(var e=[],t=0;t<arguments.length;++t)e.push(arguments[t]);if(e[e.length-1].ns=c,this.options.compile){for(var n=[],i=0;i<r.length;++i)n.push(p.stringify(r[i]));this.compiled+=this.options.ident+"."+a+"("+n.join(", ")+");\n\n"}this.options.dependencies&&(this.dependencies[c.path]=this.dependencies[c.path]||{},l.dependencies&&l.dependencies.forEach(function(e){this.dependencies[c.path][this.resolve(e).path]=!0},this),l.hiddenDependencies&&l.hiddenDependencies.forEach(function(e){this.dependencies[c.path][this.resolve(e).path]=!0},this));var s=this.options.compile?{}:l.callback.apply(l.context||this,e);o.call(this,c,s)},this)};return e.lazy?c.namespace.lazy(c.path,t,this):t.apply(this),this};return{getGlobal:p.method(d,d.getPath),setGlobal:p.method(d,d.setPath),options:{lazy:!1,ident:"Scoped",compile:!1,dependencies:!1},compiled:"",dependencies:{},nextScope:function(){return s||(s=m(this,c,o,l)),s},subScope:function(){var e=this.nextScope();return r.push(e),s=null,e},binding:function(e,t,n){var i;return u[e]&&u[e].readonly||(i="string"!=p.typeOf(t)?{namespace:f({tree:!0,root:t}),path:null}:this.resolve(t),u[e]=p.extend(n,i)),this},resolve:function(e){var t=e.split(":");if(1==t.length)throw"The locator '"+t[0]+"' requires a namespace.";var n=u[t[0]];if(!n)throw"The namespace '"+t[0]+"' has not been defined (yet).";return{namespace:n.namespace,path:n.path&&t[1]?n.path+"."+t[1]:n.path||t[1]}},define:function(){return _.call(this,arguments,"define",function(e,t){if(e.namespace.get(e.path))throw"Scoped namespace "+e.path+" has already been defined. Use extend to extend an existing namespace instead";e.namespace.set(e.path,t)})},assumeVersion:function(){var r=p.matchArgs(arguments,{assumption:!0,dependencies:"array",callback:!0,context:"object",error:"string"}),e=r.dependencies||[];e.unshift(r.assumption),this.require(e,function(){var e=arguments,t=e[0].replace(/[^\d\.]/g,"");e[0]=t.split(".");for(var n=0;n<e[0].length;++n)e[0][n]=parseInt(e[0][n],10);if("function"===p.typeOf(r.callback)){if(!r.callback.apply(r.context||this,r))throw"Scoped Assumption '"+r.assumption+"' failed, value is "+t+(r.error?", but assuming "+r.error:"")}else for(var i=(r.callback+"").replace(/[^\d\.]/g,"").split("."),s=0;s<Math.min(e[0].length,i.length);++s)if(parseInt(i[s],10)>e[0][s])throw"Scoped Version Assumption '"+r.assumption+"' failed, value is "+t+", but assuming at least "+r.callback})},extend:function(){return _.call(this,arguments,"extend",function(e,t){e.namespace.extend(e.path,t)})},require:function(){var t=p.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:"function",context:"object"});t.callback=t.callback||function(){};var e=t.dependencies||[],n=e.concat(t.hiddenDependencies||[]),i=n.length,s=[],r={};if(i)for(var a=function(e){this.i<s.length&&(s[this.i]=e),0==--i&&(s.push(r),t.callback.apply(t.context||this.ctx,s))},o=0;o<n.length;++o){var l=this.resolve(n[o]);o<e.length&&s.push(null),l.namespace.obtain(l.path,a,{ctx:this,i:o})}else s.push(r),t.callback.apply(t.context||this,s);return this},digest:function(e){var t=this.resolve(e);return t.namespace.digest(t.path),this},unresolved:function(e){var t=this.resolve(e);return t.namespace.unresolvedWatchers(t.path)},__export:function(){return{parentNamespace:a.__export(),rootNamespace:o.__export(),globalNamespace:l.__export(),localNamespace:c.__export(),privateNamespace:h.__export()}},__import:function(e){a.__import(e.parentNamespace),o.__import(e.rootNamespace),l.__import(e.globalNamespace),c.__import(e.localNamespace),h.__import(e.privateNamespace)}}}(0,n,n,t),e=p.extend(i,function(){return{guid:"4b6878ee-cb6a-46b3-94ac-27d91f58d666",version:"0.0.19",upgrade:a.upgrade,attach:a.attach,detach:a.detach,exports:a.exports,__exportScoped:function(){return{globalNamespace:t.__export(),rootNamespace:n.__export(),rootScope:i.__export()}},__importScoped:function(e){t.__import(e.globalNamespace),n.__import(e.rootNamespace),i.__import(e.rootScope)}}}.call(this));return(e=e.upgrade()).exports(),e}.call(this);(function(){var e=this.subScope();e.binding("module","global:BetaJS.Dynamics"),e.binding("base","global:BetaJS"),e.binding("browser","global:BetaJS.Browser"),e.define("module:",function(){return{guid:"d71ebf84-e555-4e9b-b18a-11d74fdcefe2",version:"0.0.132",datetime:1553484878414}}),e.assumeVersion("base:version","~1.0.146"),e.assumeVersion("browser:version","~1.0.61"),e.define("module:Data.Friendgroup",["base:Class","base:Types","base:Objs","base:Iterators.ObjectValuesIterator","module:Data.ManualMultiScope"],function(e,n,i,s,r,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this.parent=e,this._registeredScopes={},this._watchScopes={}},destroy:function(){i.iter(this._watchScopes,function(e){e.weakDestroy()}),t.destroy.call(this)},registerScope:function(e,t){this._registeredScopes[t]=this._registeredScopes[t]||{},this._registeredScopes[t][e.cid()]=e,this._watchScopes[t]&&this._watchScopes[t].addScope(e)},unregisterScope:function(e,t){delete this._registeredScopes[t][e.cid()],n.is_empty(this._registeredScopes[t])&&delete this._registeredScopes[t],this._watchScopes[t]&&this._watchScopes[t].removeScope(e)},watchScope:function(e,t){return this._watchScopes[t]||(this._watchScopes[t]=new r(function(){return this.iterateScopes(t)},this)),this._watchScopes[t].increaseRef(e),this._watchScopes[t]},unwatchScope:function(e,t){return this._watchScopes[t]&&(this._watchScopes[t].decreaseRef(e),this._watchScopes[t].destroyed()&&delete this._watchScopes[t]),this},iterateScopes:function(e){return this._registeredScopes[e]||!this.parent?new s(this._registeredScopes[e]||{}):this.parent.iterateScopes(e)}}})}),e.define("module:Data.Mesh",["base:Class","base:Events.EventsMixin","base:Properties.ObservableMixin","base:Objs","base:Types","base:Strings","base:Ids","base:Functions","base:Classes.SharedObjectFactory"],function(e,t,l,c,h,u,s,r,_,n){return e.extend({scoped:n},[t,function(i){return{constructor:function(e,t,n){i.constructor.call(this),this.__environment=e,this.__defaults=n,this.__context=t,this.__watchers={},this.__acquiredProperties={}},destroy:function(){c.iter(this.__watchers,function(e){this.__destroyWatcher(e)},this),c.iter(this.__acquiredProperties,function(e){e.decreaseRef(this)},this),i.destroy.call(this)},watch:function(e,t,n){c.iter(e,function(e){this.__createWatcher(e).cbs[s.objectId(n)]={callback:t,context:n}},this)},unwatch:function(e,n){c.iter(e,function(e){var t=this.__createWatcher(e,!0);t&&(delete t.cbs[s.objectId(n)],this.__destroyWatcher(t,!0))},this)},__destroyWatcher:function(e,t){h.is_string(e)&&(e=this.__watchers[e]),e&&(!t||h.is_empty(e.cbs)&&h.is_empty(e.children))&&(c.iter(e.children,this.__destroyWatcher,this),this.__unbindWatcher(e),e.parent&&delete e.parent.children[e.key],delete this.__watchers[e.expression],e.parent&&h.is_empty(e.parent.cbs)&&h.is_empty(e.parent.children)&&this.__destroyWatcher(e.parent))},__createWatcher:function(e,t){var n=this.__watchers[e];if(n||t)return n;var i=u.splitLast(e,"."),s=i.head?this.__createWatcher(i.head):null;return n={cbs:{},parent:s,key:i.tail,expression:e,children:{},properties:null,propertiesPrefix:null},s&&(s.children[i.tail]=n),this.__watchers[e]=n,this.__bindWatcher(n),n},__unbindWatcher:function(e){e.properties&&e.properties.off(null,null,e),c.iter(e.children,this.__unbindWatcher,this)},__bindWatcher:function(i){for(var e=null,t=this.__environment.length-1;0<=t;--t){var n=this.__environment[t];if((e=this._navigate(n,i.expression)).properties&&!e.tail)break;e=null}if(null===e){var s=this.__defaults.watch||this.__environment[0];(e=this._navigate(s,i.expression)).properties||l.__observable_guid!==s.__observable_guid||(e.properties=s),e.properties||(e=null)}if(null!==e){i.properties=e.properties;var r=e.head+(e.head&&e.tail?".":"")+e.tail;i.propertiesPrefix=r,i.properties.on("change:"+i.propertiesPrefix,function(e,t,n){c.iter(i.children,this.__unbindWatcher,this),c.iter(i.children,this.__bindWatcher,this),(i.value!=e||n)&&(i.value=e,c.iter(i.cbs,function(e){e.callback.apply(e.context)},this))},this);var a=i.properties.get(r);a!=i.value&&(i.value=a,c.iter(i.cbs,function(e){e.callback.apply(e.context)},this)),c.iter(i.children,this.__bindWatcher,this)}},read:function(e){for(var t=this.__environment.length-1;0<=t;--t){var n=this._read(this.__environment[t],e);if(n)return h.is_function(n.value)?r.as_method(n.value,n.context):n.value}return null},write:function(e,t){for(var n=this.__environment.length-1;0<=n;--n)if(this._write(this.__environment[n],e,t,!1))return;this._write(this.__defaults.write||this.__environment[0],e,t,!0)},execute:function(e,t,n){var i={},s=[];c.iter(e,function(e){var t=this.read(e);null===t&&u.splitFirst(e,".").head in window||(s.push(e),i[e]=t)},this);var r=this.__expand(i),a=t.call(this.__context,r);if(!n){var o=this.__collapse(r,s);for(var l in o)l in i&&i[l]==o[l]||this.write(l,o[l])}return a},_sub_navigate:function(e,t,n,i,s){var r={properties:e,head:t,tail:n,parent:i,current:s};if(!n||!s||!h.is_object(s))return r;var a=u.splitFirst(n,"."),o=t?t+"."+a.head:a.head;return _.is_instance_of(s)&&!s.destroyed()&&(s=s.acquire(this),this.__acquiredProperties[s.cid()]=s),l.__observable_guid!==s.__observable_guid||s.destroyed()?a.head in s?this._sub_navigate(e,o,a.tail,s,s[a.head]):r:s.hasKey(a.head)?this._sub_navigate(s,a.head,a.tail,s,s.get(a.head)):a.head in s?this._sub_navigate(e,o,a.tail,s,s[a.head]):{properties:s,head:a.head,tail:a.tail,parent:s,current:null}},_navigate:function(e,t){return this._sub_navigate(null,"",t,null,e)},_read:function(e,t){var n=this._navigate(e,t);return n.tail?null:{value:n.current,context:n.parent==e?this.__context:n.parent}},_write:function(e,t,n,i){var s=this._navigate(e,t);if(s.tail&&!i)return!1;var r=s.tail.split(".");if(s.properties)s.properties.set(s.head+(s.head&&s.tail?".":"")+s.tail,n);else{for(var a=s.current,o=0;o<r.length-1;++o)a[r[o]]={},a=a[r[o]];a[r[r.length-1]]=n}return!0},__expand:function(e){var r={};return c.iter(e,function(e,t){for(var n=r,i=t.split("."),s=0;s<i.length-1;++s)i[s]in n&&h.is_object(n[i[s]])&&null!==n[i[s]]||(n[i[s]]={}),n=n[i[s]];n[i[i.length-1]]=e}),r},__collapse:function(s,e){var r={};return c.iter(e,function(e){for(var t=e.split("."),n=s,i=0;i<t.length;++i)n=n[t[i]];r[e]=n}),r}}}])}),e.define("module:Data.AbstractMultiScope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Properties.ObservableMixin"],function(e,t,n,i,s){return e.extend({scoped:s},[t,n,i,function(t){return{constructor:function(){t.constructor.call(this);for(var e=this.iterator();e.hasNext();)this.delegateEvents(null,e.next())},destroy:function(){for(var e=this.iterator();e.hasNext();)e.next().off(null,null,this);t.destroy.call(this)},set:function(e,t){for(var n=this.iterator();n.hasNext();)n.next().set(e,t);return this},get:function(e){var t=this.iterator();return t.hasNext()?t.next().get(e):null},hasKey:function(e){for(var t=this.iterator();t.hasNext();)if(t.next().hasKey(e))return!0;return!1},setProp:function(e,t){for(var n=this.iterator();n.hasNext();)n.next().setProp(e,t);return this},getProp:function(e){var t=this.iterator();return t.hasNext()?t.next().getProp(e):null},define:function(e,t){for(var n=this.iterator();n.hasNext();)n.next().define(e,t);return this},call:function(e){return this.execute.apply(this,arguments)},execute:function(e){for(var t=this.iterator(),n=null;t.hasNext();){var i=t.next(),s=i.execute.apply(i,arguments);n=n||s}return n},materialize:function(e){return e?this.iterator().next():this.iterator().asArray()},iterator:function(){throw"Abstract"},_addScope:function(e){return this.delegateEvents(null,e),this.trigger("addscope",e),this},_removeScope:function(e){return e.off(null,null,this),this.trigger("removescope",e),this}}}])}),e.define("module:Data.ManualMultiScope",["module:Data.AbstractMultiScope"],function(e,t){return e.extend({scoped:t},function(n){return{constructor:function(e,t){this.__iteratorCallback=e,this.__iteratorContext=t,n.constructor.call(this)},iterator:function(){return this.__iteratorCallback.call(this.__iteratorContext)},addScope:function(e){return this._addScope(e)},removeScope:function(e){return this._removeScope(e)}}})}),e.define("module:Data.MultiScope",["module:Data.AbstractMultiScope","base:Iterators.ArrayIterator"],function(e,t,n){return e.extend({scoped:n},function(i){return{constructor:function(e,t,n){this.__owner=e,this.__base=t,this.__queryStr=n,this.__query=this.auto_destroy(this.__owner.__manager.query(this.__owner,n)),i.constructor.call(this),this.__query.on("add",this._addScope,this),this.__query.on("remove",this._removeScope,this)},iterator:function(){return new t(this.__query.result())},parent:function(){return this.__owner.scope(this.__base,this.__queryStr+"<")},root:function(){return this.__owner.root()},children:function(){return this.__owner.scope(this.__base,this.__queryStr+">")},scope:function(e,t){return arguments.length<2&&(t=this.__queryStr+e,e=this.__base),this.__owner.scope(e,t)},freeze:function(){this.__query.off("add",null,this)}}})}),e.define("module:Parser",["base:Types","base:Objs","base:JavaScript"],function(r,l,c){return{__cache:{},__functions:{},secureMode:!1,compileFunction:function(e){if(!((e=e.trim())in this.__functions)){if(this.secureMode)throw"Dynamics Secure Mode prevents creation of function code '"+e+"'.";this.__functions[e]=new Function("obj","with (obj) { return "+e+"; }")}return this.__functions[e]},registerFunctions:function(e){this.__functions=l.extend(this.__functions,e)},parseText:function(e){if(!e)return null;for(var t=[];e;){var n=e.indexOf("{{"),i=null;if(0===n){for(n=e.indexOf("}}");n+2<e.length&&"}"==e.charAt(n+2);)n++;0<=n?(n+=2,i=this.parseCode(e.substring(2,n-2))):n=e.length}else n<0&&(n=e.length);t.push(i||e.substring(0,n)),e=e.substring(n)}if(1==t.length)return r.is_string(t[0])?null:t[0];var s={};return l.iter(t,function(e){r.is_string(e)||l.iter(e.dependencies,function(e){s[e]=!0})}),{func:function(n){var i=null;return l.iter(t,function(e){var t=r.is_string(e)?e:e.func(n);i=null===i?t:i+t}),i},dependencies:l.keys(s)}},parseCode:function(e){var t=this.__cache[e];if(!t){var n=!1,i=!1,s=!1,r=e;"="===r.charAt(0)?(n=!0,r=r.substring(1)):"-"===r.charAt(0)?(i=!0,r=r.substring(1)):"*"===r.charAt(0)&&(s=!0,r=r.substring(1));var a=r.lastIndexOf("::"),o=null;0<=a&&(o=r.substring(0,a).trim(),r=r.substring(a+2)),t={bidirectional:n,html:i,noentities:s,args:o,variable:n?r:null,func:this.compileFunction(r),dependencies:l.keys(l.objectify(c.extractIdentifiers(r,!0)))},this.__cache[e]=t}return l.clone(t,1)}}}),e.define("module:Data.ScopeManager",["base:Class","base:Trees.TreeNavigator","base:Classes.ObjectIdScopeMixin","base:Trees.TreeQueryEngine"],function(e,t,n,i,s){return e.extend({scoped:s},[t,n,function(t){return{constructor:function(e){t.constructor.call(this),this.__root=e,this.__watchers=[],this.__query=this._auto_destroy(new i(this))},nodeRoot:function(){return this.__root},nodeId:function(e){return e.cid()},nodeParent:function(e){return e.__parent},nodeChildren:function(e){return e.__children},nodeData:function(e){return e.data()},nodeWatch:function(e,t,n){e.on("data",function(){t.call(n,"data")},n),e.on("add",function(e){t.call(n,"addChild",e)},n),e.on("destroy",function(){t.call(n,"remove")},n)},nodeUnwatch:function(e,t,n){e.off(null,null,n)},query:function(e,t){return this.__query.query(e,t)}}}])}),e.define("module:Data.Scope",["base:Class","base:Events.EventsMixin","base:Events.ListenMixin","base:Classes.ObjectIdMixin","base:Functions","base:Types","base:Strings","base:Objs","base:Ids","base:Properties.Properties","base:Collections.Collection","base:Events.Events","base:Properties.ObservableMixin","module:Data.ScopeManager","module:Data.MultiScope","module:Data.AbstractMultiScope","module:Data.Friendgroup"],function(i,e,t,n,s,r,a,o,l,c,h,u,_,d,p,f,m,g){return i.extend({scoped:g},[e,t,n,_,function(t){return{constructor:function(n){(n=o.extend({functions:{},data:{},parent:null,scopes:{},bind:{},attrs:{},extendables:[],collections:{},computed:{},events:{},channels:{},registerchannels:[],friends:{}},n)).bindings&&(n.bind=o.extend(n.bind,n.bindings)),this._channels={},this.__channelCache={};var e=n.parent;this.__manager=e?e.__manager:this._auto_destroy(new d(this)),t.constructor.call(this),this.__parent=e,this.__root=e?e.root():this,this.__children={},this.__extendables=o.objectify(n.extendables),this.__properties=n.properties||new c,this.__properties.increaseRef(this),this.__properties.on("change",function(e,t,n){this.trigger("change:"+e,t,n)},this),this.__functions=o.map(n.functions,function(e){return r.is_string(e)?s.as_method(this[e],this):e},this),this.__scopes={},this.__data=n.data,o.iter(r.is_function(n.attrs)?n.attrs.call(this):n.attrs,function(e,t){this.__properties.has(t)||this.set(t,e)},this),this.setAll(),o.iter(r.is_function(n.collections)?n.collections.call(this):n.collections,function(e,t){r.is_array(n.collections)&&(t=e,e=[]),(!this.__properties.has(t)||i.is_instance_of(this.__properties.get(t))&&this.__properties.get(t).destroyed())&&this.set(t,this.auto_destroy(new h({objects:e,release_references:!0})))},this),e&&e.__add(this),this.scopes=o.map(n.scopes,function(e){return this.scope(e)},this),o.iter(n.bind,function(e,t){var n=e.indexOf(":");this.bind(this.scope(e.substring(0,n)),t,{secondKey:e.substring(n+1)})},this),o.iter(n.computed,function(e,t){var n=a.splitFirst(t,":");this.__properties.compute(n.head,e,this,n.tail.split(","))},this),o.iter(n.events,function(e,t){this.on(t,e,this)},this),o.iter(n.registerchannels,this.registerChannel,this),o.iter(n.channels,function(e,t){var n=a.splitFirst(t,":");this.channel(n.head)&&this.listenOn(this.channel(n.head),n.tail,e,this)},this),this.friendgroup||!e?this.friendgroup=this.auto_destroy(new m(e?e.friendgroup:null)):this.friendgroup=e.friendgroup,this.friends={},this.__friends=n.friends,o.iter(this.__friends,function(e,t){this.friends[t]=this.friendgroup.watchScope(this,e)},this)},friendgroup:!1,destroy:function(){this.trigger("destroy"),o.iter(this.__friends,function(e){this.friendgroup.unwatchScope(this,e)},this),o.iter(this.__scopes,function(e){e.destroy()}),o.iter(this.__children,function(e){e.destroy()}),this.__properties.decreaseRef(this),this.__parent&&this.__parent.__remove(this),t.destroy.call(this)},__object_id_scope:function(){return this.__manager},__add:function(e){this.__children[e.cid()]=e,this.trigger("add",e)},__remove:function(e){this.trigger("remove",e),delete this.__children[e.cid()]},data:function(e,t){return 0===arguments.length?this.__data:1===arguments.length?this.__data[e]:(this.__data[e]=t,this.trigger("data",e,t),this)},set:function(e,t,n){return this.destroyed()||(e in this.__extendables&&(t=o.tree_extend(this.__properties.get(e)||{},t)),this.__properties.set(e,t,n)),this},setAll:function(e){return this.__properties.setAll(e),this},hasKey:function(e){return this.__properties.hasKey(e)},get:function(e){return this.__properties.get(e)},setProp:function(e,t){return this.__properties.setProp(e,t),this},getProp:function(e){return this.__properties.getProp(e)},define:function(e,t,n){return this.__functions[e]=s.as_method(t,n||this),this},call:function(e){return this.execute.apply(this,arguments)},execute:function(e){var t=s.getArguments(arguments,1);try{return r.is_string(e)?this.__functions[e].apply(this,t):e.apply(this,t)}catch(n){return this.handle_call_exception(e,t,n)}},handle_call_exception:function(e,t,n){throw n},parent:function(){return this.__parent},_eventChain:function(){return this.parent()},registerChannel:function(e){this._channels[e]=this.auto_destroy(new u)},channel:function(e){if(!(e in this.__channelCache)){var t=null;this._channels[e]?t=this._channels[e]:this.__parent&&(t=this.__parent.channel(e)),this.__channelCache[e]=t}return this.__channelCache[e]},root:function(){return this.__root},children:function(){return this.scope(">")},properties:function(){return this.__properties},compute:function(e,t,n){this.properties().compute(e,t,this,n)},scope:function(e,t){if(arguments.length<2&&(t=e,e=this),!t)return e;if(e&&e.instance_of(p)&&(e=e.iterator().next()),!e)return e;var n=l.objectId(e)+"_"+t;return this.__scopes[n]||(this.__scopes[n]=new p(this,e,t)),this.__scopes[n]},bind:function(e,t,n){if(e.instance_of(f)){for(var i=e.iterator();i.hasNext();)this.properties().bind(t,i.next().properties(),n);e.on("addscope",function(e){this.properties().bind(t,e.properties(),n)},this),e.on("removescope",function(e){this.properties().unbind(t,e.properties())},this)}else this.properties().bind(t,e.properties(),n)}}}],{_extender:{functions:function(e,t){return o.extend(o.clone(e,1),t)},friends:function(e,t){return o.extend(o.clone(e,1),t)}}})}),e.define("module:DomObserver",["base:Class","base:Objs","browser:DomMutation.NodeInsertObserver","module:Registries","module:Dynamic","browser:Dom"],function(e,n,i,s,r,a,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),e=e||{},this.__initialRoot=e.root,this.__persistent_dynamics=!!e.persistent_dynamics,this.__allowed_dynamics=e.allowed_dynamics?n.objectify(e.allowed_dynamics):null,this.__forbidden_dynamics=e.forbidden_dynamics?n.objectify(e.forbidden_dynamics):null,this.__ignore_existing=e.ignore_existing,this.__dynamics={},this.__enabled=!1,"enabled"in e&&!e.enabled||this.enable()},enable:function(){this.__enabled||(this.__enabled=!0,this.__root=a.unbox(this.__initialRoot||document.body),this.__ignore_existing||n.iter(s.handler.classes(),this.__registerExisting,this),this.__observer=i.create({root:this.__root,filter:this.__observerFilter,context:this}),this.__observer.on("node-inserted",this.__nodeInserted,this))},disable:function(){this.__enabled&&(this.__enabled=!1,this.__observer.weakDestroy())},__registerExisting:function(e,t){if((!this.__forbidden_dynamics||!this.__forbidden_dynamics[t])&&(!this.__allowed_dynamics||this.__allowed_dynamics[t]))for(var n=this.__root.getElementsByTagName(t.toUpperCase()),i=0;i<n.length;++i){var s=n[i];s.dynamicshandler||this.__nodeInserted(s)}},addAllowedDynamic:function(e){this.__allowed_dynamics=this.__allowed_dynamics||{},this.__allowed_dynamics[e]=!0;var t=s.handler.classes()[e];this.__enabled&&!this.__ignore_existing&&t&&this.__registerExisting(t,e)},destroy:function(){this.disable(),n.iter(this.__dynamics,function(e){e.off(null,null,this),this.__persistent_dynamics||e.weakDestroy()},this),t.destroy.call(this)},__observerFilter:function(e){if(e.dynamicshandler||!e.tagName)return!1;var t=e.tagName.toLowerCase();return!!s.handler.get(t)&&((!this.__forbidden_dynamics||!this.__forbidden_dynamics[t])&&!(this.__allowed_dynamics&&!this.__allowed_dynamics[t]))},__nodeInserted:function(e){var t=new r({element:e,remove_observe:!0});(this.__dynamics[t.cid()]=t).on("destroy",function(){delete this.__dynamics[t.cid()]},this),t.activate()}}},{__singleton:null,activate:function(e){this.__singleton||(this.__singleton=new this(e))}})}),e.define("module:Exceptions.DynamicsCallException",["base:Exceptions.Exception"],function(e,t){return e.extend({scoped:t},function(s){return{constructor:function(e,t,n,i){s.constructor.call(this,"Dynamics Exception in '"+e+"' calling method '"+t+"' : "+i)}}})}),e.define("module:Dynamic",["module:Data.Scope","module:Parser","module:Handlers.HandlerMixin","module:Exceptions.DynamicsCallException","base:Objs","base:Strings","base:Types","base:Functions","base:Promise","base:Events.Events","base:Loggers.LoggableMixin","module:Registries","browser:Dom","browser:Events","base:Class"],function(e,t,n,i,s,r,a,o,l,c,h,u,_,d,p,f){var m;return m=e.extend({scoped:f},[n,h,function(t){return{supportsGc:!0,_notifications:{_activate:"__createActivate"},constructor:function(n){if(this.initial=this.initial||{},n=s.extend(s.clone(this.initial,1),n),this.domevents=s.extend(this.domevents,n.domevents),this.windowevents=s.extend(this.windowevents,n.windowevents),s.iter(this.cls.__initialForward,function(e){e in this&&(e in n?a.is_object(this[e])&&a.is_object(n[e])&&(n[e]=s.extend(s.clone(this[e],1),n[e])):n[e]=this[e])},this),n.typedAttrs&&n.types&&s.iter(n.typedAttrs,function(e,t){n.attrs[t]=n.types[t]?a.parseType(e,n.types[t]):e}),this.__dispose=n.dispose,s.iter(this.object_functions,function(t){this[t]=function(){var e=o.getArguments(arguments);return e.unshift(t),this.execute.apply(this,e)}},this),!n.parent&&n.parentHandler)for(var e=n.parentHandler;e&&!n.parent;)n.parent=e.instance_of(m)?e:null,e=e._parentHandler;t.constructor.call(this,n),this.__references=n.references,s.iter(this.__references,function(e){this.on("change:"+e,function(e,t){t&&p.is_class_instance(t)&&!t.destroyed()&&t.decreaseRef(this),e&&p.is_class_instance(e)&&!e.destroyed()&&e.increaseRef(this)},this);var t=this.get(e);t&&p.is_class_instance(t)&&!t.destroyed()&&t.increaseRef(this)},this),this._channels.global=this.cls.__globalEvents,n.tagName&&(this._tagName=n.tagName,this.data("tagname",this._tagName)),this.functions=this.__functions,this._handlerInitialize(n),this.__createActivate=n.create||function(){},this.dom_events={},this.window_events={},this.__domEvents=new d,this.inheritables=(this.parent()?this.parent().inheritables:[]).concat(this.inheritables||[]),this.friendgroup.registerScope(this,this.cls.registeredName())},handle_call_exception:function(e,t,n){return u.throwException(new i(this.cls.classname,e,t,n)),null},hierarchyName:function(){return(this.parent()?this.parent().hierarchyName()+" > ":"")+this.cls.registeredName()},_preAfterActivate:function(a){this.__domEvents.clear();var o=this;s.iter(this.domevents,function(t,e){var n=e.split(" "),i=[a];1<n.length&&(i=a.querySelectorAll(n[1]));for(var s=function(e){o.execute(t,e,this)},r=0;r<i.length;++r)this.__domEvents.on(i[r],n[0],s)},this),s.iter(this.windowevents,function(t,e){this.__domEvents.on(window,e,function(e){o.execute(t,e,this)})},this)},destroy:function(){this.friendgroup.unregisterScope(this,this.cls.registeredName()),this.free&&this.free(),s.iter(this.__references,function(e){var t=this.get(e);t&&p.is_class_instance(t)&&!t.destroyed()&&t.decreaseRef(this)},this),s.iter(this.__dispose,function(e){var t=this.get(e);this.set(e,null),t&&t.weakDestroy&&t.weakDestroy()},this),this.__domEvents.destroy(),t.destroy.call(this)}}}],{__initialForward:["functions","attrs","extendables","collections","template","create","scopes","bindings","computed","types","events","dispose","channels","registerchannels","references","friends"],__globalEvents:new c,canonicName:function(){return this.classname?r.last_after(this.classname,".").toLowerCase():""},registeredName:function(){return this.__registeredName||"ba-"+this.canonicName()},findByElement:function(e){return e&&(e=_.unbox(e))&&e.dynamicshandler?e.dynamicshandler:null},findByElementPromise:function(e){if(!e)return null;if(!(e=_.unbox(e)))return null;if(e.dynamicshandler)return l.value(e.dynamicshandler);e.dynamicshandlerpromise=e.dynamicshandlerpromise||[];var t=l.create();return e.dynamicshandlerpromise.push(t),t},register:function(e,t){return t=t||u.handler,this.__registeredName=e||this.registeredName(),t.register(this.__registeredName,this),this},registerFunctions:function(e){return t.registerFunctions(e),this},activate:function(e){var t=new this(e||{element:document.body,name_registry:!0});return t.activate(),t},attachStringTable:function(e){return this.__stringTable=e,this},addStrings:function(e){return this.__stringTable.register(e,this.registeredName()),this},string:function(e){var t=null;return this.__stringTable&&(t=this.__stringTable.get(e,this.registeredName())),!t&&this.parent.string&&(t=this.parent.string(e)),t},stringUnicode:function(e){var t=null;return this.__stringTable&&(t=this.__stringTable.get(e,this.registeredName())),!t&&this.parent.string&&(t=this.parent.string(e)),_.entitiesToUnicode(t)},_extender:{events:function(e,t){return s.extend(s.clone(e,1),t)},types:function(e,t){return s.extend(s.clone(e,1),t)},registerchannels:function(e,t){return s.extend(s.clone(e,1),t)},channels:function(e,t){return s.extend(s.clone(e,1),t)},attrs:function(e,t){return a.is_function(e)?a.is_function(t)?function(){return s.extend(e.call(this),t.call(this))}:function(){return s.extend(e.call(this),t)}:a.is_function(t)?function(){return s.extend(s.clone(e,1),t.call(this))}:s.extend(s.clone(e,1),t)},inheritables:function(e,t){return(e||[]).concat(t||[])},dispose:function(e,t){return(e||[]).concat(t||[])},references:function(e,t){return(e||[]).concat(t||[])}}})}),e.define("module:Exceptions.TagHandlerException",["base:Exceptions.Exception"],function(e,t){return e.extend({scoped:t},function(n){return{constructor:function(e,t){n.constructor.call(this,e+" is expecting a tag handler, but no registered tag handler for "+t+" has been found.")}}})}),e.define("module:Handlers.Attr",["base:Class","module:Exceptions.TagHandlerException","module:Parser","base:Types","base:Objs","base:Async","base:Strings","module:Registries","browser:Dom","browser:Events"],function(n,e,r,i,a,o,l,c,h,t,s){return n.extend({scoped:s},function(s){return{constructor:function(e,t,n){if(s.constructor.call(this),this._dataNode=n||e,this._node=e,this._tagHandler=null,this._attrName=t.name,this._isEvent=0===this._attrName.indexOf("on"),this._updatable=!this._isEvent,this._attrValue=t.value,this._dyn=r.parseText(this._attrValue),this._dyn){var i=this;this._dataNode.mesh().watch(this._dyn.dependencies,function(){i.__updateAttr()},this)}this.updateElement(e.element(),t)},destroy:function(){this._partial&&this._partial.destroy(),this._dyn&&this._dataNode.mesh().unwatch(this._dyn.dependencies,this),s.destroy.call(this)},__inputVal:function(e,t){var n="checkbox"===e.type||"radio"===e.type?"checked":"value";return 1<arguments.length&&(t=null===t||t===undefined?"":t,"select-one"===e.type?o.eventually(function(){e[n]=t}):e[n]=t),e[n]},_events:function(){return this.__events||(this.__events=this.auto_destroy(new t)),this.__events},updateElement:function(e,t){this._element=e,t=t||e.attributes[this._attrName],this._attribute=t;var n=l.splitFirst(this._attrName,":");this._partialCls=c.partial.get(n.head),this._partial&&(this._partial.destroy(),this._partial=null),this.__updateAttr(),this._partialCls&&(this._partial=c.partial.create(n.head,this._node,this._dyn?this._dyn.args:{},this._attrValue,n.tail),this._partial.cls.meta.value_hidden&&(this._attribute.value="")),this._dyn&&(this._dyn.bidirectional&&"value"==this._attrName&&this._events().on(this._element,"change keyup keypress keydown blur focus update input",function(){this._dataNode.mesh().write(this._dyn.variable,this.__inputVal(this._element))},this),this._isEvent&&(this._attribute.value="",this._events().on(this._element,this._attrName.substring(2),function(){var e=this._node._locals.domEvent;this._node._locals.domEvent=arguments,this._node.__executeDyn(this._dyn),this._node&&this._node._locals&&(this._node._locals.domEvent=e)},this)))},__updateAttr:function(){if(this._updatable){var e=this._attrValue;if(!this._dyn||this._partialCls&&this._partialCls.manualExecute||(e=this._dataNode.__executeDyn(this._dyn)),(e!=this._attrValue||i.is_array(e))&&(e||this._attrValue)){var t=this._attrValue;if(this._attrValue=e,!this._partial||!this._partial.cls.meta.value_hidden){var n=this._dyn.noentities?e:h.entitiesToUnicode(e);null===n&&"class"===this._attrName&&(n=""),this._attribute.value=n}this._partial&&this._partial.change(e,t),"value"===this._attrName&&this._element.value!==e&&this.__inputVal(this._element,e),this._tagHandler&&this._dyn&&!this._partial&&this._tagHandler.properties().set(c.prefixNormalize(this._attrName),e)}}},bindTagHandler:function(e){if(this.unbindTagHandler(this._tagHandler),this._tagHandler=e,this._partial)this._partial&&this._partial.bindTagHandler(e);else{var t=c.prefixNormalize(this._attrName);t&&(this._tagHandler.setArgumentAttr(t,n.is_pure_json(this._attrValue)?a.clone(this._attrValue,1):this._attrValue),this._dyn&&this._dyn.bidirectional&&(n.is_pure_json(this._attrValue)?this._tagHandler.properties().bind(t,this._node._handler.properties(),{deep:!0,left:!0,right:!0,secondKey:this._dyn.variable}):this._tagHandler.properties().on("change:"+t,function(e){this._dataNode.mesh().write(this._dyn.variable,e)},this)))}},prepareTagHandler:function(e){this._partial&&this._partial.prepareTagHandler(e)},unbindTagHandler:function(e){this._partial&&this._partial.unbindTagHandler(e),this._tagHandler&&this._tagHandler.properties().off(null,null,this),this._tagHandler=null},activate:function(){if(this._partial){if(this._partial.cls.meta.requires_tag_handler&&!this._tagHandler)return void c.throwException(new e(this._partial.cls.classname,this._node.tag()));this._partial.activate()}},deactivate:function(){this._partial&&this._partial.deactivate()}}})}),e.define("module:Handlers.HandlerMixin",["base:Objs","base:Strings","base:Functions","base:Types","browser:Loader","module:Handlers.Node","module:Registries","module:Handlers.HandlerNameRegistry","browser:DomMutation.NodeRemoveObserver","browser:Dom"],function(n,i,e,s,t,r,a,o,l,c){return{_notifications:{construct:"__handlerConstruct",destroy:"__handlerDestruct"},__handlerConstruct:function(){this._inheritableAttributes={},this.__activated=!1,this._mesh_extend={string:e.as_method(this.string,this),stringUnicode:e.as_method(this.stringUnicode,this)}},__handlerDestruct:function(){n.iter(this.__rootNodes,function(e){var t=e.element();e.destroy(),this.remove_on_destroy&&(t.innerHTML="")},this)},template:null,templateUrl:null,string:function(e){return this.cls.string?this.cls.string(e):this.parent()?this.parent().string(e):e},stringUnicode:function(e){return this.cls.stringUnicode?this.cls.stringUnicode(e):this.parent()?this.parent().stringUnicode(e):e},remove_on_destroy:!1,_handlerInitialize:function(e){(e=e||{}).name_registry&&(this.__nameRegistry=this.auto_destroy(new o)),this.__types=e.types||{},this._parentHandler=e.parentHandler||null,this._parentElement=e.parentElement,this._argumentAttrs={},this.template=e.template||this.template,this.templateUrl=e.templateUrl||this.templateUrl,this.templateUrl&&(this.templateUrl=i.replaceAll(this.templateUrl,"%",i.last_after(this.cls.classname||"",".").toLowerCase())),this.__elements=e.element?[c.unbox(e.element)]:[];var t=c.unbox(e.element?e.element:this._parentElement);if(!t)throw this.cls.classname+" requires an existing DOM element to attach to.";this.initialContent=t.innerHTML,this.__activeElement=e.element?c.unbox(e.element):c.unbox(this._parentElement),e.remove_observe&&(this.__removeObserver=this.auto_destroy(l.create(this.__activeElement)),this.__removeObserver.on("node-removed",function(){this.weakDestroy()},this)),this.__activeElement.dynamicshandler=this},_handlerInitializeTemplate:function(e,t){var n=a.templates.create(e);0<this.__elements.length?(this.__activeElement=this.__elements[0],this.__elements[0].innerHTML="",n.forEach(function(e){this.__elements[0].appendChild(e)},this)):t?(this.__activeElement=c.unbox(t),this.__elements=n,this.__activeElement.innerHTML="",n.forEach(function(e){this.__activeElement.appendChild(e)},this)):(this.__elements=n,this.__activeElement=this.__elements[0].parentNode)},nameRegistry:function(){return this.__nameRegistry||(this.parent()?this.parent().nameRegistry():null)},byName:function(e){return this.nameRegistry().get(e)},__assocs:{},addAssoc:function(e,t){this.__assocs[e]=t},removeAssoc:function(e){delete this.__assocs[e]},activated:function(){return this.__activated},assoc:function(e){return this.byName(this.__assocs[e]||e)},setArgumentAttr:function(e,t){e in this.__extendables&&(t=n.tree_extend(this.properties().get(e)||{},t)),this.__types[e]&&(t=s.parseType(t,this.__types[e])),this.properties().set(e,t),this._argumentAttrs[e]=!0},isArgumentAttr:function(e){return!!this._argumentAttrs[e]},activeElement:function(){return this.__activeElement},element:function(){return this.__elements},_updateActiveElement:function(e){this.__activeElement=c.unbox(e),this.__removeObserver&&(this.__removeObserver.weakDestroy(),this.__removeObserver=this.auto_destroy(l.create(this.__activeElement)),this.__removeObserver.on("node-removed",function(){this.weakDestroy()},this))},_deferActivate:function(){return!1},activate:function(){if(!this._deferActivate()&&!this.__activated){if(this.__activated=!0,this.template)this._handlerInitializeTemplate(this.template,this._parentElement);else if(this.templateUrl)return this.__activated=!1,void t.loadHtml(this.templateUrl,function(e){this.templateUrl=null,this.template=e,this.activate()},this);if(this._notify("_activate"),this.__rootNodes=[],this.__elements.forEach(function(e){this.__rootNodes.push(new r(this,null,e))},this),this._preAfterActivate(this.__activeElement),this._afterActivate(this.__activeElement),this.__activeElement.dynamicshandlerpromise){this.__activeElement.dynamicshandlerpromise.forEach(function(e){e.asyncSuccess(this.__activeElement.dynamicshandler)},this),this.__activeElement.dynamicshandlerpromise=null;try{delete this.__activeElement.dynamicshandlerpromise}catch(e){}}this.trigger("dynamic-activated")}},_afterActivate:function(e){},registerInheritableAttribute:function(e,t,n,i){e=a.prefixNormalize(e,!0),this._inheritableAttributes[e]=this._inheritableAttributes[e]||{},this._inheritableAttributes[e][t]={value:n,name:t,node:i}},unregisterInheritableAttribute:function(e,t){e=a.prefixNormalize(e,!0),this._inheritableAttributes[e]&&(delete this._inheritableAttributes[e][t],s.is_empty(this._inheritableAttributes[e])&&delete this._inheritableAttributes[e])},getInheritableAttributes:function(e){return e=a.prefixNormalize(e,!0),n.values(this._inheritableAttributes[e])}}}),e.define("module:Handlers.Handler",["base:Class","module:Handlers.HandlerMixin","base:Properties.Properties","module:Registries"],function(e,t,n,i,s){return e.extend({scoped:s},[t,function(t){return{constructor:function(e){t.constructor.call(this),e=e||{},this._properties=e.properties?e.properties:new n,this.functions={},this._handlerInitialize(e)},properties:function(){return this._properties}}}],{register:function(e,t){(t=t||i.handler).register(e,this)}})}),e.define("module:Handlers.HandlerNameRegistry",["base:Class","base:Objs"],function(e,t,n){return e.extend({scoped:n},function(e){return{__handlers:{},destroy:function(){t.iter(this.__handlers,function(e,t){this.unregister(t)},this),e.destroy.call(this)},register:function(e,t){this.unregister(t),(this.__handlers[t]=e).on("destroy",function(){this.unregister(t)},this)},unregister:function(e){if(e in this.__handlers){var t=this.__handlers[e];delete this.__handlers[e],t.destroyed()||t.off(null,null,this)}},get:function(e){return this.__handlers[e]}}})}),e.define("module:Handlers.Node",["base:Class","base:Events.EventsMixin","base:Ids","browser:Dom","browser:Info","module:Parser","module:Data.Mesh","base:Objs","base:Types","module:Registries","module:Handlers.Attr"],function(e,t,l,s,r,c,h,u,n,i,a,o){var _;return _=e.extend({scoped:o},[t,function(o){return{constructor:function(e,t,n,i){o.constructor.call(this),this._handler=e,(this._parent=t)&&(t._children[l.objectId(this)]=this),this._element=n;try{n&&(n.dynnodehandler=this)}catch(a){}if(this._tag=n.tagName?n.tagName.toLowerCase():"",0<=this._tag.indexOf(":")&&(this._tag=this._tag.substring(this._tag.indexOf(":")+1)),this._dynTag=c.parseText(this._tag),this._tagHandler=null,this._template=n.outerHTML,this._innerTemplate=n.innerHTML,this._locals=i||{},this._active=!0,this._dyn=null,this._children={},this._locked=!0,this._attrs={},this._expandChildren=!0,this._touchedInner=!1,this._mesh=new h([window,this.properties(),this._locals,this._handler.functions,this._handler.friends||{},this._handler._mesh_extend],this._handler,{read:this.properties(),write:this.properties(),watch:this.properties()}),this._element.attributes){for(var s=[],r=0;r<this._element.attributes.length;++r)s.push(this._element.attributes[r]);u.iter(s,this._registerAttr,this)}this._locked=!1,this._active=!this._active,this._active?this.deactivate():this.activate()},destroy:function(){u.iter(this._attrs,function(e){e.destroy()}),this._removeChildren(),this._tagHandler&&!this._tagHandler.destroyed()&&(this._tagHandler.cacheable&&this._tagHandler.cls.cacheable?i.handlerCache.suspend(this._tagHandler,this._element):this._tagHandler.weakDestroy()),this._dyn&&this.properties().off(null,null,this._dyn),this._parent&&delete this._parent._children[l.objectId(this)],this._mesh.destroy(),o.destroy.call(this)},_registerAttr:function(e){e.name in this._attrs?this._attrs[e.name].updateAttribute(e):this._attrs[e.name]=new a(this,e)},tag:function(){return this._tag},element:function(){return this._element},__dynOff:function(e){this._mesh.unwatch(e.dependencies,e)},__dynOn:function(e,t){var n=this;this._mesh.watch(e.dependencies,function(){t.apply(n)},e)},mesh:function(){return this._mesh},__executeDyn:function(e,t){return n.is_object(e)?this._mesh.execute(e.dependencies,e.func,t):e},__tagValue:function(){return this._dynTag?this.__executeDyn(this._dynTag,!0):this._tag},__unregisterTagHandler:function(){this._tagHandler&&(u.iter(this._attrs,function(e){e.unbindTagHandler(this._tagHandler)},this),this.off(null,null,this._tagHandler),this._tagHandler.cacheable&&this._tagHandler.cls.cacheable?i.handlerCache.suspend(this._tagHandler,this._element):this._tagHandler.weakDestroy(),this._tagHandler=null,u.iter(this._handler.getInheritableAttributes(this.__tagValue()),function(e){this._attrs[e.name].weakDestroy(),delete this._attrs[e.name]},this))},__registerTagHandler:function(){this.__unregisterTagHandler();var e=this.__tagValue();if(e){if(this._dynTag&&this._element.tagName.toLowerCase()!=e.toLowerCase()&&(this._element=s.changeTag(this._element,e),u.iter(this._attrs,function(e){e.updateElement(this._element)},this)),!i.handler.get(e))return!1;if(r.isInternetExplorer()&&r.internetExplorerVersion()<9){var t=this._element===this._handler.activeElement();this._element=s.changeTag(this._element,e),u.iter(this._attrs,function(e){e.updateElement(this._element)},this),t&&this._handler._updateActiveElement(this._element)}var n={parentElement:this._element,parentHandler:this._handler,autobind:!1,cacheable:!1,tagName:e};if(u.iter(this._handler.getInheritableAttributes(this.__tagValue()),function(e){this._attrs[e.name]=new a(e.node,e)},this),u.iter(this._attrs,function(e){e.prepareTagHandler(n)},this),!n.ignoreTagHandler)return n.cacheable&&(this._tagHandler=i.handlerCache.resume(e,this._element,this._handler)),this._tagHandler||(this._tagHandler=i.handler.create(e,n)),u.iter(this._handler.inheritables,function(e){this._tagHandler.set(e,this._handler.get(e))},this),u.iter(this._attrs,function(e){e.bindTagHandler(this._tagHandler)},this),this._tagHandler.activate(),!0}},activate:function(){if(!this._locked&&!this._active){if(this._locked=!0,this._active=!0,this._dynTag&&this.__dynOn(this._dynTag,function(){this.__registerTagHandler()}),!this.__registerTagHandler()&&this._expandChildren){this._restoreInnerTemplate&&(this._element.innerHTML=this._innerTemplate),this._touchedInner=!0,3==this._element.nodeType&&(this._dyn=c.parseText(this._element.textContent||this._element.innerText||this._element.nodeValue),this._dyn&&this.__dynOn(this._dyn,function(){this.__updateDyn()})),this.__updateDyn(!0);for(var e=0;e<this._element.childNodes.length;++e)this._element.childNodes[e]["ba-handled"]||this._registerChild(this._element.childNodes[e])}u.iter(this._attrs,function(e){e.activate()}),this._locked=!1}},__updateDyn:function(e){if(this._dyn){var t=this.__executeDyn(this._dyn);if(e||t!=this._dyn.value){this._dyn.value=t;var n=null;if(this._dyn.html&&(n=s.elementByTemplate(t,!0))&&((this._htmlElement||this._element).replaceWith(n),this._htmlElement=n),!n){t=null===t?"":t;var i=this._dyn.noentities?t:s.entitiesToUnicode(t);"textContent"in this._element&&(this._element.textContent=i),"innerText"in this._element&&(this._element.innerText=i),r.isInternetExplorer()&&r.internetExplorerVersion()<9&&"data"in this._element&&(this._element.data=i)}}}},_registerChild:function(e,t){return new _(this._handler,this,e,u.extend(u.clone(this._locals,1),t))},_removeChildren:function(){u.iter(this._children,function(e){e.destroy()})},deactivate:function(){this._active&&(this._active=!1,this._locked||(this._locked=!0,u.iter(this._attrs,function(e){e.deactivate()}),this._removeChildren(),this._dynTag&&this.__dynOff(this._dynTag),this.__unregisterTagHandler(),this._dyn&&(this.__dynOff(this._dyn),this._dyn=null),this._touchedInner&&(this._element.innerHTML=""),this._restoreInnerTemplate=!0,this._locked=!1))},properties:function(){return this._handler.properties()}}}])}),e.define("module:Handlers.Partial",["base:Class","base:JavaScript","base:Functions","base:Strings","module:Parser","module:Registries"],function(e,i,r,a,n,s,t){return e.extend({scoped:t},function(s){return{constructor:function(e,t,n,i){s.constructor.call(this),this._node=e,this._args=t,this._value=n,this._active=!1,this._postfix=i},change:function(e,t){this._value=e,this._change(e,t),this._apply(e,t)},activate:function(){this._active||(this._active=!0,this._activate(),this._apply(this._value,null))},deactivate:function(){this._active&&(this._active=!1,this._deactivate())},bindTagHandler:function(e){},unbindTagHandler:function(e){},prepareTagHandler:function(e){},_change:function(e,t){},_activate:function(){},_deactivate:function(){},_apply:function(e,t){},_execute:function(e){e=e||this._value;var t=n.parseText(e)||n.parseCode(e);this._node.__executeDyn(t)},_valueExecute:function(e){var t=this._value.trim(),n=t;a.starts_with(n,"{{")&&a.ends_with(n,"}}")&&(n=a.strip_end(a.strip_start(n,"{{"),"}}")),i.isProperIdentifier(n)?((e=r.getArguments(e)).unshift(n),this._node._handler.execute.apply(this._node._handler,e)):this._execute(t)}}},{meta:{},canonicName:function(){return this.classname?a.last_after(this.classname,".").toLowerCase():""},registeredName:function(){return this.__registeredName||"ba-"+this.canonicName()},register:function(e,t){t=t||s.partial,this.__registeredName=e||this.registeredName(),t.register(this.__registeredName,this)}})}),e.define("module:Registries",["base:Classes.ClassRegistry","base:Exceptions.AsyncExceptionThrower","browser:Dom","base:Strings"],function(e,n,r,i){return{handler:new e({},!0),partial:new e({},!0),prefixes:{ba:!0},prefixNormalize:function(e,t){var n=i.splitFirst(e||"","-");return this.prefixes[n.head]?n.tail:e},templates:{cache:{},create:function(e){e=e.trim();var t=this.cache[e];return t||(t=0===e.indexOf("<")?r.elementsByTemplate(e):[document.createTextNode(e)],this.cache[e]=t),t.map(function(e){return e.cloneNode(!0)})}},throwException:function(e){try{this.exceptionThrower||(this.exceptionThrower=new n),this.exceptionThrower.throwException(e)}catch(t){}},handlerCache:{cache:{},cacheDom:null,suspend:function(e,t){t=r.unbox(t),this.cacheDom||(this.cacheDom=document.createElement("div"),this.cacheDom.setAttribute("ba-ignore",""),this.cacheDom.style.display="none",document.body.appendChild(this.cacheDom));var n=e.data("tagname");this.cache[n]=this.cache[n]||[];for(var i=[],s=0;s<t.children.length;++s)i.push(t.children[s]);this.cache[n].push({handler:e,elements:i}),i.forEach(function(e){this.cacheDom.appendChild(e)},this)},resume:function(e,t,n){if(t=r.unbox(t),!this.cache[e]||0===this.cache[e].length)return null;var i=this.cache[e].shift();return t.innerHTML="",i.elements.forEach(function(e){t.appendChild(e)}),i.handler._handlerInitialize({parentHandler:n,parentElement:t}),i.handler}}}}),e.define("module:Partials.AssocPartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(s){return{constructor:function(e,t,n,i){s.constructor.apply(this,arguments),this._node._handler.addAssoc(i,n)},destroy:function(){this._node._handler.removeAssoc(this._postfix),s.destroy.call(this)}}});return n.register("ba-assoc"),n}),e.define("module:Partials.AttrsPartial",["module:Handlers.Partial","base:Objs","base:Class"],function(e,n,i,t){var s=e.extend({scoped:t},{_apply:function(e){if(this._active){var t=this._node._tagHandler?this._node._tagHandler.properties():this._node.properties();for(var n in e)t.set(n,e[n])}},bindTagHandler:function(e){for(var t in this._value)e.setArgumentAttr(t,i.is_pure_json(this._value[t])?n.clone(this._value[t],1):this._value[t])}});return s.register("ba-attrs"),s}),e.define("module:Partials.CachePartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},{bindTagHandler:function(e){e.cacheable=!0},prepareTagHandler:function(e){e.cacheable=!0}},{meta:{requires_tag_handler:!0}});return n.register("ba-cache"),n}),e.define("module:Partials.ClassPartial",["module:Handlers.Partial","browser:Dom"],function(e,s,t){var n=e.extend({scoped:t},{_apply:function(e){for(var t in e){var n=s.elementHasClass(this._node.element(),t),i=!!e[t];i!==n&&(i?s.elementAddClass(this._node.element(),t):s.elementRemoveClass(this._node.element(),t))}}});return n.register("ba-class"),n}),e.define("module:Partials.ClickPartial",["module:Handlers.Partial","browser:Events"],function(e,s,t){var n=e.extend({scoped:t},function(i){return{constructor:function(e,t,n){i.constructor.apply(this,arguments),this.auto_destroy(new s).on(this._node.element(),"click",function(e){e.stopPropagation(),this.executeAction()},this)},executeAction:function(){this._execute()}}},{manualExecute:!0});return n.register("ba-click"),n}),e.define("module:Partials.DataPartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},{_apply:function(e){this._node._tagHandler.data(this._postfix,e)},bindTagHandler:function(e){this._apply(this._value)}},{meta:{requires_tag_handler:!0}});return n.register("ba-data"),n}),e.define("module:Partials.DeeperPartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){var t=this._postfix.split(":");e.registerInheritableAttribute(t[0],t[1],this._value,this._node)},unbindTagHandler:function(e){if(e){var t=this._postfix.split(":");e.unregisterInheritableAttribute(t[0],t[1])}}}},{manualExecute:!0});return n.register("ba-deeper"),n}),e.define("module:Partials.EventForwardPartial",["module:Handlers.Partial","base:Functions"],function(e,s,t){var n=e.extend({scoped:t},{bindTagHandler:function(e){e.on("all",function(){var e=arguments[0];if(0!==e.indexOf("change:")){var t=s.getArguments(arguments,1),n=[e],i=this._postfix.trim();i&&(0===i.indexOf("~")?(i=i.substring(1),0===e.indexOf(i)&&(n=[e.substring(i.length+1)])):n=[i+"-"+e]),this._value&&(n=n.concat(this._value)),n=n.concat(t),this._node._handler.trigger.apply(this._node._handler,n)}},this,{off_on_destroyed:!0})},unbindTagHandler:function(e){e&&e.off(null,null,this)}});return n.register("ba-event-forward"),n}),e.define("module:Partials.EventPartial",["module:Handlers.Partial","base:Functions"],function(e,i,t){var n=e.extend({scoped:t},{bindTagHandler:function(e){var t=this._postfix.trim(),n=0===t.indexOf("~");n&&(t=t.substring(1)),e.on(t,function(){if(n){var e=i.getArguments(arguments);e.unshift(this._value||t),this._node._handler.trigger.apply(this._node._handler,e)}else this._valueExecute(arguments)},this)}},{manualExecute:!0});return n.register("ba-event"),n}),e.define("module:Partials.FunctionsPartial",["module:Handlers.Partial","browser:Info","base:Objs"],function(e,t,n,i){var s=e.extend({scoped:i},function(e){return{bindTagHandler:function(e){n.extend(e.__functions,this._value)}}});return s.register("ba-functions"),s}),e.define("module:Partials.GcPartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){this._value&&e.enableGc(this._value)}}});return n.register("ba-gc"),n}),e.define("module:Partials.HotkeyPartial",["module:Handlers.Partial","browser:Events","browser:Hotkeys"],function(e,a,o,t){var n=e.extend({scoped:t},function(r){return{constructor:function(e,t,n){r.constructor.apply(this,arguments);var i=this.auto_destroy(new a),s=this._postfix;i.on(this._node._element,"keydown",function(e){o.handleKeyEvent(s,e)&&this._valueExecute([e])},this)}}},{manualExecute:!0});return n.register("ba-hotkey"),n}),e.define("module:Partials.IfPartial",["module:Partials.ShowPartial"],function(e,t){var n=e.extend({scoped:t},function(i){return{constructor:function(e,t,n){i.constructor.apply(this,arguments),n||e.deactivate()},_apply:function(e){i._apply.call(this,e),e?this._node.activate():this._node.deactivate()}}});return n.register("ba-if"),n}),e.define("module:Partials.IgnorePartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(i){return{constructor:function(e,t,n){i.constructor.apply(this,arguments),e.deactivate()}}});return n.register("ba-ignore"),n}),e.define("module:Partials.InnerTemplatePartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(i){return{constructor:function(e,t,n){i.constructor.apply(this,arguments),e._element.innerHTML=n}}},{meta:{value_hidden:!0}});return n.register("ba-inner-template"),n}),e.define("module:Partials.NoScopePartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(e){return{prepareTagHandler:function(e){e.properties=this._node.properties()}}});return n.register("ba-noscope"),n}),e.define("module:Partials.OnPartial",["module:Handlers.Partial","browser:Events"],function(e,r,t){var n=e.extend({scoped:t},function(s){return{constructor:function(e,t,n,i){s.constructor.apply(this,arguments),this.auto_destroy(new r).on(this._node._element,i.trim(),function(){this._execute(n.trim())},this)}}},{manualExecute:!0});return n.register("ba-on"),n}),e.define("module:Partials.PropPartial",["module:Handlers.Partial"],function(e,t,n){var i=e.extend({scoped:n},function(e){return{_apply:function(e){this._node.element()[this._postfix]=e}}});return i.register("ba-prop"),i}),e.define("module:Partials.RadioGroupPartial",["module:Handlers.Partial","browser:Events"],function(e,r,t){var n=e.extend({scoped:t},function(s){return{constructor:function(e,t,n){s.constructor.apply(this,arguments);var i=this.auto_destroy(new r);n=n.trim(),this._node.element().checked=this._node.element().value===this._node.properties().get(n),i.on(this._node.element(),"click change",function(){this._node.properties().set(n,this._node.element().value)},this),this._node.properties().on("change:"+n,function(){this._node.element().checked=this._node.element().value===this._node.properties().get(n)},this)}}});return n.register("ba-radio-group"),n}),e.define("module:Partials.RegisterPartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){e.nameRegistry().register(e,this._value)},unbindTagHandler:function(e){e&&e.nameRegistry().unregister(this._value)}}});return n.register("ba-register"),n}),e.define("module:Partials.RepeatElementPartial",["module:Partials.RepeatPartial","base:Collections.Collection","base:Collections.FilteredCollection","base:Objs","module:Parser","base:Properties.Properties","browser:Dom"],function(e,t,n,i,s,r,a,o){var l=e.extend({scoped:o},function(s){return{constructor:function(e,t,n){s.constructor.apply(this,arguments);var i=a.elementByTemplate(e._template);i.removeAttribute("ba-repeat-element"),this.__filteredTemplate=i.outerHTML.trim(),this.__alwaysReindexNewItems=!0},_activate:function(){this._node.element().style.display="none",s._activate.call(this)},_iterateCollection:function(e){for(var t=this._collection.iterator().asArray(),n=t.length-1;0<=n;--n)e.call(this,t[n])},_newItemElements:function(){var e=a.elementByTemplate(this.__filteredTemplate);return this._node.element().parentNode.insertBefore(e,this._node.element().nextSibling),e["ba-handled"]=!0,[e]},prepareTagHandler:function(e){e.ignoreTagHandler=!0}}});return l.register("ba-repeat-element"),l}),e.define("module:Partials.RepeatPartial",["module:Handlers.Partial","base:Promise","base:Properties.Properties","base:Collections.Collection","base:Collections.FilteredCollection","base:Objs","base:Classes.SharedObjectFactory","module:Parser","module:Registries"],function(e,a,t,n,i,o,s,l,c,r){var h=e.extend({scoped:r},function(r){return{constructor:function(e,t,n){if(r.constructor.apply(this,arguments),this.__alwaysReindexNewItems=!1,this.__registered=!1,1<(t=t.split("::")).length&&(this.__dynOpts=l.parseCode(t[0].trim())),t=(t=t[t.length-1]).split("~"),this.__repeatArg=t[0].trim(),this._destroyCollection=!1,this._releaseValueCollection=!1,1<t.length){this.__repeatFilter=l.parseCode(t[1].trim());var i=this;e.mesh().watch(this.__repeatFilter.dependencies,function(){i.__filterChanged()},this.__repeatFilter)}e._expandChildren=!1;try{e._element.innerHTML=""}catch(s){}},destroy:function(){this.__unregister(),this.__repeatFilter&&this._node.mesh().unwatch(this.__repeatFilter.dependencies,this.__repeatFilter),r.destroy.call(this)},_activate:function(){this.__register(),this.__dynOpts&&(this.__dynOptsCache=this._node.mesh().execute(this.__dynOpts.dependencies,this.__dynOpts.func))},_deactivate:function(){this.__unregister()},__filterChanged:function(){this._active&&this._collection.setFilter(this.__filterFunc,this)},_change:function(e,t){this.__register(e)},__filterFunc:function(t){var n=this.__repeatFilter;if(!n)return!0;var i=this;return this._node.mesh().execute(n.dependencies,function(e){return e[i.__repeatArg]=i._isArray?t.get("value"):t.data(),n.func.call(this,e)},!0)},_iterateCollection:function(e){this._collection.iterate(e,this)},__register:function(){this.__unregister(),n.is_instance_of(this._value)&&this._value.destroyed()||(s.is_instance_of(this._value)?(this._isArray=!1,this._releaseValueCollection=!0,this._valueCollection=this._value.acquire()):(this._isArray=!n.is_instance_of(this._value),this._releaseValueCollection=!n.is_instance_of(this._value),this._valueCollection=this._releaseValueCollection?new n({objects:o.map(this._value,function(e){return new t({value:e})}),release_references:!0}):this._value),this._destroyCollection=!!this.__repeatFilter,this._collection=this._destroyCollection?new i(this._valueCollection,{filter:this.__filterFunc,context:this}):this._valueCollection,this._collectionChildren={},this._iterateCollection(this.__addItem),this._collection.on("add",this.__addItem,this),this._collection.on("remove",function(e){this.__removeItem(e,this._collection.bulkOperationInProgress())},this),this._collection.on("reindexed",function(e){if(!(this._collection.count()<2)){var t=this._collection.getIndex(e);0===t?this._prependItem(this._collection.getByIndex(1),e):this._appendItem(this._collection.getByIndex(t-1),e)}},this))},__unregister:function(){this._collection&&!this._collection.destroyed()&&this._iterateCollection(function(e){this.__removeItem(e,!0)},this);var e=this._node._element;this._node._removeChildren(),e.innerHTML="",this._collection&&!this._collection.destroyed()&&this._collection.off(null,null,this),this._valueCollection&&!this._valueCollection.destroyed()&&this._valueCollection.off(null,null,this),this._destroyCollection&&this._collection&&this._collection.weakDestroy(),this._releaseValueCollection&&this._valueCollection&&!this._valueCollection.destroyed()&&this._valueCollection.decreaseRef(),this._valueCollection=null,this._collection=null},__addItem:function(e){if(!this._collectionChildren[e.cid()]){var t={};this.__repeatArg&&(t[this.__repeatArg]=this._isArray?e.get("value"):e);var n=[];this._newItemElements().forEach(function(e){n.push(this._node._registerChild(e,t))},this),this._collectionChildren[e.cid()]={item:e,nodes:n};var i=this._collection.getIndex(e);i<this._collection.count()-1?this._prependItem(this._collection.getByIndex(i+1),e):this.__alwaysReindexNewItems&&1<this._collection.count()&&this._appendItem(this._collection.getByIndex(i-1),e)}},__removeItem:function(i,s){this._collectionChildren[i.cid()]&&(o.iter(this._collectionChildren[i.cid()].nodes,function(e){var t=e.element(),n=a.create();this.__dynOptsCache&&this.__dynOptsCache.onremove&&!s?this.__dynOptsCache.onremove.call(this._handler,i,t).forwardCallback(n):n.asyncSuccess(!0),n.success(function(){e.weakDestroy(),t.parentNode&&t.parentNode.removeChild(t)})},this),delete this._collectionChildren[i.cid()])},_itemData:function(e){return this._collectionChildren[e.cid()]},_itemDataElements:function(e){var t=this._itemData(e);if(!t)return null;var n=[];return o.iter(t.nodes,function(e){n.push(e.element())}),n},_prependItem:function(e,t){var n=this._itemDataElements(e),i=this._itemDataElements(t);n&&i&&o.iter(i,function(e){e.parentNode.insertBefore(e,n[0])})},_appendItem:function(e,t){var n=this._itemDataElements(e),i=this._itemDataElements(t);if(n&&i){var s=n[n.length-1];o.iter(i,function(e){s.parentNode.insertBefore(e,s.nextSibling),s=e})}},_newItemElements:function(){var e=c.templates.create(this._node._innerTemplate),t=this._node.element();return e.forEach(function(e){t.appendChild(e)}),e}}});return h.register("ba-repeat"),h}),e.define("module:Partials.ReturnPartial",["module:Handlers.Partial","browser:Events"],function(e,s,t){var n=e.extend({scoped:t},function(i){return{constructor:function(e,t,n){i.constructor.apply(this,arguments),this.auto_destroy(new s).on(this._node._element,"keypress",function(e){13===e.which&&this._execute()},this)}}},{manualExecute:!0});return n.register("ba-return"),n}),e.define("module:Partials.ShareScopePartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(e){return{bindTagHandler:function(e){e.properties().bind("",this._value?this._value:this._node.properties(),{deep:!0})}}});return n.register("ba-sharescope"),n}),e.define("module:Partials.ShowPartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},function(i){return{constructor:function(e,t,n){i.constructor.apply(this,arguments),this.__oldDisplay=undefined,this.__readOldDisplay=!1,this.__hidden=!1,n||this.__hide()},__hide:function(){this.__hidden||(this.__hidden=!0,this.__readOldDisplay||(this.__oldDisplay=this._node._element.style.display,this.__readOldDisplay=!0),this._node._element.style.display="none")},__show:function(){this.__hidden&&(this.__hidden=!1,this._node._element.style.display=this.__oldDisplay&&"none"!==this.__oldDisplay?this.__oldDisplay:"")},_apply:function(e){e?this.__show():this.__hide()}}});return n.register("ba-show"),n}),e.define("module:Partials.StylesPartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},{_apply:function(e){for(var t in e)this._node._element.style[t]=e[t]}});return n.register("ba-styles"),n}),e.define("module:Partials.TapPartial",["module:Handlers.Partial","browser:Info","browser:Events","base:Time","base:Async"],function(e,l,c,h,u,t){var n=e.extend({scoped:t},function(o){return{constructor:function(e,t,n,i){o.constructor.apply(this,arguments);var s=this.auto_destroy(new c);if(l.isMobile()){var r=i?"touch"+i.trim():"touchstart",a=0;s.on(this._node._element,"click "+r,function(e){e.stopPropagation(),e.preventDefault(),h.now()-a<100||(u.eventually(function(){this.executeAction()},this),a=h.now())},this)}else s.on(this._node._element,"click",function(e){e.stopPropagation(),this.executeAction()},this)},executeAction:function(){this._execute()}}},{manualExecute:!0});return n.register("ba-tap"),n}),e.define("module:Partials.TemplatePartial",["module:Handlers.Partial"],function(e,t){var n=e.extend({scoped:t},{bindTagHandler:function(e){this._value&&(e.template=this._value)}},{meta:{requires_tag_handler:!0,value_hidden:!0}});return n.register("ba-template"),n}),e.define("module:Partials.TemplateUrlPartial",["module:Handlers.Partial","browser:Loader"],function(e,s,t){var n=e.extend({scoped:t},function(n){return{constructor:function(i,e,t){n.constructor.apply(this,arguments),i._expandChildren=!1,i.element().innerHTML="",s.loadHtml(t,function(e){i.element().innerHTML=e;for(var t=i.element().childNodes,n=0;n<t.length;++n)i._registerChild(t[n])},this)}}});return n.register("ba-template-url"),n}),e.define("module:Partials.TogglePartial",["module:Handlers.Partial"],function(e,t){var n={readonly:"readOnly",playsinline:"playsInline"},i=e.extend({scoped:t},function(s){return{constructor:function(e,t,n,i){s.constructor.apply(this,arguments),this._apply(n)},_apply:function(e){this._node.element()[n[this._postfix]||this._postfix]=e?this._postfix:null}}});return i.register("ba-toggle"),i}),e.define("module:Partials.WeakIfPartial",["module:Partials.ShowPartial"],function(e,t){var n=e.extend({scoped:t},function(i){return{constructor:function(e,t,n){i.constructor.apply(this,arguments),n||e.deactivate()},_apply:function(e){i._apply.call(this,e),e&&this._node.activate()}}});return n.register("ba-weak-if"),n})}).call(Scoped);